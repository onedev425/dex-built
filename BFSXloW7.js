import{gy as l}from"./assets/index-CyIKZwcA.js";import{b as g}from"./E9hbZQpg.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[t]="29df2f76-a67f-4a5e-a9f9-3e6bbb819bac",o._sentryDebugIdIdentifier="sentry-dbid-29df2f76-a67f-4a5e-a9f9-3e6bbb819bac")}catch{}})();const y=o=>{class t extends Error{constructor(a,i,n){if(super(a||o,n),Object.setPrototypeOf(this,t.prototype),this.name=o,i)for(const r in i)this[r]=i[r];if(n&&v(n)&&"cause"in n&&!("cause"in this)){const r=n.cause;this.cause=r,"stack"in r&&(this.stack=this.stack+`
CAUSE: `+r.stack)}}}return t};function v(o){return typeof o=="object"}const m=y("UserRefusedOnDevice");var p;(function(o){o.Unknown="Unknown",o.LocationServicesDisabled="LocationServicesDisabled",o.LocationServicesUnauthorized="LocationServicesUnauthorized",o.BluetoothScanStartFailed="BluetoothScanStartFailed"})(p||(p={}));var S=function(o,t,e,a){function i(n){return n instanceof e?n:new e(function(r){r(n)})}return new(e||(e=Promise))(function(n,r){function u(h){try{c(a.next(h))}catch(f){r(f)}}function s(h){try{c(a.throw(h))}catch(f){r(f)}}function c(h){h.done?n(h.value):i(h.value).then(u,s)}c((a=a.apply(o,t||[])).next())})};const w=250,d=85,I="CSM",P=0,U=2,A=4,E=0,L=1,k=2,b=36864,D=27014;class z{constructor(t,e=I){this.transport=t,t.decorateAppAPIMethods(this,["getAddress","sign","getAppConfiguration"],e)}getAppConfiguration(){return this.transport.send(d,P,0,0).then(t=>({test_mode:t[0]!==0,version:""+t[1]+"."+t[2]+"."+t[3],device_locked:t[4]===1,major:t[1]}))}serializePath(t){const e=l.alloc(20);return e.writeUInt32LE((2147483648|t[0])>>>0,0),e.writeUInt32LE((2147483648|t[1])>>>0,4),e.writeUInt32LE((2147483648|t[2])>>>0,8),e.writeUInt32LE(t[3],12),e.writeUInt32LE(t[4],16),e}serializeHRP(t){if(t==null||t.length===0||t.length>83)throw new Error("Invalid HRP");const e=l.alloc(1+t.length);return e.writeUInt8(t.length,0),e.write(t,1),e}getAddress(t,e,a){const i=g.fromString(t).toPathArray(),n=this.serializePath(i),r=l.concat([this.serializeHRP(e),n]);return this.transport.send(d,A,a?1:0,0,r,[b]).then(u=>{const s=l.from(u.slice(33,-2)).toString(),c=l.from(u.slice(0,33)).toString("hex");return{address:s,publicKey:c}})}foreach(t,e){function a(i,n,r){return i>=n.length?r:e(n[i],i).then(function(u){return r.push(u),a(i+1,n,r)})}return Promise.resolve().then(()=>a(0,t,[]))}sign(t,e){return S(this,void 0,void 0,function*(){const a=g.fromString(t).toPathArray(),i=this.serializePath(a),n=[];n.push(i);const r=l.from(e);for(let s=0;s<r.length;s+=w){let c=s+w;s>r.length&&(c=r.length),n.push(r.slice(s,c))}let u={};return this.foreach(n,(s,c)=>this.transport.send(d,U,c===0?E:c+1===n.length?k:L,0,s,[b,D]).then(h=>u=h)).then(()=>{const s=u.slice(-2),c=s[0]*256+s[1];let h=null;if(u.length>2&&(h=u.slice(0,u.length-2)),c===27014)throw new m;return{signature:h,return_code:c}})})}}export{z as default};
