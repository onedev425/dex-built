import{r as l,aE as w,t,ak as v,aL as j,bN as k,j as s,q as u,T as h,H as E,I as p,w as C,D as T}from"./assets/index-CyIKZwcA.js";import{F as B}from"./C7jX1ZPo.js";import{P as F}from"./GQQXxAVl.js";import{V as I}from"./DA3rLf5F.js";import"./Cm6z4UIW.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[i]="5a7a3691-e4ef-4793-97c6-0e354c488eeb",a._sentryDebugIdIdentifier="sentry-dbid-5a7a3691-e4ef-4793-97c6-0e354c488eeb")}catch{}})();const N=()=>{const[a,i]=l.useState(""),[o,c]=l.useState(null),n=w(),m=l.useCallback(async e=>{if(!e.txBody)throw Error(t("views.multisig.invalidTxBody"));if(!(e.members&&Array.isArray(e.members))||e.members.length<e.threshold||e.members.some(r=>!r.pubKey))throw Error(t("views.multisig.incorrectSigners"));if(e.signatures&&(!Array.isArray(e.signatures)||e.signatures.some(r=>!r.pubKey)))throw Error(t("views.multisig.invalidSignatures"));return{threshold:e.threshold,txBody:e.txBody,bodyBytes:e.bodyBytes,members:e.members.map(r=>({pubKey:r.pubKey,name:r.name||""})),signatures:e.signatures.map(r=>({pubKey:r.pubKey,signature:r.signature||""})).filter(r=>r.signature)}},[]),y=l.useCallback(async e=>{try{i("");const r=JSON.parse(e),g=await m(r);c(g)}catch(r){v(r),i(t("views.multisig.jsonError")),c(null)}},[m]),d=l.useCallback(e=>{i(`${t("views.multisig.selectingKeyError")}: ${e}`),c(null)},[]),b=l.useCallback(()=>{if(!o)return;const{txBody:e,signatures:r,members:g,threshold:x,bodyBytes:f}=o;n(j.TxMultisig,{state:{tx:e,members:g,threshold:x,signatures:r,bodyBytes:f}})},[o,n]);return{onChangeFile:y,fileError:a,setFileError:i,onError:d,useCallback:l.useCallback,handleImportTx:b,isValid:!!o&&!a,importedTx:o}},K=()=>{const{onChangeFile:a,fileError:i,onError:o,isValid:c,importedTx:n,handleImportTx:m}=N(),{openFilePicker:y,filesContent:[{content:d}={content:""}],loading:b,errors:e}=k({accept:[".txt",".json"]});return l.useEffect(()=>{var r;d?a(d):e&&o((r=e==null?void 0:e[0])==null?void 0:r.name)},[d,e,a,o]),s.jsxs(F,{header:s.jsx(I,{withBack:!0,title:t("views.multisig.importTransaction")}),title:t("views.multisig.importTransaction"),children:[s.jsxs(u,{col:!0,className:"self-stretch",children:[s.jsxs(u,{className:"pb-8",children:[s.jsx(h,{children:t("views.multisig.selectTxJsonFile")}),s.jsx(E,{color:"secondary",iconName:"infoCircle",tooltip:t("views.multisig.thorsafeFileTooltip")})]}),s.jsx(B,{hasError:!!i,label:t("views.multisig.chooseFileToUpload")}),s.jsxs(u,{alignCenter:!0,className:"h-10 px-3 border border-solid cursor-pointer rounded-2xl border-light-border-primary dark:border-dark-border-primary hover:border-light-typo-gray dark:hover:border-dark-typo-gray",onClick:y,children:[!(n||i)&&s.jsx(p,{name:"upload",size:18}),n&&!i&&s.jsx(p,{color:"green",name:"valid",size:18}),i&&s.jsx(p,{color:"red",name:"invalid",size:18}),s.jsx(h,{className:C("text-[11px] opacity-80 ml-2",{"opacity-100":n&&!i}),fontWeight:"semibold",textStyle:"caption-xs",children:t("views.walletModal.chooseKeystore")})]})]}),s.jsx(u,{center:!0,className:"w-full pt-5",children:s.jsx(T,{stretch:!0,disabled:!c,loading:b,onClick:m,size:"lg",variant:"fancy",children:t("views.multisig.importTransaction")})})]})};export{K as default};
