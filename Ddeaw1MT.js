import{gD as Jh,dM as Xr,gW as jr,gX as Uo,gH as zr,gJ as tc,cE as ec,gy as m,gC as rc,gY as $t,gZ as Co,g_ as Ho,gx as _i,g$ as nc,h0 as Ti,h1 as ic,h2 as sc,h3 as oc,h4 as uc,h5 as Pi,h6 as ac,h7 as Lo,h8 as Do,gR as Bo}from"./assets/index-CyIKZwcA.js";import{b as Oi}from"./E9hbZQpg.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0d1d5b04-f43a-4097-9a41-5b9c2cf0495f",e._sentryDebugIdIdentifier="sentry-dbid-0d1d5b04-f43a-4097-9a41-5b9c2cf0495f")}catch{}})();var Mi={exports:{}};const hc="2.0.0",$o=256,cc=Number.MAX_SAFE_INTEGER||9007199254740991,lc=16,pc=$o-6,fc=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Yr={MAX_LENGTH:$o,MAX_SAFE_COMPONENT_LENGTH:lc,MAX_SAFE_BUILD_LENGTH:pc,MAX_SAFE_INTEGER:cc,RELEASE_TYPES:fc,SEMVER_SPEC_VERSION:hc,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Ai={};const dc=typeof Jh=="object"&&Ai&&Ai.NODE_DEBUG&&/\bsemver\b/i.test(Ai.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Zr=dc;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Yr,i=Zr;t=e.exports={};const u=t.re=[],c=t.safeRe=[],p=t.src=[],g=t.t={};let y=0;const b="[a-zA-Z0-9-]",O=[["\\s",1],["\\d",s],[b,n]],S=H=>{for(const[x,L]of O)H=H.split(`${x}*`).join(`${x}{0,${L}}`).split(`${x}+`).join(`${x}{1,${L}}`);return H},T=(H,x,L)=>{const M=S(x),N=y++;i(H,N,x),g[H]=N,p[N]=x,u[N]=new RegExp(x,L?"g":void 0),c[N]=new RegExp(M,L?"g":void 0)};T("NUMERICIDENTIFIER","0|[1-9]\\d*"),T("NUMERICIDENTIFIERLOOSE","\\d+"),T("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${b}*`),T("MAINVERSION",`(${p[g.NUMERICIDENTIFIER]})\\.(${p[g.NUMERICIDENTIFIER]})\\.(${p[g.NUMERICIDENTIFIER]})`),T("MAINVERSIONLOOSE",`(${p[g.NUMERICIDENTIFIERLOOSE]})\\.(${p[g.NUMERICIDENTIFIERLOOSE]})\\.(${p[g.NUMERICIDENTIFIERLOOSE]})`),T("PRERELEASEIDENTIFIER",`(?:${p[g.NUMERICIDENTIFIER]}|${p[g.NONNUMERICIDENTIFIER]})`),T("PRERELEASEIDENTIFIERLOOSE",`(?:${p[g.NUMERICIDENTIFIERLOOSE]}|${p[g.NONNUMERICIDENTIFIER]})`),T("PRERELEASE",`(?:-(${p[g.PRERELEASEIDENTIFIER]}(?:\\.${p[g.PRERELEASEIDENTIFIER]})*))`),T("PRERELEASELOOSE",`(?:-?(${p[g.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${p[g.PRERELEASEIDENTIFIERLOOSE]})*))`),T("BUILDIDENTIFIER",`${b}+`),T("BUILD",`(?:\\+(${p[g.BUILDIDENTIFIER]}(?:\\.${p[g.BUILDIDENTIFIER]})*))`),T("FULLPLAIN",`v?${p[g.MAINVERSION]}${p[g.PRERELEASE]}?${p[g.BUILD]}?`),T("FULL",`^${p[g.FULLPLAIN]}$`),T("LOOSEPLAIN",`[v=\\s]*${p[g.MAINVERSIONLOOSE]}${p[g.PRERELEASELOOSE]}?${p[g.BUILD]}?`),T("LOOSE",`^${p[g.LOOSEPLAIN]}$`),T("GTLT","((?:<|>)?=?)"),T("XRANGEIDENTIFIERLOOSE",`${p[g.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),T("XRANGEIDENTIFIER",`${p[g.NUMERICIDENTIFIER]}|x|X|\\*`),T("XRANGEPLAIN",`[v=\\s]*(${p[g.XRANGEIDENTIFIER]})(?:\\.(${p[g.XRANGEIDENTIFIER]})(?:\\.(${p[g.XRANGEIDENTIFIER]})(?:${p[g.PRERELEASE]})?${p[g.BUILD]}?)?)?`),T("XRANGEPLAINLOOSE",`[v=\\s]*(${p[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${p[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${p[g.XRANGEIDENTIFIERLOOSE]})(?:${p[g.PRERELEASELOOSE]})?${p[g.BUILD]}?)?)?`),T("XRANGE",`^${p[g.GTLT]}\\s*${p[g.XRANGEPLAIN]}$`),T("XRANGELOOSE",`^${p[g.GTLT]}\\s*${p[g.XRANGEPLAINLOOSE]}$`),T("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),T("COERCE",`${p[g.COERCEPLAIN]}(?:$|[^\\d])`),T("COERCEFULL",p[g.COERCEPLAIN]+`(?:${p[g.PRERELEASE]})?(?:${p[g.BUILD]})?(?:$|[^\\d])`),T("COERCERTL",p[g.COERCE],!0),T("COERCERTLFULL",p[g.COERCEFULL],!0),T("LONETILDE","(?:~>?)"),T("TILDETRIM",`(\\s*)${p[g.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",T("TILDE",`^${p[g.LONETILDE]}${p[g.XRANGEPLAIN]}$`),T("TILDELOOSE",`^${p[g.LONETILDE]}${p[g.XRANGEPLAINLOOSE]}$`),T("LONECARET","(?:\\^)"),T("CARETTRIM",`(\\s*)${p[g.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",T("CARET",`^${p[g.LONECARET]}${p[g.XRANGEPLAIN]}$`),T("CARETLOOSE",`^${p[g.LONECARET]}${p[g.XRANGEPLAINLOOSE]}$`),T("COMPARATORLOOSE",`^${p[g.GTLT]}\\s*(${p[g.LOOSEPLAIN]})$|^$`),T("COMPARATOR",`^${p[g.GTLT]}\\s*(${p[g.FULLPLAIN]})$|^$`),T("COMPARATORTRIM",`(\\s*)${p[g.GTLT]}\\s*(${p[g.LOOSEPLAIN]}|${p[g.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",T("HYPHENRANGE",`^\\s*(${p[g.XRANGEPLAIN]})\\s+-\\s+(${p[g.XRANGEPLAIN]})\\s*$`),T("HYPHENRANGELOOSE",`^\\s*(${p[g.XRANGEPLAINLOOSE]})\\s+-\\s+(${p[g.XRANGEPLAINLOOSE]})\\s*$`),T("STAR","(<|>)?=?\\s*\\*"),T("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),T("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Mi,Mi.exports);var Rr=Mi.exports;const mc=Object.freeze({loose:!0}),gc=Object.freeze({}),wc=e=>e?typeof e!="object"?mc:e:gc;var Ni=wc;const Go=/^[0-9]+$/,Ko=(e,t)=>{const r=Go.test(e),n=Go.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1},vc=(e,t)=>Ko(t,e);var Fo={compareIdentifiers:Ko,rcompareIdentifiers:vc};const Qr=Zr,{MAX_LENGTH:Wo,MAX_SAFE_INTEGER:Jr}=Yr,{safeRe:Vo,t:qo}=Rr,yc=Ni,{compareIdentifiers:ur}=Fo;let Ec=class ve{constructor(t,r){if(r=yc(r),t instanceof ve){if(t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>Wo)throw new TypeError(`version is longer than ${Wo} characters`);Qr("SemVer",t,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const n=t.trim().match(r.loose?Vo[qo.LOOSE]:Vo[qo.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Jr||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Jr||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Jr||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const i=+s;if(i>=0&&i<Jr)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Qr("SemVer.compare",this.version,this.options,t),!(t instanceof ve)){if(typeof t=="string"&&t===this.version)return 0;t=new ve(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof ve||(t=new ve(t,this.options)),ur(this.major,t.major)||ur(this.minor,t.minor)||ur(this.patch,t.patch)}comparePre(t){if(t instanceof ve||(t=new ve(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{const n=this.prerelease[r],s=t.prerelease[r];if(Qr("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n!==s)return ur(n,s)}while(++r)}compareBuild(t){t instanceof ve||(t=new ve(t,this.options));let r=0;do{const n=this.build[r],s=t.build[r];if(Qr("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n!==s)return ur(n,s)}while(++r)}inc(t,r,n){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(r){let i=[r,s];n===!1&&(i=[r]),ur(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var Zt=Ec;const Xo=Zt,Ic=(e,t,r=!1)=>{if(e instanceof Xo)return e;try{return new Xo(e,t)}catch(n){if(!r)return null;throw n}};var ar=Ic;const bc=ar,Sc=(e,t)=>{const r=bc(e,t);return r?r.version:null};var _c=Sc;const Tc=ar,Pc=(e,t)=>{const r=Tc(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null};var Oc=Pc;const jo=Zt,Mc=(e,t,r,n,s)=>{typeof r=="string"&&(s=n,n=r,r=void 0);try{return new jo(e instanceof jo?e.version:e,r).inc(t,n,s).version}catch{return null}};var Ac=Mc;const zo=ar,Nc=(e,t)=>{const r=zo(e,null,!0),n=zo(t,null,!0),s=r.compare(n);if(s===0)return null;const i=s>0,u=i?r:n,c=i?n:r,p=!!u.prerelease.length;if(c.prerelease.length&&!p)return!c.patch&&!c.minor?"major":u.patch?"patch":u.minor?"minor":"major";const g=p?"pre":"";return r.major!==n.major?g+"major":r.minor!==n.minor?g+"minor":r.patch!==n.patch?g+"patch":"prerelease"};var kc=Nc;const Rc=Zt,xc=(e,t)=>new Rc(e,t).major;var Uc=xc;const Cc=Zt,Hc=(e,t)=>new Cc(e,t).minor;var Lc=Hc;const Dc=Zt,Bc=(e,t)=>new Dc(e,t).patch;var $c=Bc;const Gc=ar,Kc=(e,t)=>{const r=Gc(e,t);return r&&r.prerelease.length?r.prerelease:null};var Fc=Kc;const Yo=Zt,Wc=(e,t,r)=>new Yo(e,r).compare(new Yo(t,r));var ue=Wc;const Vc=ue,qc=(e,t,r)=>Vc(t,e,r);var Xc=qc;const jc=ue,zc=(e,t)=>jc(e,t,!0);var Yc=zc;const Zo=Zt,Zc=(e,t,r)=>{const n=new Zo(e,r),s=new Zo(t,r);return n.compare(s)||n.compareBuild(s)};var ki=Zc;const Qc=ki,Jc=(e,t)=>e.sort((r,n)=>Qc(r,n,t));var tl=Jc;const el=ki,rl=(e,t)=>e.sort((r,n)=>el(n,r,t));var nl=rl;const il=ue,sl=(e,t,r)=>il(e,t,r)>0;var tn=sl;const ol=ue,ul=(e,t,r)=>ol(e,t,r)<0;var Ri=ul;const al=ue,hl=(e,t,r)=>al(e,t,r)===0;var Qo=hl;const cl=ue,ll=(e,t,r)=>cl(e,t,r)!==0;var Jo=ll;const pl=ue,fl=(e,t,r)=>pl(e,t,r)>=0;var xi=fl;const dl=ue,ml=(e,t,r)=>dl(e,t,r)<=0;var Ui=ml;const gl=Qo,wl=Jo,vl=tn,yl=xi,El=Ri,Il=Ui,bl=(e,t,r,n)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e===r;case"!==":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e!==r;case"":case"=":case"==":return gl(e,r,n);case"!=":return wl(e,r,n);case">":return vl(e,r,n);case">=":return yl(e,r,n);case"<":return El(e,r,n);case"<=":return Il(e,r,n);default:throw new TypeError(`Invalid operator: ${t}`)}};var tu=bl;const Sl=Zt,_l=ar,{safeRe:en,t:rn}=Rr,Tl=(e,t)=>{if(e instanceof Sl)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let r=null;if(!t.rtl)r=e.match(t.includePrerelease?en[rn.COERCEFULL]:en[rn.COERCE]);else{const p=t.includePrerelease?en[rn.COERCERTLFULL]:en[rn.COERCERTL];let g;for(;(g=p.exec(e))&&(!r||r.index+r[0].length!==e.length);)(!r||g.index+g[0].length!==r.index+r[0].length)&&(r=g),p.lastIndex=g.index+g[1].length+g[2].length;p.lastIndex=-1}if(r===null)return null;const n=r[2],s=r[3]||"0",i=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",c=t.includePrerelease&&r[6]?`+${r[6]}`:"";return _l(`${n}.${s}.${i}${u}${c}`,t)};var Pl=Tl,eu,ru;function Ol(){return ru||(ru=1,eu=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),eu}var Ml=j;j.Node=We,j.create=j;function j(e){var t=this;if(t instanceof j||(t=new j),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(s){t.push(s)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)t.push(arguments[r]);return t}j.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},j.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},j.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},j.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)Nl(this,arguments[e]);return this.length},j.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)kl(this,arguments[e]);return this.length},j.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},j.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},j.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;r!==null;n++)e.call(t,r.value,n,this),r=r.next},j.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;r!==null;n--)e.call(t,r.value,n,this),r=r.prev},j.prototype.get=function(e){for(var t=0,r=this.head;r!==null&&t<e;t++)r=r.next;if(t===e&&r!==null)return r.value},j.prototype.getReverse=function(e){for(var t=0,r=this.tail;r!==null&&t<e;t++)r=r.prev;if(t===e&&r!==null)return r.value},j.prototype.map=function(e,t){t=t||this;for(var r=new j,n=this.head;n!==null;)r.push(e.call(t,n.value,this)),n=n.next;return r},j.prototype.mapReverse=function(e,t){t=t||this;for(var r=new j,n=this.tail;n!==null;)r.push(e.call(t,n.value,this)),n=n.prev;return r},j.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=0;n!==null;s++)r=e(r,n.value,s),n=n.next;return r},j.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;n!==null;s--)r=e(r,n.value,s),n=n.prev;return r},j.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;r!==null;t++)e[t]=r.value,r=r.next;return e},j.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;r!==null;t++)e[t]=r.value,r=r.prev;return e},j.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new j;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,s=this.head;s!==null&&n<e;n++)s=s.next;for(;s!==null&&n<t;n++,s=s.next)r.push(s.value);return r},j.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new j;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,s=this.tail;s!==null&&n>t;n--)s=s.prev;for(;s!==null&&n>e;n--,s=s.prev)r.push(s.value);return r},j.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,s=this.head;s!==null&&n<e;n++)s=s.next;for(var i=[],n=0;s&&n<t;n++)i.push(s.value),s=this.removeNode(s);s===null&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(var n=0;n<r.length;n++)s=Al(this,s,r[n]);return i},j.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};function Al(e,t,r){var n=t===e.head?new We(r,null,t,e):new We(r,t,t.next,e);return n.next===null&&(e.tail=n),n.prev===null&&(e.head=n),e.length++,n}function Nl(e,t){e.tail=new We(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function kl(e,t){e.head=new We(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function We(e,t,r,n){if(!(this instanceof We))return new We(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{Ol()(j)}catch{}const Rl=Ml,Ve=Symbol("max"),ye=Symbol("length"),hr=Symbol("lengthCalculator"),xr=Symbol("allowStale"),qe=Symbol("maxAge"),Ee=Symbol("dispose"),nu=Symbol("noDisposeOnSet"),Kt=Symbol("lruList"),ae=Symbol("cache"),iu=Symbol("updateAgeOnGet"),Ci=()=>1;class xl{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[Ve]=t.max||1/0;const r=t.length||Ci;if(this[hr]=typeof r!="function"?Ci:r,this[xr]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[qe]=t.maxAge||0,this[Ee]=t.dispose,this[nu]=t.noDisposeOnSet||!1,this[iu]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[Ve]=t||1/0,Ur(this)}get max(){return this[Ve]}set allowStale(t){this[xr]=!!t}get allowStale(){return this[xr]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[qe]=t,Ur(this)}get maxAge(){return this[qe]}set lengthCalculator(t){typeof t!="function"&&(t=Ci),t!==this[hr]&&(this[hr]=t,this[ye]=0,this[Kt].forEach(r=>{r.length=this[hr](r.value,r.key),this[ye]+=r.length})),Ur(this)}get lengthCalculator(){return this[hr]}get length(){return this[ye]}get itemCount(){return this[Kt].length}rforEach(t,r){r=r||this;for(let n=this[Kt].tail;n!==null;){const s=n.prev;su(this,t,n,r),n=s}}forEach(t,r){r=r||this;for(let n=this[Kt].head;n!==null;){const s=n.next;su(this,t,n,r),n=s}}keys(){return this[Kt].toArray().map(t=>t.key)}values(){return this[Kt].toArray().map(t=>t.value)}reset(){this[Ee]&&this[Kt]&&this[Kt].length&&this[Kt].forEach(t=>this[Ee](t.key,t.value)),this[ae]=new Map,this[Kt]=new Rl,this[ye]=0}dump(){return this[Kt].map(t=>nn(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[Kt]}set(t,r,n){if(n=n||this[qe],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const s=n?Date.now():0,i=this[hr](r,t);if(this[ae].has(t)){if(i>this[Ve])return cr(this,this[ae].get(t)),!1;const c=this[ae].get(t).value;return this[Ee]&&(this[nu]||this[Ee](t,c.value)),c.now=s,c.maxAge=n,c.value=r,this[ye]+=i-c.length,c.length=i,this.get(t),Ur(this),!0}const u=new Ul(t,r,i,s,n);return u.length>this[Ve]?(this[Ee]&&this[Ee](t,r),!1):(this[ye]+=u.length,this[Kt].unshift(u),this[ae].set(t,this[Kt].head),Ur(this),!0)}has(t){if(!this[ae].has(t))return!1;const r=this[ae].get(t).value;return!nn(this,r)}get(t){return Hi(this,t,!0)}peek(t){return Hi(this,t,!1)}pop(){const t=this[Kt].tail;return t?(cr(this,t),t.value):null}del(t){cr(this,this[ae].get(t))}load(t){this.reset();const r=Date.now();for(let n=t.length-1;n>=0;n--){const s=t[n],i=s.e||0;if(i===0)this.set(s.k,s.v);else{const u=i-r;u>0&&this.set(s.k,s.v,u)}}}prune(){this[ae].forEach((t,r)=>Hi(this,r,!1))}}const Hi=(e,t,r)=>{const n=e[ae].get(t);if(n){const s=n.value;if(nn(e,s)){if(cr(e,n),!e[xr])return}else r&&(e[iu]&&(n.value.now=Date.now()),e[Kt].unshiftNode(n));return s.value}},nn=(e,t)=>{if(!t||!t.maxAge&&!e[qe])return!1;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[qe]&&r>e[qe]},Ur=e=>{if(e[ye]>e[Ve])for(let t=e[Kt].tail;e[ye]>e[Ve]&&t!==null;){const r=t.prev;cr(e,t),t=r}},cr=(e,t)=>{if(t){const r=t.value;e[Ee]&&e[Ee](r.key,r.value),e[ye]-=r.length,e[ae].delete(r.key),e[Kt].removeNode(t)}};class Ul{constructor(t,r,n,s,i){this.key=t,this.value=r,this.length=n,this.now=s,this.maxAge=i||0}}const su=(e,t,r,n)=>{let s=r.value;nn(e,s)&&(cr(e,r),e[xr]||(s=void 0)),s&&t.call(n,s.value,s.key,e)};var Cl=xl,Li,ou;function he(){if(ou)return Li;ou=1;class e{constructor(f,w){if(w=n(w),f instanceof e)return f.loose===!!w.loose&&f.includePrerelease===!!w.includePrerelease?f:new e(f.raw,w);if(f instanceof s)return this.raw=f.value,this.set=[[f]],this.format(),this;if(this.options=w,this.loose=!!w.loose,this.includePrerelease=!!w.includePrerelease,this.raw=f.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(E=>this.parseRange(E.trim())).filter(E=>E.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const E=this.set[0];if(this.set=this.set.filter(I=>!T(I[0])),this.set.length===0)this.set=[E];else if(this.set.length>1){for(const I of this.set)if(I.length===1&&H(I[0])){this.set=[I];break}}}this.format()}format(){return this.range=this.set.map(f=>f.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(f){const w=((this.options.includePrerelease&&O)|(this.options.loose&&S))+":"+f,E=r.get(w);if(E)return E;const I=this.options.loose,d=I?c[p.HYPHENRANGELOOSE]:c[p.HYPHENRANGE];f=f.replace(d,o(this.options.includePrerelease)),i("hyphen replace",f),f=f.replace(c[p.COMPARATORTRIM],g),i("comparator trim",f),f=f.replace(c[p.TILDETRIM],y),i("tilde trim",f),f=f.replace(c[p.CARETTRIM],b),i("caret trim",f);let a=f.split(" ").map(P=>L(P,this.options)).join(" ").split(/\s+/).map(P=>B(P,this.options));I&&(a=a.filter(P=>(i("loose invalid filter",P,this.options),!!P.match(c[p.COMPARATORLOOSE])))),i("range list",a);const v=new Map,A=a.map(P=>new s(P,this.options));for(const P of A){if(T(P))return[P];v.set(P.value,P)}v.size>1&&v.has("")&&v.delete("");const _=[...v.values()];return r.set(w,_),_}intersects(f,w){if(!(f instanceof e))throw new TypeError("a Range is required");return this.set.some(E=>x(E,w)&&f.set.some(I=>x(I,w)&&E.every(d=>I.every(a=>d.intersects(a,w)))))}test(f){if(!f)return!1;if(typeof f=="string")try{f=new u(f,this.options)}catch{return!1}for(let w=0;w<this.set.length;w++)if(h(this.set[w],f,this.options))return!0;return!1}}Li=e;const t=Cl,r=new t({max:1e3}),n=Ni,s=sn(),i=Zr,u=Zt,{safeRe:c,t:p,comparatorTrimReplace:g,tildeTrimReplace:y,caretTrimReplace:b}=Rr,{FLAG_INCLUDE_PRERELEASE:O,FLAG_LOOSE:S}=Yr,T=l=>l.value==="<0.0.0-0",H=l=>l.value==="",x=(l,f)=>{let w=!0;const E=l.slice();let I=E.pop();for(;w&&E.length;)w=E.every(d=>I.intersects(d,f)),I=E.pop();return w},L=(l,f)=>(i("comp",l,f),l=G(l,f),i("caret",l),l=N(l,f),i("tildes",l),l=$(l,f),i("xrange",l),l=k(l,f),i("stars",l),l),M=l=>!l||l.toLowerCase()==="x"||l==="*",N=(l,f)=>l.trim().split(/\s+/).map(w=>R(w,f)).join(" "),R=(l,f)=>{const w=f.loose?c[p.TILDELOOSE]:c[p.TILDE];return l.replace(w,(E,I,d,a,v)=>{i("tilde",l,E,I,d,a,v);let A;return M(I)?A="":M(d)?A=`>=${I}.0.0 <${+I+1}.0.0-0`:M(a)?A=`>=${I}.${d}.0 <${I}.${+d+1}.0-0`:v?(i("replaceTilde pr",v),A=`>=${I}.${d}.${a}-${v} <${I}.${+d+1}.0-0`):A=`>=${I}.${d}.${a} <${I}.${+d+1}.0-0`,i("tilde return",A),A})},G=(l,f)=>l.trim().split(/\s+/).map(w=>C(w,f)).join(" "),C=(l,f)=>{i("caret",l,f);const w=f.loose?c[p.CARETLOOSE]:c[p.CARET],E=f.includePrerelease?"-0":"";return l.replace(w,(I,d,a,v,A)=>{i("caret",l,I,d,a,v,A);let _;return M(d)?_="":M(a)?_=`>=${d}.0.0${E} <${+d+1}.0.0-0`:M(v)?d==="0"?_=`>=${d}.${a}.0${E} <${d}.${+a+1}.0-0`:_=`>=${d}.${a}.0${E} <${+d+1}.0.0-0`:A?(i("replaceCaret pr",A),d==="0"?a==="0"?_=`>=${d}.${a}.${v}-${A} <${d}.${a}.${+v+1}-0`:_=`>=${d}.${a}.${v}-${A} <${d}.${+a+1}.0-0`:_=`>=${d}.${a}.${v}-${A} <${+d+1}.0.0-0`):(i("no pr"),d==="0"?a==="0"?_=`>=${d}.${a}.${v}${E} <${d}.${a}.${+v+1}-0`:_=`>=${d}.${a}.${v}${E} <${d}.${+a+1}.0-0`:_=`>=${d}.${a}.${v} <${+d+1}.0.0-0`),i("caret return",_),_})},$=(l,f)=>(i("replaceXRanges",l,f),l.split(/\s+/).map(w=>K(w,f)).join(" ")),K=(l,f)=>{l=l.trim();const w=f.loose?c[p.XRANGELOOSE]:c[p.XRANGE];return l.replace(w,(E,I,d,a,v,A)=>{i("xRange",l,E,I,d,a,v,A);const _=M(d),P=_||M(a),U=P||M(v),D=U;return I==="="&&D&&(I=""),A=f.includePrerelease?"-0":"",_?I===">"||I==="<"?E="<0.0.0-0":E="*":I&&D?(P&&(a=0),v=0,I===">"?(I=">=",P?(d=+d+1,a=0,v=0):(a=+a+1,v=0)):I==="<="&&(I="<",P?d=+d+1:a=+a+1),I==="<"&&(A="-0"),E=`${I+d}.${a}.${v}${A}`):P?E=`>=${d}.0.0${A} <${+d+1}.0.0-0`:U&&(E=`>=${d}.${a}.0${A} <${d}.${+a+1}.0-0`),i("xRange return",E),E})},k=(l,f)=>(i("replaceStars",l,f),l.trim().replace(c[p.STAR],"")),B=(l,f)=>(i("replaceGTE0",l,f),l.trim().replace(c[f.includePrerelease?p.GTE0PRE:p.GTE0],"")),o=l=>(f,w,E,I,d,a,v,A,_,P,U,D,q)=>(M(E)?w="":M(I)?w=`>=${E}.0.0${l?"-0":""}`:M(d)?w=`>=${E}.${I}.0${l?"-0":""}`:a?w=`>=${w}`:w=`>=${w}${l?"-0":""}`,M(_)?A="":M(P)?A=`<${+_+1}.0.0-0`:M(U)?A=`<${_}.${+P+1}.0-0`:D?A=`<=${_}.${P}.${U}-${D}`:l?A=`<${_}.${P}.${+U+1}-0`:A=`<=${A}`,`${w} ${A}`.trim()),h=(l,f,w)=>{for(let E=0;E<l.length;E++)if(!l[E].test(f))return!1;if(f.prerelease.length&&!w.includePrerelease){for(let E=0;E<l.length;E++)if(i(l[E].semver),l[E].semver!==s.ANY&&l[E].semver.prerelease.length>0){const I=l[E].semver;if(I.major===f.major&&I.minor===f.minor&&I.patch===f.patch)return!0}return!1}return!0};return Li}var Di,uu;function sn(){if(uu)return Di;uu=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(y,b){if(b=r(b),y instanceof t){if(y.loose===!!b.loose)return y;y=y.value}y=y.trim().split(/\s+/).join(" "),u("comparator",y,b),this.options=b,this.loose=!!b.loose,this.parse(y),this.semver===e?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(y){const b=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],O=y.match(b);if(!O)throw new TypeError(`Invalid comparator: ${y}`);this.operator=O[1]!==void 0?O[1]:"",this.operator==="="&&(this.operator=""),O[2]?this.semver=new c(O[2],this.options.loose):this.semver=e}toString(){return this.value}test(y){if(u("Comparator.test",y,this.options.loose),this.semver===e||y===e)return!0;if(typeof y=="string")try{y=new c(y,this.options)}catch{return!1}return i(y,this.operator,this.semver,this.options)}intersects(y,b){if(!(y instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new p(y.value,b).test(this.value):y.operator===""?y.value===""?!0:new p(this.value,b).test(y.semver):(b=r(b),b.includePrerelease&&(this.value==="<0.0.0-0"||y.value==="<0.0.0-0")||!b.includePrerelease&&(this.value.startsWith("<0.0.0")||y.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&y.operator.startsWith(">")||this.operator.startsWith("<")&&y.operator.startsWith("<")||this.semver.version===y.semver.version&&this.operator.includes("=")&&y.operator.includes("=")||i(this.semver,"<",y.semver,b)&&this.operator.startsWith(">")&&y.operator.startsWith("<")||i(this.semver,">",y.semver,b)&&this.operator.startsWith("<")&&y.operator.startsWith(">")))}}Di=t;const r=Ni,{safeRe:n,t:s}=Rr,i=tu,u=Zr,c=Zt,p=he();return Di}const Hl=he(),Ll=(e,t,r)=>{try{t=new Hl(t,r)}catch{return!1}return t.test(e)};var on=Ll;const Dl=he(),Bl=(e,t)=>new Dl(e,t).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));var $l=Bl;const Gl=Zt,Kl=he(),Fl=(e,t,r)=>{let n=null,s=null,i=null;try{i=new Kl(t,r)}catch{return null}return e.forEach(u=>{i.test(u)&&(!n||s.compare(u)===-1)&&(n=u,s=new Gl(n,r))}),n};var Wl=Fl;const Vl=Zt,ql=he(),Xl=(e,t,r)=>{let n=null,s=null,i=null;try{i=new ql(t,r)}catch{return null}return e.forEach(u=>{i.test(u)&&(!n||s.compare(u)===1)&&(n=u,s=new Vl(n,r))}),n};var jl=Xl;const Bi=Zt,zl=he(),au=tn,Yl=(e,t)=>{e=new zl(e,t);let r=new Bi("0.0.0");if(e.test(r)||(r=new Bi("0.0.0-0"),e.test(r)))return r;r=null;for(let n=0;n<e.set.length;++n){const s=e.set[n];let i=null;s.forEach(u=>{const c=new Bi(u.semver.version);switch(u.operator){case">":c.prerelease.length===0?c.patch++:c.prerelease.push(0),c.raw=c.format();case"":case">=":(!i||au(c,i))&&(i=c);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),i&&(!r||au(r,i))&&(r=i)}return r&&e.test(r)?r:null};var Zl=Yl;const Ql=he(),Jl=(e,t)=>{try{return new Ql(e,t).range||"*"}catch{return null}};var tp=Jl;const ep=Zt,hu=sn(),{ANY:rp}=hu,np=he(),ip=on,cu=tn,lu=Ri,sp=Ui,op=xi,up=(e,t,r,n)=>{e=new ep(e,n),t=new np(t,n);let s,i,u,c,p;switch(r){case">":s=cu,i=sp,u=lu,c=">",p=">=";break;case"<":s=lu,i=op,u=cu,c="<",p="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ip(e,t,n))return!1;for(let g=0;g<t.set.length;++g){const y=t.set[g];let b=null,O=null;if(y.forEach(S=>{S.semver===rp&&(S=new hu(">=0.0.0")),b=b||S,O=O||S,s(S.semver,b.semver,n)?b=S:u(S.semver,O.semver,n)&&(O=S)}),b.operator===c||b.operator===p||(!O.operator||O.operator===c)&&i(e,O.semver)||O.operator===p&&u(e,O.semver))return!1}return!0};var $i=up;const ap=$i,hp=(e,t,r)=>ap(e,t,">",r);var cp=hp;const lp=$i,pp=(e,t,r)=>lp(e,t,"<",r);var fp=pp;const pu=he(),dp=(e,t,r)=>(e=new pu(e,r),t=new pu(t,r),e.intersects(t,r));var mp=dp;const gp=on,wp=ue;var vp=(e,t,r)=>{const n=[];let s=null,i=null;const u=e.sort((y,b)=>wp(y,b,r));for(const y of u)gp(y,t,r)?(i=y,s||(s=y)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);const c=[];for(const[y,b]of n)y===b?c.push(y):!b&&y===u[0]?c.push("*"):b?y===u[0]?c.push(`<=${b}`):c.push(`${y} - ${b}`):c.push(`>=${y}`);const p=c.join(" || "),g=typeof t.raw=="string"?t.raw:String(t);return p.length<g.length?p:t};const fu=he(),Gi=sn(),{ANY:Ki}=Gi,Cr=on,Fi=ue,yp=(e,t,r={})=>{if(e===t)return!0;e=new fu(e,r),t=new fu(t,r);let n=!1;t:for(const s of e.set){for(const i of t.set){const u=Ip(s,i,r);if(n=n||u!==null,u)continue t}if(n)return!1}return!0},Ep=[new Gi(">=0.0.0-0")],du=[new Gi(">=0.0.0")],Ip=(e,t,r)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===Ki){if(t.length===1&&t[0].semver===Ki)return!0;r.includePrerelease?e=Ep:e=du}if(t.length===1&&t[0].semver===Ki){if(r.includePrerelease)return!0;t=du}const n=new Set;let s,i;for(const S of e)S.operator===">"||S.operator===">="?s=mu(s,S,r):S.operator==="<"||S.operator==="<="?i=gu(i,S,r):n.add(S.semver);if(n.size>1)return null;let u;if(s&&i&&(u=Fi(s.semver,i.semver,r),u>0||u===0&&(s.operator!==">="||i.operator!=="<=")))return null;for(const S of n){if(s&&!Cr(S,String(s),r)||i&&!Cr(S,String(i),r))return null;for(const T of t)if(!Cr(S,String(T),r))return!1;return!0}let c,p,g,y,b=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,O=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1;b&&b.prerelease.length===1&&i.operator==="<"&&b.prerelease[0]===0&&(b=!1);for(const S of t){if(y=y||S.operator===">"||S.operator===">=",g=g||S.operator==="<"||S.operator==="<=",s){if(O&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===O.major&&S.semver.minor===O.minor&&S.semver.patch===O.patch&&(O=!1),S.operator===">"||S.operator===">="){if(c=mu(s,S,r),c===S&&c!==s)return!1}else if(s.operator===">="&&!Cr(s.semver,String(S),r))return!1}if(i){if(b&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===b.major&&S.semver.minor===b.minor&&S.semver.patch===b.patch&&(b=!1),S.operator==="<"||S.operator==="<="){if(p=gu(i,S,r),p===S&&p!==i)return!1}else if(i.operator==="<="&&!Cr(i.semver,String(S),r))return!1}if(!S.operator&&(i||s)&&u!==0)return!1}return!(s&&g&&!i&&u!==0||i&&y&&!s&&u!==0||O||b)},mu=(e,t,r)=>{if(!e)return t;const n=Fi(e.semver,t.semver,r);return n>0?e:n<0||t.operator===">"&&e.operator===">="?t:e},gu=(e,t,r)=>{if(!e)return t;const n=Fi(e.semver,t.semver,r);return n<0?e:n>0||t.operator==="<"&&e.operator==="<="?t:e};var bp=yp;const Wi=Rr,wu=Yr,Sp=Zt,vu=Fo,_p=ar,Tp=_c,Pp=Oc,Op=Ac,Mp=kc,Ap=Uc,Np=Lc,kp=$c,Rp=Fc,xp=ue,Up=Xc,Cp=Yc,Hp=ki,Lp=tl,Dp=nl,Bp=tn,$p=Ri,Gp=Qo,Kp=Jo,Fp=xi,Wp=Ui,Vp=tu,qp=Pl,Xp=sn(),jp=he(),zp=on,Yp=$l,Zp=Wl,Qp=jl,Jp=Zl,tf=tp,ef=$i,rf=cp,nf=fp,sf=mp,of=vp,uf=bp;var af={parse:_p,valid:Tp,clean:Pp,inc:Op,diff:Mp,major:Ap,minor:Np,patch:kp,prerelease:Rp,compare:xp,rcompare:Up,compareLoose:Cp,compareBuild:Hp,sort:Lp,rsort:Dp,gt:Bp,lt:$p,eq:Gp,neq:Kp,gte:Fp,lte:Wp,cmp:Vp,coerce:qp,Comparator:Xp,Range:jp,satisfies:zp,toComparators:Yp,maxSatisfying:Zp,minSatisfying:Qp,minVersion:Jp,validRange:tf,outside:ef,gtr:rf,ltr:nf,intersects:sf,simplifyRange:of,subset:uf,SemVer:Sp,re:Wi.re,src:Wi.src,tokens:Wi.t,SEMVER_SPEC_VERSION:wu.SEMVER_SPEC_VERSION,RELEASE_TYPES:wu.RELEASE_TYPES,compareIdentifiers:vu.compareIdentifiers,rcompareIdentifiers:vu.rcompareIdentifiers};const Vi=Xr(af);var ee={},lr={},pr={},un={};Object.defineProperty(un,"__esModule",{value:!0});const qi=jr(),hf=Uo();function cf(e){const t=qi("sha256").update(e).digest();try{return qi("rmd160").update(t).digest()}catch{return qi("ripemd160").update(t).digest()}}un.hash160=cf;function lf(e,t){return hf("sha512",e).update(t).digest()}un.hmacSHA512=lf;var an=zr.Buffer;function pf(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),i=s.charCodeAt(0);if(t[i]!==255)throw new TypeError(s+" is ambiguous");t[i]=n}var u=e.length,c=e.charAt(0),p=Math.log(u)/Math.log(256),g=Math.log(256)/Math.log(u);function y(S){if((Array.isArray(S)||S instanceof Uint8Array)&&(S=an.from(S)),!an.isBuffer(S))throw new TypeError("Expected Buffer");if(S.length===0)return"";for(var T=0,H=0,x=0,L=S.length;x!==L&&S[x]===0;)x++,T++;for(var M=(L-x)*g+1>>>0,N=new Uint8Array(M);x!==L;){for(var R=S[x],G=0,C=M-1;(R!==0||G<H)&&C!==-1;C--,G++)R+=256*N[C]>>>0,N[C]=R%u>>>0,R=R/u>>>0;if(R!==0)throw new Error("Non-zero carry");H=G,x++}for(var $=M-H;$!==M&&N[$]===0;)$++;for(var K=c.repeat(T);$<M;++$)K+=e.charAt(N[$]);return K}function b(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return an.alloc(0);for(var T=0,H=0,x=0;S[T]===c;)H++,T++;for(var L=(S.length-T)*p+1>>>0,M=new Uint8Array(L);S[T];){var N=t[S.charCodeAt(T)];if(N===255)return;for(var R=0,G=L-1;(N!==0||R<x)&&G!==-1;G--,R++)N+=u*M[G]>>>0,M[G]=N%256>>>0,N=N/256>>>0;if(N!==0)throw new Error("Non-zero carry");x=R,T++}for(var C=L-x;C!==L&&M[C]===0;)C++;var $=an.allocUnsafe(H+(L-C));$.fill(0,0,H);for(var K=H;C!==L;)$[K++]=M[C++];return $}function O(S){var T=b(S);if(T)return T;throw new Error("Non-base"+u+" character")}return{encode:y,decodeUnsafe:b,decode:O}}var ff=pf,df=ff,mf="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",gf=df(mf),Xi=gf,wf=zr.Buffer,vf=function(e){function t(i){var u=e(i);return Xi.encode(wf.concat([i,u],i.length+4))}function r(i){var u=i.slice(0,-4),c=i.slice(-4),p=e(u);if(!(c[0]^p[0]|c[1]^p[1]|c[2]^p[2]|c[3]^p[3]))return u}function n(i){var u=Xi.decodeUnsafe(i);if(u)return r(u)}function s(i){var u=Xi.decode(i),c=r(u);if(!c)throw new Error("Invalid checksum");return c}return{encode:t,decode:s,decodeUnsafe:n}},yu=jr(),yf=vf;function Ef(e){var t=yu("sha256").update(e).digest();return yu("sha256").update(t).digest()}var If=yf(Ef),ji={exports:{}};ji.exports,function(e){(function(t,r){function n(o,h){if(!o)throw new Error(h||"Assertion failed")}function s(o,h){o.super_=h;var l=function(){};l.prototype=h.prototype,o.prototype=new l,o.prototype.constructor=o}function i(o,h,l){if(i.isBN(o))return o;this.negative=0,this.words=null,this.length=0,this.red=null,o!==null&&((h==="le"||h==="be")&&(l=h,h=10),this._init(o||0,h||10,l||"be"))}typeof t=="object"?t.exports=i:r.BN=i,i.BN=i,i.wordSize=26;var u;try{typeof window<"u"&&typeof window.Buffer<"u"?u=window.Buffer:u=tc.Buffer}catch{}i.isBN=function(o){return o instanceof i?!0:o!==null&&typeof o=="object"&&o.constructor.wordSize===i.wordSize&&Array.isArray(o.words)},i.max=function(o,h){return o.cmp(h)>0?o:h},i.min=function(o,h){return o.cmp(h)<0?o:h},i.prototype._init=function(o,h,l){if(typeof o=="number")return this._initNumber(o,h,l);if(typeof o=="object")return this._initArray(o,h,l);h==="hex"&&(h=16),n(h===(h|0)&&h>=2&&h<=36),o=o.toString().replace(/\s+/g,"");var f=0;o[0]==="-"&&(f++,this.negative=1),f<o.length&&(h===16?this._parseHex(o,f,l):(this._parseBase(o,h,f),l==="le"&&this._initArray(this.toArray(),h,l)))},i.prototype._initNumber=function(o,h,l){o<0&&(this.negative=1,o=-o),o<67108864?(this.words=[o&67108863],this.length=1):o<4503599627370496?(this.words=[o&67108863,o/67108864&67108863],this.length=2):(n(o<9007199254740992),this.words=[o&67108863,o/67108864&67108863,1],this.length=3),l==="le"&&this._initArray(this.toArray(),h,l)},i.prototype._initArray=function(o,h,l){if(n(typeof o.length=="number"),o.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(o.length/3),this.words=new Array(this.length);for(var f=0;f<this.length;f++)this.words[f]=0;var w,E,I=0;if(l==="be")for(f=o.length-1,w=0;f>=0;f-=3)E=o[f]|o[f-1]<<8|o[f-2]<<16,this.words[w]|=E<<I&67108863,this.words[w+1]=E>>>26-I&67108863,I+=24,I>=26&&(I-=26,w++);else if(l==="le")for(f=0,w=0;f<o.length;f+=3)E=o[f]|o[f+1]<<8|o[f+2]<<16,this.words[w]|=E<<I&67108863,this.words[w+1]=E>>>26-I&67108863,I+=24,I>=26&&(I-=26,w++);return this.strip()};function c(o,h){var l=o.charCodeAt(h);return l>=65&&l<=70?l-55:l>=97&&l<=102?l-87:l-48&15}function p(o,h,l){var f=c(o,l);return l-1>=h&&(f|=c(o,l-1)<<4),f}i.prototype._parseHex=function(o,h,l){this.length=Math.ceil((o.length-h)/6),this.words=new Array(this.length);for(var f=0;f<this.length;f++)this.words[f]=0;var w=0,E=0,I;if(l==="be")for(f=o.length-1;f>=h;f-=2)I=p(o,h,f)<<w,this.words[E]|=I&67108863,w>=18?(w-=18,E+=1,this.words[E]|=I>>>26):w+=8;else{var d=o.length-h;for(f=d%2===0?h+1:h;f<o.length;f+=2)I=p(o,h,f)<<w,this.words[E]|=I&67108863,w>=18?(w-=18,E+=1,this.words[E]|=I>>>26):w+=8}this.strip()};function g(o,h,l,f){for(var w=0,E=Math.min(o.length,l),I=h;I<E;I++){var d=o.charCodeAt(I)-48;w*=f,d>=49?w+=d-49+10:d>=17?w+=d-17+10:w+=d}return w}i.prototype._parseBase=function(o,h,l){this.words=[0],this.length=1;for(var f=0,w=1;w<=67108863;w*=h)f++;f--,w=w/h|0;for(var E=o.length-l,I=E%f,d=Math.min(E,E-I)+l,a=0,v=l;v<d;v+=f)a=g(o,v,v+f,h),this.imuln(w),this.words[0]+a<67108864?this.words[0]+=a:this._iaddn(a);if(I!==0){var A=1;for(a=g(o,v,o.length,h),v=0;v<I;v++)A*=h;this.imuln(A),this.words[0]+a<67108864?this.words[0]+=a:this._iaddn(a)}this.strip()},i.prototype.copy=function(o){o.words=new Array(this.length);for(var h=0;h<this.length;h++)o.words[h]=this.words[h];o.length=this.length,o.negative=this.negative,o.red=this.red},i.prototype.clone=function(){var o=new i(null);return this.copy(o),o},i.prototype._expand=function(o){for(;this.length<o;)this.words[this.length++]=0;return this},i.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},i.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},i.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var y=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],b=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],O=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];i.prototype.toString=function(o,h){o=o||10,h=h|0||1;var l;if(o===16||o==="hex"){l="";for(var f=0,w=0,E=0;E<this.length;E++){var I=this.words[E],d=((I<<f|w)&16777215).toString(16);w=I>>>24-f&16777215,w!==0||E!==this.length-1?l=y[6-d.length]+d+l:l=d+l,f+=2,f>=26&&(f-=26,E--)}for(w!==0&&(l=w.toString(16)+l);l.length%h!==0;)l="0"+l;return this.negative!==0&&(l="-"+l),l}if(o===(o|0)&&o>=2&&o<=36){var a=b[o],v=O[o];l="";var A=this.clone();for(A.negative=0;!A.isZero();){var _=A.modn(v).toString(o);A=A.idivn(v),A.isZero()?l=_+l:l=y[a-_.length]+_+l}for(this.isZero()&&(l="0"+l);l.length%h!==0;)l="0"+l;return this.negative!==0&&(l="-"+l),l}n(!1,"Base should be between 2 and 36")},i.prototype.toNumber=function(){var o=this.words[0];return this.length===2?o+=this.words[1]*67108864:this.length===3&&this.words[2]===1?o+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-o:o},i.prototype.toJSON=function(){return this.toString(16)},i.prototype.toBuffer=function(o,h){return n(typeof u<"u"),this.toArrayLike(u,o,h)},i.prototype.toArray=function(o,h){return this.toArrayLike(Array,o,h)},i.prototype.toArrayLike=function(o,h,l){var f=this.byteLength(),w=l||Math.max(1,f);n(f<=w,"byte array longer than desired length"),n(w>0,"Requested array length <= 0"),this.strip();var E=h==="le",I=new o(w),d,a,v=this.clone();if(E){for(a=0;!v.isZero();a++)d=v.andln(255),v.iushrn(8),I[a]=d;for(;a<w;a++)I[a]=0}else{for(a=0;a<w-f;a++)I[a]=0;for(a=0;!v.isZero();a++)d=v.andln(255),v.iushrn(8),I[w-a-1]=d}return I},Math.clz32?i.prototype._countBits=function(o){return 32-Math.clz32(o)}:i.prototype._countBits=function(o){var h=o,l=0;return h>=4096&&(l+=13,h>>>=13),h>=64&&(l+=7,h>>>=7),h>=8&&(l+=4,h>>>=4),h>=2&&(l+=2,h>>>=2),l+h},i.prototype._zeroBits=function(o){if(o===0)return 26;var h=o,l=0;return h&8191||(l+=13,h>>>=13),h&127||(l+=7,h>>>=7),h&15||(l+=4,h>>>=4),h&3||(l+=2,h>>>=2),h&1||l++,l},i.prototype.bitLength=function(){var o=this.words[this.length-1],h=this._countBits(o);return(this.length-1)*26+h};function S(o){for(var h=new Array(o.bitLength()),l=0;l<h.length;l++){var f=l/26|0,w=l%26;h[l]=(o.words[f]&1<<w)>>>w}return h}i.prototype.zeroBits=function(){if(this.isZero())return 0;for(var o=0,h=0;h<this.length;h++){var l=this._zeroBits(this.words[h]);if(o+=l,l!==26)break}return o},i.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},i.prototype.toTwos=function(o){return this.negative!==0?this.abs().inotn(o).iaddn(1):this.clone()},i.prototype.fromTwos=function(o){return this.testn(o-1)?this.notn(o).iaddn(1).ineg():this.clone()},i.prototype.isNeg=function(){return this.negative!==0},i.prototype.neg=function(){return this.clone().ineg()},i.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},i.prototype.iuor=function(o){for(;this.length<o.length;)this.words[this.length++]=0;for(var h=0;h<o.length;h++)this.words[h]=this.words[h]|o.words[h];return this.strip()},i.prototype.ior=function(o){return n((this.negative|o.negative)===0),this.iuor(o)},i.prototype.or=function(o){return this.length>o.length?this.clone().ior(o):o.clone().ior(this)},i.prototype.uor=function(o){return this.length>o.length?this.clone().iuor(o):o.clone().iuor(this)},i.prototype.iuand=function(o){var h;this.length>o.length?h=o:h=this;for(var l=0;l<h.length;l++)this.words[l]=this.words[l]&o.words[l];return this.length=h.length,this.strip()},i.prototype.iand=function(o){return n((this.negative|o.negative)===0),this.iuand(o)},i.prototype.and=function(o){return this.length>o.length?this.clone().iand(o):o.clone().iand(this)},i.prototype.uand=function(o){return this.length>o.length?this.clone().iuand(o):o.clone().iuand(this)},i.prototype.iuxor=function(o){var h,l;this.length>o.length?(h=this,l=o):(h=o,l=this);for(var f=0;f<l.length;f++)this.words[f]=h.words[f]^l.words[f];if(this!==h)for(;f<h.length;f++)this.words[f]=h.words[f];return this.length=h.length,this.strip()},i.prototype.ixor=function(o){return n((this.negative|o.negative)===0),this.iuxor(o)},i.prototype.xor=function(o){return this.length>o.length?this.clone().ixor(o):o.clone().ixor(this)},i.prototype.uxor=function(o){return this.length>o.length?this.clone().iuxor(o):o.clone().iuxor(this)},i.prototype.inotn=function(o){n(typeof o=="number"&&o>=0);var h=Math.ceil(o/26)|0,l=o%26;this._expand(h),l>0&&h--;for(var f=0;f<h;f++)this.words[f]=~this.words[f]&67108863;return l>0&&(this.words[f]=~this.words[f]&67108863>>26-l),this.strip()},i.prototype.notn=function(o){return this.clone().inotn(o)},i.prototype.setn=function(o,h){n(typeof o=="number"&&o>=0);var l=o/26|0,f=o%26;return this._expand(l+1),h?this.words[l]=this.words[l]|1<<f:this.words[l]=this.words[l]&~(1<<f),this.strip()},i.prototype.iadd=function(o){var h;if(this.negative!==0&&o.negative===0)return this.negative=0,h=this.isub(o),this.negative^=1,this._normSign();if(this.negative===0&&o.negative!==0)return o.negative=0,h=this.isub(o),o.negative=1,h._normSign();var l,f;this.length>o.length?(l=this,f=o):(l=o,f=this);for(var w=0,E=0;E<f.length;E++)h=(l.words[E]|0)+(f.words[E]|0)+w,this.words[E]=h&67108863,w=h>>>26;for(;w!==0&&E<l.length;E++)h=(l.words[E]|0)+w,this.words[E]=h&67108863,w=h>>>26;if(this.length=l.length,w!==0)this.words[this.length]=w,this.length++;else if(l!==this)for(;E<l.length;E++)this.words[E]=l.words[E];return this},i.prototype.add=function(o){var h;return o.negative!==0&&this.negative===0?(o.negative=0,h=this.sub(o),o.negative^=1,h):o.negative===0&&this.negative!==0?(this.negative=0,h=o.sub(this),this.negative=1,h):this.length>o.length?this.clone().iadd(o):o.clone().iadd(this)},i.prototype.isub=function(o){if(o.negative!==0){o.negative=0;var h=this.iadd(o);return o.negative=1,h._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(o),this.negative=1,this._normSign();var l=this.cmp(o);if(l===0)return this.negative=0,this.length=1,this.words[0]=0,this;var f,w;l>0?(f=this,w=o):(f=o,w=this);for(var E=0,I=0;I<w.length;I++)h=(f.words[I]|0)-(w.words[I]|0)+E,E=h>>26,this.words[I]=h&67108863;for(;E!==0&&I<f.length;I++)h=(f.words[I]|0)+E,E=h>>26,this.words[I]=h&67108863;if(E===0&&I<f.length&&f!==this)for(;I<f.length;I++)this.words[I]=f.words[I];return this.length=Math.max(this.length,I),f!==this&&(this.negative=1),this.strip()},i.prototype.sub=function(o){return this.clone().isub(o)};function T(o,h,l){l.negative=h.negative^o.negative;var f=o.length+h.length|0;l.length=f,f=f-1|0;var w=o.words[0]|0,E=h.words[0]|0,I=w*E,d=I&67108863,a=I/67108864|0;l.words[0]=d;for(var v=1;v<f;v++){for(var A=a>>>26,_=a&67108863,P=Math.min(v,h.length-1),U=Math.max(0,v-o.length+1);U<=P;U++){var D=v-U|0;w=o.words[D]|0,E=h.words[U]|0,I=w*E+_,A+=I/67108864|0,_=I&67108863}l.words[v]=_|0,a=A|0}return a!==0?l.words[v]=a|0:l.length--,l.strip()}var H=function(o,h,l){var f=o.words,w=h.words,E=l.words,I=0,d,a,v,A=f[0]|0,_=A&8191,P=A>>>13,U=f[1]|0,D=U&8191,q=U>>>13,ie=f[2]|0,rt=ie&8191,nt=ie>>>13,wo=f[3]|0,ot=wo&8191,ut=wo>>>13,vo=f[4]|0,at=vo&8191,ht=vo>>>13,yo=f[5]|0,ct=yo&8191,lt=yo>>>13,Eo=f[6]|0,pt=Eo&8191,ft=Eo>>>13,Io=f[7]|0,dt=Io&8191,mt=Io>>>13,bo=f[8]|0,gt=bo&8191,wt=bo>>>13,So=f[9]|0,vt=So&8191,yt=So>>>13,_o=w[0]|0,Et=_o&8191,It=_o>>>13,To=w[1]|0,bt=To&8191,St=To>>>13,Po=w[2]|0,_t=Po&8191,Tt=Po>>>13,Oo=w[3]|0,Pt=Oo&8191,Ot=Oo>>>13,Mo=w[4]|0,Mt=Mo&8191,At=Mo>>>13,Ao=w[5]|0,Nt=Ao&8191,kt=Ao>>>13,No=w[6]|0,Rt=No&8191,xt=No>>>13,ko=w[7]|0,Ut=ko&8191,Ct=ko>>>13,Ro=w[8]|0,Ht=Ro&8191,Lt=Ro>>>13,xo=w[9]|0,Dt=xo&8191,Bt=xo>>>13;l.negative=o.negative^h.negative,l.length=19,d=Math.imul(_,Et),a=Math.imul(_,It),a=a+Math.imul(P,Et)|0,v=Math.imul(P,It);var si=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(si>>>26)|0,si&=67108863,d=Math.imul(D,Et),a=Math.imul(D,It),a=a+Math.imul(q,Et)|0,v=Math.imul(q,It),d=d+Math.imul(_,bt)|0,a=a+Math.imul(_,St)|0,a=a+Math.imul(P,bt)|0,v=v+Math.imul(P,St)|0;var oi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(oi>>>26)|0,oi&=67108863,d=Math.imul(rt,Et),a=Math.imul(rt,It),a=a+Math.imul(nt,Et)|0,v=Math.imul(nt,It),d=d+Math.imul(D,bt)|0,a=a+Math.imul(D,St)|0,a=a+Math.imul(q,bt)|0,v=v+Math.imul(q,St)|0,d=d+Math.imul(_,_t)|0,a=a+Math.imul(_,Tt)|0,a=a+Math.imul(P,_t)|0,v=v+Math.imul(P,Tt)|0;var ui=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(ui>>>26)|0,ui&=67108863,d=Math.imul(ot,Et),a=Math.imul(ot,It),a=a+Math.imul(ut,Et)|0,v=Math.imul(ut,It),d=d+Math.imul(rt,bt)|0,a=a+Math.imul(rt,St)|0,a=a+Math.imul(nt,bt)|0,v=v+Math.imul(nt,St)|0,d=d+Math.imul(D,_t)|0,a=a+Math.imul(D,Tt)|0,a=a+Math.imul(q,_t)|0,v=v+Math.imul(q,Tt)|0,d=d+Math.imul(_,Pt)|0,a=a+Math.imul(_,Ot)|0,a=a+Math.imul(P,Pt)|0,v=v+Math.imul(P,Ot)|0;var ai=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(ai>>>26)|0,ai&=67108863,d=Math.imul(at,Et),a=Math.imul(at,It),a=a+Math.imul(ht,Et)|0,v=Math.imul(ht,It),d=d+Math.imul(ot,bt)|0,a=a+Math.imul(ot,St)|0,a=a+Math.imul(ut,bt)|0,v=v+Math.imul(ut,St)|0,d=d+Math.imul(rt,_t)|0,a=a+Math.imul(rt,Tt)|0,a=a+Math.imul(nt,_t)|0,v=v+Math.imul(nt,Tt)|0,d=d+Math.imul(D,Pt)|0,a=a+Math.imul(D,Ot)|0,a=a+Math.imul(q,Pt)|0,v=v+Math.imul(q,Ot)|0,d=d+Math.imul(_,Mt)|0,a=a+Math.imul(_,At)|0,a=a+Math.imul(P,Mt)|0,v=v+Math.imul(P,At)|0;var hi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(hi>>>26)|0,hi&=67108863,d=Math.imul(ct,Et),a=Math.imul(ct,It),a=a+Math.imul(lt,Et)|0,v=Math.imul(lt,It),d=d+Math.imul(at,bt)|0,a=a+Math.imul(at,St)|0,a=a+Math.imul(ht,bt)|0,v=v+Math.imul(ht,St)|0,d=d+Math.imul(ot,_t)|0,a=a+Math.imul(ot,Tt)|0,a=a+Math.imul(ut,_t)|0,v=v+Math.imul(ut,Tt)|0,d=d+Math.imul(rt,Pt)|0,a=a+Math.imul(rt,Ot)|0,a=a+Math.imul(nt,Pt)|0,v=v+Math.imul(nt,Ot)|0,d=d+Math.imul(D,Mt)|0,a=a+Math.imul(D,At)|0,a=a+Math.imul(q,Mt)|0,v=v+Math.imul(q,At)|0,d=d+Math.imul(_,Nt)|0,a=a+Math.imul(_,kt)|0,a=a+Math.imul(P,Nt)|0,v=v+Math.imul(P,kt)|0;var ci=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(ci>>>26)|0,ci&=67108863,d=Math.imul(pt,Et),a=Math.imul(pt,It),a=a+Math.imul(ft,Et)|0,v=Math.imul(ft,It),d=d+Math.imul(ct,bt)|0,a=a+Math.imul(ct,St)|0,a=a+Math.imul(lt,bt)|0,v=v+Math.imul(lt,St)|0,d=d+Math.imul(at,_t)|0,a=a+Math.imul(at,Tt)|0,a=a+Math.imul(ht,_t)|0,v=v+Math.imul(ht,Tt)|0,d=d+Math.imul(ot,Pt)|0,a=a+Math.imul(ot,Ot)|0,a=a+Math.imul(ut,Pt)|0,v=v+Math.imul(ut,Ot)|0,d=d+Math.imul(rt,Mt)|0,a=a+Math.imul(rt,At)|0,a=a+Math.imul(nt,Mt)|0,v=v+Math.imul(nt,At)|0,d=d+Math.imul(D,Nt)|0,a=a+Math.imul(D,kt)|0,a=a+Math.imul(q,Nt)|0,v=v+Math.imul(q,kt)|0,d=d+Math.imul(_,Rt)|0,a=a+Math.imul(_,xt)|0,a=a+Math.imul(P,Rt)|0,v=v+Math.imul(P,xt)|0;var li=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(li>>>26)|0,li&=67108863,d=Math.imul(dt,Et),a=Math.imul(dt,It),a=a+Math.imul(mt,Et)|0,v=Math.imul(mt,It),d=d+Math.imul(pt,bt)|0,a=a+Math.imul(pt,St)|0,a=a+Math.imul(ft,bt)|0,v=v+Math.imul(ft,St)|0,d=d+Math.imul(ct,_t)|0,a=a+Math.imul(ct,Tt)|0,a=a+Math.imul(lt,_t)|0,v=v+Math.imul(lt,Tt)|0,d=d+Math.imul(at,Pt)|0,a=a+Math.imul(at,Ot)|0,a=a+Math.imul(ht,Pt)|0,v=v+Math.imul(ht,Ot)|0,d=d+Math.imul(ot,Mt)|0,a=a+Math.imul(ot,At)|0,a=a+Math.imul(ut,Mt)|0,v=v+Math.imul(ut,At)|0,d=d+Math.imul(rt,Nt)|0,a=a+Math.imul(rt,kt)|0,a=a+Math.imul(nt,Nt)|0,v=v+Math.imul(nt,kt)|0,d=d+Math.imul(D,Rt)|0,a=a+Math.imul(D,xt)|0,a=a+Math.imul(q,Rt)|0,v=v+Math.imul(q,xt)|0,d=d+Math.imul(_,Ut)|0,a=a+Math.imul(_,Ct)|0,a=a+Math.imul(P,Ut)|0,v=v+Math.imul(P,Ct)|0;var pi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(pi>>>26)|0,pi&=67108863,d=Math.imul(gt,Et),a=Math.imul(gt,It),a=a+Math.imul(wt,Et)|0,v=Math.imul(wt,It),d=d+Math.imul(dt,bt)|0,a=a+Math.imul(dt,St)|0,a=a+Math.imul(mt,bt)|0,v=v+Math.imul(mt,St)|0,d=d+Math.imul(pt,_t)|0,a=a+Math.imul(pt,Tt)|0,a=a+Math.imul(ft,_t)|0,v=v+Math.imul(ft,Tt)|0,d=d+Math.imul(ct,Pt)|0,a=a+Math.imul(ct,Ot)|0,a=a+Math.imul(lt,Pt)|0,v=v+Math.imul(lt,Ot)|0,d=d+Math.imul(at,Mt)|0,a=a+Math.imul(at,At)|0,a=a+Math.imul(ht,Mt)|0,v=v+Math.imul(ht,At)|0,d=d+Math.imul(ot,Nt)|0,a=a+Math.imul(ot,kt)|0,a=a+Math.imul(ut,Nt)|0,v=v+Math.imul(ut,kt)|0,d=d+Math.imul(rt,Rt)|0,a=a+Math.imul(rt,xt)|0,a=a+Math.imul(nt,Rt)|0,v=v+Math.imul(nt,xt)|0,d=d+Math.imul(D,Ut)|0,a=a+Math.imul(D,Ct)|0,a=a+Math.imul(q,Ut)|0,v=v+Math.imul(q,Ct)|0,d=d+Math.imul(_,Ht)|0,a=a+Math.imul(_,Lt)|0,a=a+Math.imul(P,Ht)|0,v=v+Math.imul(P,Lt)|0;var fi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(fi>>>26)|0,fi&=67108863,d=Math.imul(vt,Et),a=Math.imul(vt,It),a=a+Math.imul(yt,Et)|0,v=Math.imul(yt,It),d=d+Math.imul(gt,bt)|0,a=a+Math.imul(gt,St)|0,a=a+Math.imul(wt,bt)|0,v=v+Math.imul(wt,St)|0,d=d+Math.imul(dt,_t)|0,a=a+Math.imul(dt,Tt)|0,a=a+Math.imul(mt,_t)|0,v=v+Math.imul(mt,Tt)|0,d=d+Math.imul(pt,Pt)|0,a=a+Math.imul(pt,Ot)|0,a=a+Math.imul(ft,Pt)|0,v=v+Math.imul(ft,Ot)|0,d=d+Math.imul(ct,Mt)|0,a=a+Math.imul(ct,At)|0,a=a+Math.imul(lt,Mt)|0,v=v+Math.imul(lt,At)|0,d=d+Math.imul(at,Nt)|0,a=a+Math.imul(at,kt)|0,a=a+Math.imul(ht,Nt)|0,v=v+Math.imul(ht,kt)|0,d=d+Math.imul(ot,Rt)|0,a=a+Math.imul(ot,xt)|0,a=a+Math.imul(ut,Rt)|0,v=v+Math.imul(ut,xt)|0,d=d+Math.imul(rt,Ut)|0,a=a+Math.imul(rt,Ct)|0,a=a+Math.imul(nt,Ut)|0,v=v+Math.imul(nt,Ct)|0,d=d+Math.imul(D,Ht)|0,a=a+Math.imul(D,Lt)|0,a=a+Math.imul(q,Ht)|0,v=v+Math.imul(q,Lt)|0,d=d+Math.imul(_,Dt)|0,a=a+Math.imul(_,Bt)|0,a=a+Math.imul(P,Dt)|0,v=v+Math.imul(P,Bt)|0;var di=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(di>>>26)|0,di&=67108863,d=Math.imul(vt,bt),a=Math.imul(vt,St),a=a+Math.imul(yt,bt)|0,v=Math.imul(yt,St),d=d+Math.imul(gt,_t)|0,a=a+Math.imul(gt,Tt)|0,a=a+Math.imul(wt,_t)|0,v=v+Math.imul(wt,Tt)|0,d=d+Math.imul(dt,Pt)|0,a=a+Math.imul(dt,Ot)|0,a=a+Math.imul(mt,Pt)|0,v=v+Math.imul(mt,Ot)|0,d=d+Math.imul(pt,Mt)|0,a=a+Math.imul(pt,At)|0,a=a+Math.imul(ft,Mt)|0,v=v+Math.imul(ft,At)|0,d=d+Math.imul(ct,Nt)|0,a=a+Math.imul(ct,kt)|0,a=a+Math.imul(lt,Nt)|0,v=v+Math.imul(lt,kt)|0,d=d+Math.imul(at,Rt)|0,a=a+Math.imul(at,xt)|0,a=a+Math.imul(ht,Rt)|0,v=v+Math.imul(ht,xt)|0,d=d+Math.imul(ot,Ut)|0,a=a+Math.imul(ot,Ct)|0,a=a+Math.imul(ut,Ut)|0,v=v+Math.imul(ut,Ct)|0,d=d+Math.imul(rt,Ht)|0,a=a+Math.imul(rt,Lt)|0,a=a+Math.imul(nt,Ht)|0,v=v+Math.imul(nt,Lt)|0,d=d+Math.imul(D,Dt)|0,a=a+Math.imul(D,Bt)|0,a=a+Math.imul(q,Dt)|0,v=v+Math.imul(q,Bt)|0;var mi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(mi>>>26)|0,mi&=67108863,d=Math.imul(vt,_t),a=Math.imul(vt,Tt),a=a+Math.imul(yt,_t)|0,v=Math.imul(yt,Tt),d=d+Math.imul(gt,Pt)|0,a=a+Math.imul(gt,Ot)|0,a=a+Math.imul(wt,Pt)|0,v=v+Math.imul(wt,Ot)|0,d=d+Math.imul(dt,Mt)|0,a=a+Math.imul(dt,At)|0,a=a+Math.imul(mt,Mt)|0,v=v+Math.imul(mt,At)|0,d=d+Math.imul(pt,Nt)|0,a=a+Math.imul(pt,kt)|0,a=a+Math.imul(ft,Nt)|0,v=v+Math.imul(ft,kt)|0,d=d+Math.imul(ct,Rt)|0,a=a+Math.imul(ct,xt)|0,a=a+Math.imul(lt,Rt)|0,v=v+Math.imul(lt,xt)|0,d=d+Math.imul(at,Ut)|0,a=a+Math.imul(at,Ct)|0,a=a+Math.imul(ht,Ut)|0,v=v+Math.imul(ht,Ct)|0,d=d+Math.imul(ot,Ht)|0,a=a+Math.imul(ot,Lt)|0,a=a+Math.imul(ut,Ht)|0,v=v+Math.imul(ut,Lt)|0,d=d+Math.imul(rt,Dt)|0,a=a+Math.imul(rt,Bt)|0,a=a+Math.imul(nt,Dt)|0,v=v+Math.imul(nt,Bt)|0;var gi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(gi>>>26)|0,gi&=67108863,d=Math.imul(vt,Pt),a=Math.imul(vt,Ot),a=a+Math.imul(yt,Pt)|0,v=Math.imul(yt,Ot),d=d+Math.imul(gt,Mt)|0,a=a+Math.imul(gt,At)|0,a=a+Math.imul(wt,Mt)|0,v=v+Math.imul(wt,At)|0,d=d+Math.imul(dt,Nt)|0,a=a+Math.imul(dt,kt)|0,a=a+Math.imul(mt,Nt)|0,v=v+Math.imul(mt,kt)|0,d=d+Math.imul(pt,Rt)|0,a=a+Math.imul(pt,xt)|0,a=a+Math.imul(ft,Rt)|0,v=v+Math.imul(ft,xt)|0,d=d+Math.imul(ct,Ut)|0,a=a+Math.imul(ct,Ct)|0,a=a+Math.imul(lt,Ut)|0,v=v+Math.imul(lt,Ct)|0,d=d+Math.imul(at,Ht)|0,a=a+Math.imul(at,Lt)|0,a=a+Math.imul(ht,Ht)|0,v=v+Math.imul(ht,Lt)|0,d=d+Math.imul(ot,Dt)|0,a=a+Math.imul(ot,Bt)|0,a=a+Math.imul(ut,Dt)|0,v=v+Math.imul(ut,Bt)|0;var wi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(wi>>>26)|0,wi&=67108863,d=Math.imul(vt,Mt),a=Math.imul(vt,At),a=a+Math.imul(yt,Mt)|0,v=Math.imul(yt,At),d=d+Math.imul(gt,Nt)|0,a=a+Math.imul(gt,kt)|0,a=a+Math.imul(wt,Nt)|0,v=v+Math.imul(wt,kt)|0,d=d+Math.imul(dt,Rt)|0,a=a+Math.imul(dt,xt)|0,a=a+Math.imul(mt,Rt)|0,v=v+Math.imul(mt,xt)|0,d=d+Math.imul(pt,Ut)|0,a=a+Math.imul(pt,Ct)|0,a=a+Math.imul(ft,Ut)|0,v=v+Math.imul(ft,Ct)|0,d=d+Math.imul(ct,Ht)|0,a=a+Math.imul(ct,Lt)|0,a=a+Math.imul(lt,Ht)|0,v=v+Math.imul(lt,Lt)|0,d=d+Math.imul(at,Dt)|0,a=a+Math.imul(at,Bt)|0,a=a+Math.imul(ht,Dt)|0,v=v+Math.imul(ht,Bt)|0;var vi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(vi>>>26)|0,vi&=67108863,d=Math.imul(vt,Nt),a=Math.imul(vt,kt),a=a+Math.imul(yt,Nt)|0,v=Math.imul(yt,kt),d=d+Math.imul(gt,Rt)|0,a=a+Math.imul(gt,xt)|0,a=a+Math.imul(wt,Rt)|0,v=v+Math.imul(wt,xt)|0,d=d+Math.imul(dt,Ut)|0,a=a+Math.imul(dt,Ct)|0,a=a+Math.imul(mt,Ut)|0,v=v+Math.imul(mt,Ct)|0,d=d+Math.imul(pt,Ht)|0,a=a+Math.imul(pt,Lt)|0,a=a+Math.imul(ft,Ht)|0,v=v+Math.imul(ft,Lt)|0,d=d+Math.imul(ct,Dt)|0,a=a+Math.imul(ct,Bt)|0,a=a+Math.imul(lt,Dt)|0,v=v+Math.imul(lt,Bt)|0;var yi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(yi>>>26)|0,yi&=67108863,d=Math.imul(vt,Rt),a=Math.imul(vt,xt),a=a+Math.imul(yt,Rt)|0,v=Math.imul(yt,xt),d=d+Math.imul(gt,Ut)|0,a=a+Math.imul(gt,Ct)|0,a=a+Math.imul(wt,Ut)|0,v=v+Math.imul(wt,Ct)|0,d=d+Math.imul(dt,Ht)|0,a=a+Math.imul(dt,Lt)|0,a=a+Math.imul(mt,Ht)|0,v=v+Math.imul(mt,Lt)|0,d=d+Math.imul(pt,Dt)|0,a=a+Math.imul(pt,Bt)|0,a=a+Math.imul(ft,Dt)|0,v=v+Math.imul(ft,Bt)|0;var Ei=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(Ei>>>26)|0,Ei&=67108863,d=Math.imul(vt,Ut),a=Math.imul(vt,Ct),a=a+Math.imul(yt,Ut)|0,v=Math.imul(yt,Ct),d=d+Math.imul(gt,Ht)|0,a=a+Math.imul(gt,Lt)|0,a=a+Math.imul(wt,Ht)|0,v=v+Math.imul(wt,Lt)|0,d=d+Math.imul(dt,Dt)|0,a=a+Math.imul(dt,Bt)|0,a=a+Math.imul(mt,Dt)|0,v=v+Math.imul(mt,Bt)|0;var Ii=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(Ii>>>26)|0,Ii&=67108863,d=Math.imul(vt,Ht),a=Math.imul(vt,Lt),a=a+Math.imul(yt,Ht)|0,v=Math.imul(yt,Lt),d=d+Math.imul(gt,Dt)|0,a=a+Math.imul(gt,Bt)|0,a=a+Math.imul(wt,Dt)|0,v=v+Math.imul(wt,Bt)|0;var bi=(I+d|0)+((a&8191)<<13)|0;I=(v+(a>>>13)|0)+(bi>>>26)|0,bi&=67108863,d=Math.imul(vt,Dt),a=Math.imul(vt,Bt),a=a+Math.imul(yt,Dt)|0,v=Math.imul(yt,Bt);var Si=(I+d|0)+((a&8191)<<13)|0;return I=(v+(a>>>13)|0)+(Si>>>26)|0,Si&=67108863,E[0]=si,E[1]=oi,E[2]=ui,E[3]=ai,E[4]=hi,E[5]=ci,E[6]=li,E[7]=pi,E[8]=fi,E[9]=di,E[10]=mi,E[11]=gi,E[12]=wi,E[13]=vi,E[14]=yi,E[15]=Ei,E[16]=Ii,E[17]=bi,E[18]=Si,I!==0&&(E[19]=I,l.length++),l};Math.imul||(H=T);function x(o,h,l){l.negative=h.negative^o.negative,l.length=o.length+h.length;for(var f=0,w=0,E=0;E<l.length-1;E++){var I=w;w=0;for(var d=f&67108863,a=Math.min(E,h.length-1),v=Math.max(0,E-o.length+1);v<=a;v++){var A=E-v,_=o.words[A]|0,P=h.words[v]|0,U=_*P,D=U&67108863;I=I+(U/67108864|0)|0,D=D+d|0,d=D&67108863,I=I+(D>>>26)|0,w+=I>>>26,I&=67108863}l.words[E]=d,f=I,I=w}return f!==0?l.words[E]=f:l.length--,l.strip()}function L(o,h,l){var f=new M;return f.mulp(o,h,l)}i.prototype.mulTo=function(o,h){var l,f=this.length+o.length;return this.length===10&&o.length===10?l=H(this,o,h):f<63?l=T(this,o,h):f<1024?l=x(this,o,h):l=L(this,o,h),l};function M(o,h){this.x=o,this.y=h}M.prototype.makeRBT=function(o){for(var h=new Array(o),l=i.prototype._countBits(o)-1,f=0;f<o;f++)h[f]=this.revBin(f,l,o);return h},M.prototype.revBin=function(o,h,l){if(o===0||o===l-1)return o;for(var f=0,w=0;w<h;w++)f|=(o&1)<<h-w-1,o>>=1;return f},M.prototype.permute=function(o,h,l,f,w,E){for(var I=0;I<E;I++)f[I]=h[o[I]],w[I]=l[o[I]]},M.prototype.transform=function(o,h,l,f,w,E){this.permute(E,o,h,l,f,w);for(var I=1;I<w;I<<=1)for(var d=I<<1,a=Math.cos(2*Math.PI/d),v=Math.sin(2*Math.PI/d),A=0;A<w;A+=d)for(var _=a,P=v,U=0;U<I;U++){var D=l[A+U],q=f[A+U],ie=l[A+U+I],rt=f[A+U+I],nt=_*ie-P*rt;rt=_*rt+P*ie,ie=nt,l[A+U]=D+ie,f[A+U]=q+rt,l[A+U+I]=D-ie,f[A+U+I]=q-rt,U!==d&&(nt=a*_-v*P,P=a*P+v*_,_=nt)}},M.prototype.guessLen13b=function(o,h){var l=Math.max(h,o)|1,f=l&1,w=0;for(l=l/2|0;l;l=l>>>1)w++;return 1<<w+1+f},M.prototype.conjugate=function(o,h,l){if(!(l<=1))for(var f=0;f<l/2;f++){var w=o[f];o[f]=o[l-f-1],o[l-f-1]=w,w=h[f],h[f]=-h[l-f-1],h[l-f-1]=-w}},M.prototype.normalize13b=function(o,h){for(var l=0,f=0;f<h/2;f++){var w=Math.round(o[2*f+1]/h)*8192+Math.round(o[2*f]/h)+l;o[f]=w&67108863,w<67108864?l=0:l=w/67108864|0}return o},M.prototype.convert13b=function(o,h,l,f){for(var w=0,E=0;E<h;E++)w=w+(o[E]|0),l[2*E]=w&8191,w=w>>>13,l[2*E+1]=w&8191,w=w>>>13;for(E=2*h;E<f;++E)l[E]=0;n(w===0),n((w&-8192)===0)},M.prototype.stub=function(o){for(var h=new Array(o),l=0;l<o;l++)h[l]=0;return h},M.prototype.mulp=function(o,h,l){var f=2*this.guessLen13b(o.length,h.length),w=this.makeRBT(f),E=this.stub(f),I=new Array(f),d=new Array(f),a=new Array(f),v=new Array(f),A=new Array(f),_=new Array(f),P=l.words;P.length=f,this.convert13b(o.words,o.length,I,f),this.convert13b(h.words,h.length,v,f),this.transform(I,E,d,a,f,w),this.transform(v,E,A,_,f,w);for(var U=0;U<f;U++){var D=d[U]*A[U]-a[U]*_[U];a[U]=d[U]*_[U]+a[U]*A[U],d[U]=D}return this.conjugate(d,a,f),this.transform(d,a,P,E,f,w),this.conjugate(P,E,f),this.normalize13b(P,f),l.negative=o.negative^h.negative,l.length=o.length+h.length,l.strip()},i.prototype.mul=function(o){var h=new i(null);return h.words=new Array(this.length+o.length),this.mulTo(o,h)},i.prototype.mulf=function(o){var h=new i(null);return h.words=new Array(this.length+o.length),L(this,o,h)},i.prototype.imul=function(o){return this.clone().mulTo(o,this)},i.prototype.imuln=function(o){n(typeof o=="number"),n(o<67108864);for(var h=0,l=0;l<this.length;l++){var f=(this.words[l]|0)*o,w=(f&67108863)+(h&67108863);h>>=26,h+=f/67108864|0,h+=w>>>26,this.words[l]=w&67108863}return h!==0&&(this.words[l]=h,this.length++),this},i.prototype.muln=function(o){return this.clone().imuln(o)},i.prototype.sqr=function(){return this.mul(this)},i.prototype.isqr=function(){return this.imul(this.clone())},i.prototype.pow=function(o){var h=S(o);if(h.length===0)return new i(1);for(var l=this,f=0;f<h.length&&h[f]===0;f++,l=l.sqr());if(++f<h.length)for(var w=l.sqr();f<h.length;f++,w=w.sqr())h[f]!==0&&(l=l.mul(w));return l},i.prototype.iushln=function(o){n(typeof o=="number"&&o>=0);var h=o%26,l=(o-h)/26,f=67108863>>>26-h<<26-h,w;if(h!==0){var E=0;for(w=0;w<this.length;w++){var I=this.words[w]&f,d=(this.words[w]|0)-I<<h;this.words[w]=d|E,E=I>>>26-h}E&&(this.words[w]=E,this.length++)}if(l!==0){for(w=this.length-1;w>=0;w--)this.words[w+l]=this.words[w];for(w=0;w<l;w++)this.words[w]=0;this.length+=l}return this.strip()},i.prototype.ishln=function(o){return n(this.negative===0),this.iushln(o)},i.prototype.iushrn=function(o,h,l){n(typeof o=="number"&&o>=0);var f;h?f=(h-h%26)/26:f=0;var w=o%26,E=Math.min((o-w)/26,this.length),I=67108863^67108863>>>w<<w,d=l;if(f-=E,f=Math.max(0,f),d){for(var a=0;a<E;a++)d.words[a]=this.words[a];d.length=E}if(E!==0)if(this.length>E)for(this.length-=E,a=0;a<this.length;a++)this.words[a]=this.words[a+E];else this.words[0]=0,this.length=1;var v=0;for(a=this.length-1;a>=0&&(v!==0||a>=f);a--){var A=this.words[a]|0;this.words[a]=v<<26-w|A>>>w,v=A&I}return d&&v!==0&&(d.words[d.length++]=v),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},i.prototype.ishrn=function(o,h,l){return n(this.negative===0),this.iushrn(o,h,l)},i.prototype.shln=function(o){return this.clone().ishln(o)},i.prototype.ushln=function(o){return this.clone().iushln(o)},i.prototype.shrn=function(o){return this.clone().ishrn(o)},i.prototype.ushrn=function(o){return this.clone().iushrn(o)},i.prototype.testn=function(o){n(typeof o=="number"&&o>=0);var h=o%26,l=(o-h)/26,f=1<<h;if(this.length<=l)return!1;var w=this.words[l];return!!(w&f)},i.prototype.imaskn=function(o){n(typeof o=="number"&&o>=0);var h=o%26,l=(o-h)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=l)return this;if(h!==0&&l++,this.length=Math.min(l,this.length),h!==0){var f=67108863^67108863>>>h<<h;this.words[this.length-1]&=f}return this.strip()},i.prototype.maskn=function(o){return this.clone().imaskn(o)},i.prototype.iaddn=function(o){return n(typeof o=="number"),n(o<67108864),o<0?this.isubn(-o):this.negative!==0?this.length===1&&(this.words[0]|0)<o?(this.words[0]=o-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(o),this.negative=1,this):this._iaddn(o)},i.prototype._iaddn=function(o){this.words[0]+=o;for(var h=0;h<this.length&&this.words[h]>=67108864;h++)this.words[h]-=67108864,h===this.length-1?this.words[h+1]=1:this.words[h+1]++;return this.length=Math.max(this.length,h+1),this},i.prototype.isubn=function(o){if(n(typeof o=="number"),n(o<67108864),o<0)return this.iaddn(-o);if(this.negative!==0)return this.negative=0,this.iaddn(o),this.negative=1,this;if(this.words[0]-=o,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var h=0;h<this.length&&this.words[h]<0;h++)this.words[h]+=67108864,this.words[h+1]-=1;return this.strip()},i.prototype.addn=function(o){return this.clone().iaddn(o)},i.prototype.subn=function(o){return this.clone().isubn(o)},i.prototype.iabs=function(){return this.negative=0,this},i.prototype.abs=function(){return this.clone().iabs()},i.prototype._ishlnsubmul=function(o,h,l){var f=o.length+l,w;this._expand(f);var E,I=0;for(w=0;w<o.length;w++){E=(this.words[w+l]|0)+I;var d=(o.words[w]|0)*h;E-=d&67108863,I=(E>>26)-(d/67108864|0),this.words[w+l]=E&67108863}for(;w<this.length-l;w++)E=(this.words[w+l]|0)+I,I=E>>26,this.words[w+l]=E&67108863;if(I===0)return this.strip();for(n(I===-1),I=0,w=0;w<this.length;w++)E=-(this.words[w]|0)+I,I=E>>26,this.words[w]=E&67108863;return this.negative=1,this.strip()},i.prototype._wordDiv=function(o,h){var l=this.length-o.length,f=this.clone(),w=o,E=w.words[w.length-1]|0,I=this._countBits(E);l=26-I,l!==0&&(w=w.ushln(l),f.iushln(l),E=w.words[w.length-1]|0);var d=f.length-w.length,a;if(h!=="mod"){a=new i(null),a.length=d+1,a.words=new Array(a.length);for(var v=0;v<a.length;v++)a.words[v]=0}var A=f.clone()._ishlnsubmul(w,1,d);A.negative===0&&(f=A,a&&(a.words[d]=1));for(var _=d-1;_>=0;_--){var P=(f.words[w.length+_]|0)*67108864+(f.words[w.length+_-1]|0);for(P=Math.min(P/E|0,67108863),f._ishlnsubmul(w,P,_);f.negative!==0;)P--,f.negative=0,f._ishlnsubmul(w,1,_),f.isZero()||(f.negative^=1);a&&(a.words[_]=P)}return a&&a.strip(),f.strip(),h!=="div"&&l!==0&&f.iushrn(l),{div:a||null,mod:f}},i.prototype.divmod=function(o,h,l){if(n(!o.isZero()),this.isZero())return{div:new i(0),mod:new i(0)};var f,w,E;return this.negative!==0&&o.negative===0?(E=this.neg().divmod(o,h),h!=="mod"&&(f=E.div.neg()),h!=="div"&&(w=E.mod.neg(),l&&w.negative!==0&&w.iadd(o)),{div:f,mod:w}):this.negative===0&&o.negative!==0?(E=this.divmod(o.neg(),h),h!=="mod"&&(f=E.div.neg()),{div:f,mod:E.mod}):this.negative&o.negative?(E=this.neg().divmod(o.neg(),h),h!=="div"&&(w=E.mod.neg(),l&&w.negative!==0&&w.isub(o)),{div:E.div,mod:w}):o.length>this.length||this.cmp(o)<0?{div:new i(0),mod:this}:o.length===1?h==="div"?{div:this.divn(o.words[0]),mod:null}:h==="mod"?{div:null,mod:new i(this.modn(o.words[0]))}:{div:this.divn(o.words[0]),mod:new i(this.modn(o.words[0]))}:this._wordDiv(o,h)},i.prototype.div=function(o){return this.divmod(o,"div",!1).div},i.prototype.mod=function(o){return this.divmod(o,"mod",!1).mod},i.prototype.umod=function(o){return this.divmod(o,"mod",!0).mod},i.prototype.divRound=function(o){var h=this.divmod(o);if(h.mod.isZero())return h.div;var l=h.div.negative!==0?h.mod.isub(o):h.mod,f=o.ushrn(1),w=o.andln(1),E=l.cmp(f);return E<0||w===1&&E===0?h.div:h.div.negative!==0?h.div.isubn(1):h.div.iaddn(1)},i.prototype.modn=function(o){n(o<=67108863);for(var h=(1<<26)%o,l=0,f=this.length-1;f>=0;f--)l=(h*l+(this.words[f]|0))%o;return l},i.prototype.idivn=function(o){n(o<=67108863);for(var h=0,l=this.length-1;l>=0;l--){var f=(this.words[l]|0)+h*67108864;this.words[l]=f/o|0,h=f%o}return this.strip()},i.prototype.divn=function(o){return this.clone().idivn(o)},i.prototype.egcd=function(o){n(o.negative===0),n(!o.isZero());var h=this,l=o.clone();h.negative!==0?h=h.umod(o):h=h.clone();for(var f=new i(1),w=new i(0),E=new i(0),I=new i(1),d=0;h.isEven()&&l.isEven();)h.iushrn(1),l.iushrn(1),++d;for(var a=l.clone(),v=h.clone();!h.isZero();){for(var A=0,_=1;!(h.words[0]&_)&&A<26;++A,_<<=1);if(A>0)for(h.iushrn(A);A-- >0;)(f.isOdd()||w.isOdd())&&(f.iadd(a),w.isub(v)),f.iushrn(1),w.iushrn(1);for(var P=0,U=1;!(l.words[0]&U)&&P<26;++P,U<<=1);if(P>0)for(l.iushrn(P);P-- >0;)(E.isOdd()||I.isOdd())&&(E.iadd(a),I.isub(v)),E.iushrn(1),I.iushrn(1);h.cmp(l)>=0?(h.isub(l),f.isub(E),w.isub(I)):(l.isub(h),E.isub(f),I.isub(w))}return{a:E,b:I,gcd:l.iushln(d)}},i.prototype._invmp=function(o){n(o.negative===0),n(!o.isZero());var h=this,l=o.clone();h.negative!==0?h=h.umod(o):h=h.clone();for(var f=new i(1),w=new i(0),E=l.clone();h.cmpn(1)>0&&l.cmpn(1)>0;){for(var I=0,d=1;!(h.words[0]&d)&&I<26;++I,d<<=1);if(I>0)for(h.iushrn(I);I-- >0;)f.isOdd()&&f.iadd(E),f.iushrn(1);for(var a=0,v=1;!(l.words[0]&v)&&a<26;++a,v<<=1);if(a>0)for(l.iushrn(a);a-- >0;)w.isOdd()&&w.iadd(E),w.iushrn(1);h.cmp(l)>=0?(h.isub(l),f.isub(w)):(l.isub(h),w.isub(f))}var A;return h.cmpn(1)===0?A=f:A=w,A.cmpn(0)<0&&A.iadd(o),A},i.prototype.gcd=function(o){if(this.isZero())return o.abs();if(o.isZero())return this.abs();var h=this.clone(),l=o.clone();h.negative=0,l.negative=0;for(var f=0;h.isEven()&&l.isEven();f++)h.iushrn(1),l.iushrn(1);do{for(;h.isEven();)h.iushrn(1);for(;l.isEven();)l.iushrn(1);var w=h.cmp(l);if(w<0){var E=h;h=l,l=E}else if(w===0||l.cmpn(1)===0)break;h.isub(l)}while(!0);return l.iushln(f)},i.prototype.invm=function(o){return this.egcd(o).a.umod(o)},i.prototype.isEven=function(){return(this.words[0]&1)===0},i.prototype.isOdd=function(){return(this.words[0]&1)===1},i.prototype.andln=function(o){return this.words[0]&o},i.prototype.bincn=function(o){n(typeof o=="number");var h=o%26,l=(o-h)/26,f=1<<h;if(this.length<=l)return this._expand(l+1),this.words[l]|=f,this;for(var w=f,E=l;w!==0&&E<this.length;E++){var I=this.words[E]|0;I+=w,w=I>>>26,I&=67108863,this.words[E]=I}return w!==0&&(this.words[E]=w,this.length++),this},i.prototype.isZero=function(){return this.length===1&&this.words[0]===0},i.prototype.cmpn=function(o){var h=o<0;if(this.negative!==0&&!h)return-1;if(this.negative===0&&h)return 1;this.strip();var l;if(this.length>1)l=1;else{h&&(o=-o),n(o<=67108863,"Number is too big");var f=this.words[0]|0;l=f===o?0:f<o?-1:1}return this.negative!==0?-l|0:l},i.prototype.cmp=function(o){if(this.negative!==0&&o.negative===0)return-1;if(this.negative===0&&o.negative!==0)return 1;var h=this.ucmp(o);return this.negative!==0?-h|0:h},i.prototype.ucmp=function(o){if(this.length>o.length)return 1;if(this.length<o.length)return-1;for(var h=0,l=this.length-1;l>=0;l--){var f=this.words[l]|0,w=o.words[l]|0;if(f!==w){f<w?h=-1:f>w&&(h=1);break}}return h},i.prototype.gtn=function(o){return this.cmpn(o)===1},i.prototype.gt=function(o){return this.cmp(o)===1},i.prototype.gten=function(o){return this.cmpn(o)>=0},i.prototype.gte=function(o){return this.cmp(o)>=0},i.prototype.ltn=function(o){return this.cmpn(o)===-1},i.prototype.lt=function(o){return this.cmp(o)===-1},i.prototype.lten=function(o){return this.cmpn(o)<=0},i.prototype.lte=function(o){return this.cmp(o)<=0},i.prototype.eqn=function(o){return this.cmpn(o)===0},i.prototype.eq=function(o){return this.cmp(o)===0},i.red=function(o){return new k(o)},i.prototype.toRed=function(o){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),o.convertTo(this)._forceRed(o)},i.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},i.prototype._forceRed=function(o){return this.red=o,this},i.prototype.forceRed=function(o){return n(!this.red,"Already a number in reduction context"),this._forceRed(o)},i.prototype.redAdd=function(o){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,o)},i.prototype.redIAdd=function(o){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,o)},i.prototype.redSub=function(o){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,o)},i.prototype.redISub=function(o){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,o)},i.prototype.redShl=function(o){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,o)},i.prototype.redMul=function(o){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,o),this.red.mul(this,o)},i.prototype.redIMul=function(o){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,o),this.red.imul(this,o)},i.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},i.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},i.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},i.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},i.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},i.prototype.redPow=function(o){return n(this.red&&!o.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,o)};var N={k256:null,p224:null,p192:null,p25519:null};function R(o,h){this.name=o,this.p=new i(h,16),this.n=this.p.bitLength(),this.k=new i(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}R.prototype._tmp=function(){var o=new i(null);return o.words=new Array(Math.ceil(this.n/13)),o},R.prototype.ireduce=function(o){var h=o,l;do this.split(h,this.tmp),h=this.imulK(h),h=h.iadd(this.tmp),l=h.bitLength();while(l>this.n);var f=l<this.n?-1:h.ucmp(this.p);return f===0?(h.words[0]=0,h.length=1):f>0?h.isub(this.p):h.strip!==void 0?h.strip():h._strip(),h},R.prototype.split=function(o,h){o.iushrn(this.n,0,h)},R.prototype.imulK=function(o){return o.imul(this.k)};function G(){R.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}s(G,R),G.prototype.split=function(o,h){for(var l=4194303,f=Math.min(o.length,9),w=0;w<f;w++)h.words[w]=o.words[w];if(h.length=f,o.length<=9){o.words[0]=0,o.length=1;return}var E=o.words[9];for(h.words[h.length++]=E&l,w=10;w<o.length;w++){var I=o.words[w]|0;o.words[w-10]=(I&l)<<4|E>>>22,E=I}E>>>=22,o.words[w-10]=E,E===0&&o.length>10?o.length-=10:o.length-=9},G.prototype.imulK=function(o){o.words[o.length]=0,o.words[o.length+1]=0,o.length+=2;for(var h=0,l=0;l<o.length;l++){var f=o.words[l]|0;h+=f*977,o.words[l]=h&67108863,h=f*64+(h/67108864|0)}return o.words[o.length-1]===0&&(o.length--,o.words[o.length-1]===0&&o.length--),o};function C(){R.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}s(C,R);function $(){R.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}s($,R);function K(){R.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}s(K,R),K.prototype.imulK=function(o){for(var h=0,l=0;l<o.length;l++){var f=(o.words[l]|0)*19+h,w=f&67108863;f>>>=26,o.words[l]=w,h=f}return h!==0&&(o.words[o.length++]=h),o},i._prime=function(o){if(N[o])return N[o];var h;if(o==="k256")h=new G;else if(o==="p224")h=new C;else if(o==="p192")h=new $;else if(o==="p25519")h=new K;else throw new Error("Unknown prime "+o);return N[o]=h,h};function k(o){if(typeof o=="string"){var h=i._prime(o);this.m=h.p,this.prime=h}else n(o.gtn(1),"modulus must be greater than 1"),this.m=o,this.prime=null}k.prototype._verify1=function(o){n(o.negative===0,"red works only with positives"),n(o.red,"red works only with red numbers")},k.prototype._verify2=function(o,h){n((o.negative|h.negative)===0,"red works only with positives"),n(o.red&&o.red===h.red,"red works only with red numbers")},k.prototype.imod=function(o){return this.prime?this.prime.ireduce(o)._forceRed(this):o.umod(this.m)._forceRed(this)},k.prototype.neg=function(o){return o.isZero()?o.clone():this.m.sub(o)._forceRed(this)},k.prototype.add=function(o,h){this._verify2(o,h);var l=o.add(h);return l.cmp(this.m)>=0&&l.isub(this.m),l._forceRed(this)},k.prototype.iadd=function(o,h){this._verify2(o,h);var l=o.iadd(h);return l.cmp(this.m)>=0&&l.isub(this.m),l},k.prototype.sub=function(o,h){this._verify2(o,h);var l=o.sub(h);return l.cmpn(0)<0&&l.iadd(this.m),l._forceRed(this)},k.prototype.isub=function(o,h){this._verify2(o,h);var l=o.isub(h);return l.cmpn(0)<0&&l.iadd(this.m),l},k.prototype.shl=function(o,h){return this._verify1(o),this.imod(o.ushln(h))},k.prototype.imul=function(o,h){return this._verify2(o,h),this.imod(o.imul(h))},k.prototype.mul=function(o,h){return this._verify2(o,h),this.imod(o.mul(h))},k.prototype.isqr=function(o){return this.imul(o,o.clone())},k.prototype.sqr=function(o){return this.mul(o,o)},k.prototype.sqrt=function(o){if(o.isZero())return o.clone();var h=this.m.andln(3);if(n(h%2===1),h===3){var l=this.m.add(new i(1)).iushrn(2);return this.pow(o,l)}for(var f=this.m.subn(1),w=0;!f.isZero()&&f.andln(1)===0;)w++,f.iushrn(1);n(!f.isZero());var E=new i(1).toRed(this),I=E.redNeg(),d=this.m.subn(1).iushrn(1),a=this.m.bitLength();for(a=new i(2*a*a).toRed(this);this.pow(a,d).cmp(I)!==0;)a.redIAdd(I);for(var v=this.pow(a,f),A=this.pow(o,f.addn(1).iushrn(1)),_=this.pow(o,f),P=w;_.cmp(E)!==0;){for(var U=_,D=0;U.cmp(E)!==0;D++)U=U.redSqr();n(D<P);var q=this.pow(v,new i(1).iushln(P-D-1));A=A.redMul(q),v=q.redSqr(),_=_.redMul(v),P=D}return A},k.prototype.invm=function(o){var h=o._invmp(this.m);return h.negative!==0?(h.negative=0,this.imod(h).redNeg()):this.imod(h)},k.prototype.pow=function(o,h){if(h.isZero())return new i(1).toRed(this);if(h.cmpn(1)===0)return o.clone();var l=4,f=new Array(1<<l);f[0]=new i(1).toRed(this),f[1]=o;for(var w=2;w<f.length;w++)f[w]=this.mul(f[w-1],o);var E=f[0],I=0,d=0,a=h.bitLength()%26;for(a===0&&(a=26),w=h.length-1;w>=0;w--){for(var v=h.words[w],A=a-1;A>=0;A--){var _=v>>A&1;if(E!==f[0]&&(E=this.sqr(E)),_===0&&I===0){d=0;continue}I<<=1,I|=_,d++,!(d!==l&&(w!==0||A!==0))&&(E=this.mul(E,f[I]),d=0,I=0)}a=26}return E},k.prototype.convertTo=function(o){var h=o.umod(this.m);return h===o?h.clone():h},k.prototype.convertFrom=function(o){var h=o.clone();return h.red=null,h},i.mont=function(o){return new B(o)};function B(o){k.call(this,o),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new i(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}s(B,k),B.prototype.convertTo=function(o){return this.imod(o.ushln(this.shift))},B.prototype.convertFrom=function(o){var h=this.imod(o.mul(this.rinv));return h.red=null,h},B.prototype.imul=function(o,h){if(o.isZero()||h.isZero())return o.words[0]=0,o.length=1,o;var l=o.imul(h),f=l.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),w=l.isub(f).iushrn(this.shift),E=w;return w.cmp(this.m)>=0?E=w.isub(this.m):w.cmpn(0)<0&&(E=w.iadd(this.m)),E._forceRed(this)},B.prototype.mul=function(o,h){if(o.isZero()||h.isZero())return new i(0)._forceRed(this);var l=o.mul(h),f=l.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),w=l.isub(f).iushrn(this.shift),E=w;return w.cmp(this.m)>=0?E=w.isub(this.m):w.cmpn(0)<0&&(E=w.iadd(this.m)),E._forceRed(this)},B.prototype.invm=function(o){var h=this.imod(o._invmp(this.m).mul(this.r2));return h._forceRed(this)}})(e,ec)}(ji);var bf=ji.exports;const Ne=Uo(),Sf=m.alloc(1,1),Eu=m.alloc(1,0);function _f(e,t,r,n,s){let i=m.alloc(32,0),u=m.alloc(32,1);i=Ne("sha256",i).update(u).update(Eu).update(t).update(e).update(s||"").digest(),u=Ne("sha256",i).update(u).digest(),i=Ne("sha256",i).update(u).update(Sf).update(t).update(e).update(s||"").digest(),u=Ne("sha256",i).update(u).digest(),u=Ne("sha256",i).update(u).digest();let c=u;for(;!n(c)||!r(c);)i=Ne("sha256",i).update(u).update(Eu).digest(),u=Ne("sha256",i).update(u).digest(),u=Ne("sha256",i).update(u).digest(),c=u;return c}var Tf=_f;const Pf=bf,Of=rc().ec,zi=new Of("secp256k1"),Mf=Tf,hn=m.alloc(32,0),cn=m.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),Iu=m.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),ce=zi.curve.n,bu=ce.shrn(1),ln=zi.curve.g,pn="Expected Private",Xe="Expected Point",fn="Expected Tweak",Su="Expected Hash",Af="Expected Signature",Nf="Expected Extra Data (32 bytes)";function Hr(e){return m.isBuffer(e)&&e.length===32}function dn(e){return Hr(e)?e.compare(cn)<0:!1}function ke(e){if(!m.isBuffer(e)||e.length<33)return!1;const t=e[0],r=e.slice(1,33);if(r.compare(hn)===0||r.compare(Iu)>=0)return!1;if((t===2||t===3)&&e.length===33){try{je(e)}catch{return!1}return!0}const n=e.slice(33);return n.compare(hn)===0||n.compare(Iu)>=0?!1:t===4&&e.length===65}function _u(e){return e[0]!==4}function kf(e){return ke(e)?_u(e):!1}function Re(e){return Hr(e)?e.compare(hn)>0&&e.compare(cn)<0:!1}function Rf(e){const t=e.slice(0,32),r=e.slice(32,64);return m.isBuffer(e)&&e.length===64&&t.compare(cn)<0&&r.compare(cn)<0}function Lr(e,t){return e===void 0&&t!==void 0?_u(t):e===void 0?!0:e}function re(e){return new Pf(e)}function mn(e){return e.toArrayLike(m,"be",32)}function je(e){return zi.curve.decodePoint(e)}function fr(e,t){return m.from(e._encode(t))}function xf(e,t,r){if(!ke(e))throw new TypeError(Xe);if(!ke(t))throw new TypeError(Xe);const n=je(e),s=je(t),i=n.add(s);if(i.isInfinity())return null;const u=Lr(r,e);return fr(i,u)}function Uf(e,t,r){if(!ke(e))throw new TypeError(Xe);if(!dn(t))throw new TypeError(fn);const n=Lr(r,e),s=je(e);if(t.compare(hn)===0)return fr(s,n);const i=re(t),u=ln.mul(i),c=s.add(u);return c.isInfinity()?null:fr(c,n)}function Cf(e,t){if(!ke(e))throw new TypeError(Xe);const r=je(e);if(r.isInfinity())throw new TypeError(Xe);const n=Lr(t,e);return fr(r,n)}function Hf(e,t){if(!Re(e))throw new TypeError(pn);const r=re(e),n=ln.mul(r);if(n.isInfinity())return null;const s=Lr(t);return fr(n,s)}function Lf(e,t,r){if(!ke(e))throw new TypeError(Xe);if(!dn(t))throw new TypeError(fn);const n=Lr(r,e),s=je(e),i=re(t),u=s.mul(i);return u.isInfinity()?null:fr(u,n)}function Df(e,t){if(!Re(e))throw new TypeError(pn);if(!dn(t))throw new TypeError(fn);const r=re(e),n=re(t),s=mn(r.add(n).umod(ce));return Re(s)?s:null}function Bf(e,t){if(!Re(e))throw new TypeError(pn);if(!dn(t))throw new TypeError(fn);const r=re(e),n=re(t),s=mn(r.sub(n).umod(ce));return Re(s)?s:null}function $f(e,t){return Tu(e,t)}function Gf(e,t,r){return Tu(e,t,r)}function Tu(e,t,r){if(!Hr(e))throw new TypeError(Su);if(!Re(t))throw new TypeError(pn);if(r!==void 0&&!Hr(r))throw new TypeError(Nf);const n=re(t),s=re(e);let i,u;Mf(e,t,function(p){const g=re(p),y=ln.mul(g);return!(y.isInfinity()||(i=y.x.umod(ce),i.isZero()===0)||(u=g.invm(ce).mul(s.add(n.mul(i))).umod(ce),u.isZero()===0))},Re,r),u.cmp(bu)>0&&(u=ce.sub(u));const c=m.allocUnsafe(64);return mn(i).copy(c,0),mn(u).copy(c,32),c}function Kf(e,t,r,n){if(!Hr(e))throw new TypeError(Su);if(!ke(t))throw new TypeError(Xe);if(!Rf(r))throw new TypeError(Af);const s=je(t),i=re(r.slice(0,32)),u=re(r.slice(32,64));if(n&&u.cmp(bu)>0||i.gtn(0)<=0||u.gtn(0)<=0)return!1;const c=re(e),p=u.invm(ce),g=c.mul(p).umod(ce),y=i.mul(p).umod(ce),b=ln.mulAdd(g,s,y);return b.isInfinity()?!1:b.x.umod(ce).eq(i)}var pe={isPoint:ke,isPointCompressed:kf,isPrivate:Re,pointAdd:xf,pointAddScalar:Uf,pointCompress:Cf,pointFromScalar:Hf,pointMultiply:Lf,privateAdd:Df,privateSub:Bf,sign:$f,signWithEntropy:Gf,verify:Kf};Object.defineProperty(pr,"__esModule",{value:!0});const Yi=un,Pu=If,fe=pe,Vt=$t,Ff=Co,Zi=Vt.BufferN(32),Wf=Vt.compile({wif:Vt.UInt8,bip32:{public:Vt.UInt32,private:Vt.UInt32}}),gn={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},Ou=2147483648,Vf=Math.pow(2,31)-1;function qf(e){return Vt.String(e)&&e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)!==null}function Xf(e){return Vt.UInt32(e)&&e<=Vf}class Mu{constructor(t,r,n,s,i=0,u=0,c=0){this.__D=t,this.__Q=r,this.chainCode=n,this.network=s,this.__DEPTH=i,this.__INDEX=u,this.__PARENT_FINGERPRINT=c,Vt(Wf,s),this.lowR=!1}get depth(){return this.__DEPTH}get index(){return this.__INDEX}get parentFingerprint(){return this.__PARENT_FINGERPRINT}get publicKey(){return this.__Q===void 0&&(this.__Q=fe.pointFromScalar(this.__D,!0)),this.__Q}get privateKey(){return this.__D}get identifier(){return Yi.hash160(this.publicKey)}get fingerprint(){return this.identifier.slice(0,4)}get compressed(){return!0}isNeutered(){return this.__D===void 0}neutered(){return wn(this.publicKey,this.chainCode,this.network,this.depth,this.index,this.parentFingerprint)}toBase58(){const t=this.network,r=this.isNeutered()?t.bip32.public:t.bip32.private,n=m.allocUnsafe(78);return n.writeUInt32BE(r,0),n.writeUInt8(this.depth,4),n.writeUInt32BE(this.parentFingerprint,5),n.writeUInt32BE(this.index,9),this.chainCode.copy(n,13),this.isNeutered()?this.publicKey.copy(n,45):(n.writeUInt8(0,45),this.privateKey.copy(n,46)),Pu.encode(n)}toWIF(){if(!this.privateKey)throw new TypeError("Missing private key");return Ff.encode(this.network.wif,this.privateKey,!0)}derive(t){Vt(Vt.UInt32,t);const r=t>=Ou,n=m.allocUnsafe(37);if(r){if(this.isNeutered())throw new TypeError("Missing private key for hardened child key");n[0]=0,this.privateKey.copy(n,1),n.writeUInt32BE(t,33)}else this.publicKey.copy(n,0),n.writeUInt32BE(t,33);const s=Yi.hmacSHA512(this.chainCode,n),i=s.slice(0,32),u=s.slice(32);if(!fe.isPrivate(i))return this.derive(t+1);let c;if(this.isNeutered()){const p=fe.pointAddScalar(this.publicKey,i,!0);if(p===null)return this.derive(t+1);c=wn(p,u,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}else{const p=fe.privateAdd(this.privateKey,i);if(p==null)return this.derive(t+1);c=Qi(p,u,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}return c}deriveHardened(t){return Vt(Xf,t),this.derive(t+Ou)}derivePath(t){Vt(qf,t);let r=t.split("/");if(r[0]==="m"){if(this.parentFingerprint)throw new TypeError("Expected master, got child");r=r.slice(1)}return r.reduce((n,s)=>{let i;return s.slice(-1)==="'"?(i=parseInt(s.slice(0,-1),10),n.deriveHardened(i)):(i=parseInt(s,10),n.derive(i))},this)}sign(t,r){if(!this.privateKey)throw new Error("Missing private key");if(r===void 0&&(r=this.lowR),r===!1)return fe.sign(t,this.privateKey);{let n=fe.sign(t,this.privateKey);const s=m.alloc(32,0);let i=0;for(;n[0]>127;)i++,s.writeUIntLE(i,0,6),n=fe.signWithEntropy(t,this.privateKey,s);return n}}verify(t,r){return fe.verify(t,this.publicKey,r)}}function jf(e,t){const r=Pu.decode(e);if(r.length!==78)throw new TypeError("Invalid buffer length");t=t||gn;const n=r.readUInt32BE(0);if(n!==t.bip32.private&&n!==t.bip32.public)throw new TypeError("Invalid network version");const s=r[4],i=r.readUInt32BE(5);if(s===0&&i!==0)throw new TypeError("Invalid parent fingerprint");const u=r.readUInt32BE(9);if(s===0&&u!==0)throw new TypeError("Invalid index");const c=r.slice(13,45);let p;if(n===t.bip32.private){if(r.readUInt8(45)!==0)throw new TypeError("Invalid private key");const g=r.slice(46,78);p=Qi(g,c,t,s,u,i)}else{const g=r.slice(45,78);p=wn(g,c,t,s,u,i)}return p}pr.fromBase58=jf;function Au(e,t,r){return Qi(e,t,r)}pr.fromPrivateKey=Au;function Qi(e,t,r,n,s,i){if(Vt({privateKey:Zi,chainCode:Zi},{privateKey:e,chainCode:t}),r=r||gn,!fe.isPrivate(e))throw new TypeError("Private key not in range [1, n)");return new Mu(e,void 0,t,r,n,s,i)}function zf(e,t,r){return wn(e,t,r)}pr.fromPublicKey=zf;function wn(e,t,r,n,s,i){if(Vt({publicKey:Vt.BufferN(33),chainCode:Zi},{publicKey:e,chainCode:t}),r=r||gn,!fe.isPoint(e))throw new TypeError("Point is not on the curve");return new Mu(void 0,e,t,r,n,s,i)}function Yf(e,t){if(Vt(Vt.Buffer,e),e.length<16)throw new TypeError("Seed should be at least 128 bits");if(e.length>64)throw new TypeError("Seed should be at most 512 bits");t=t||gn;const r=Yi.hmacSHA512(m.from("Bitcoin seed","utf8"),e),n=r.slice(0,32),s=r.slice(32);return Au(n,s,t)}pr.fromSeed=Yf,Object.defineProperty(lr,"__esModule",{value:!0});var vn=pr;lr.fromSeed=vn.fromSeed,lr.fromBase58=vn.fromBase58,lr.fromPublicKey=vn.fromPublicKey,lr.fromPrivateKey=vn.fromPrivateKey;var de={},zt={};Object.defineProperty(zt,"__esModule",{value:!0}),zt.bitcoin={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},zt.regtest={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},zt.testnet={messagePrefix:`Bitcoin Signed Message:
`,bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};var se={},Ji={},W={},yn={};Object.defineProperty(yn,"__esModule",{value:!0});function Zf(e,t,r){t=t||4,r=r===void 0?!0:r;const n=e.length;if(n===0)return 0;if(n>t)throw new TypeError("Script number overflow");if(r&&!(e[n-1]&127)&&(n<=1||!(e[n-2]&128)))throw new Error("Non-minimally encoded script number");if(n===5){const i=e.readUInt32LE(0),u=e.readUInt8(4);return u&128?-((u&-129)*4294967296+i):u*4294967296+i}let s=0;for(let i=0;i<n;++i)s|=e[i]<<8*i;return e[n-1]&128?-(s&~(128<<8*(n-1))):s}yn.decode=Zf;function Qf(e){return e>2147483647?5:e>8388607?4:e>32767?3:e>127?2:e>0?1:0}function Jf(e){let t=Math.abs(e);const r=Qf(t),n=m.allocUnsafe(r),s=e<0;for(let i=0;i<r;++i)n.writeUInt8(t&255,i),t>>=8;return n[r-1]&128?n.writeUInt8(s?128:0,r-1):s&&(n[r-1]|=128),n}yn.encode=Jf;var En={},X={};Object.defineProperty(X,"__esModule",{value:!0});const z=$t,t0=Math.pow(2,31)-1;function e0(e){return z.UInt32(e)&&e<=t0}X.UInt31=e0;function Nu(e){return z.String(e)&&!!e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}X.BIP32Path=Nu,Nu.toJSON=()=>"BIP32 derivation path";function r0(e){return(z.Buffer(e.publicKey)||typeof e.getPublicKey=="function")&&typeof e.sign=="function"}X.Signer=r0;const n0=21*1e14;function i0(e){return z.UInt53(e)&&e<=n0}X.Satoshi=i0,X.ECPoint=z.quacksLike("Point"),X.Network=z.compile({messagePrefix:z.oneOf(z.Buffer,z.String),bip32:{public:z.UInt32,private:z.UInt32},pubKeyHash:z.UInt8,scriptHash:z.UInt8,wif:z.UInt8}),X.Buffer256bit=z.BufferN(32),X.Hash160bit=z.BufferN(20),X.Hash256bit=z.BufferN(32),X.Number=z.Number,X.Array=z.Array,X.Boolean=z.Boolean,X.String=z.String,X.Buffer=z.Buffer,X.Hex=z.Hex,X.maybe=z.maybe,X.tuple=z.tuple,X.UInt8=z.UInt8,X.UInt32=z.UInt32,X.Function=z.Function,X.BufferN=z.BufferN,X.Null=z.Null,X.oneOf=z.oneOf,Object.defineProperty(En,"__esModule",{value:!0});const ku=X,Ru=Ho,s0=$t,xu=m.alloc(1,0);function Uu(e){let t=0;for(;e[t]===0;)++t;return t===e.length?xu:(e=e.slice(t),e[0]&128?m.concat([xu,e],1+e.length):e)}function Cu(e){e[0]===0&&(e=e.slice(1));const t=m.alloc(32,0),r=Math.max(0,32-e.length);return e.copy(t,r),t}function o0(e){const t=e.readUInt8(e.length-1),r=t&-129;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);const n=Ru.decode(e.slice(0,-1)),s=Cu(n.r),i=Cu(n.s);return{signature:m.concat([s,i],64),hashType:t}}En.decode=o0;function u0(e,t){s0({signature:ku.BufferN(64),hashType:ku.UInt8},{signature:e,hashType:t});const r=t&-129;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);const n=m.allocUnsafe(1);n.writeUInt8(t,0);const s=Uu(e.slice(0,32)),i=Uu(e.slice(32,64));return m.concat([Ru.encode(s,i),n])}En.encode=u0;const a0=0,h0=0,c0=76,l0=77,p0=78,f0=79,d0=80,m0=81,g0=81,w0=82,v0=83,y0=84,E0=85,I0=86,b0=87,S0=88,_0=89,T0=90,P0=91,O0=92,M0=93,A0=94,N0=95,k0=96,R0=97,x0=98,U0=99,C0=100,H0=101,L0=102,D0=103,B0=104,$0=105,G0=106,K0=107,F0=108,W0=109,V0=110,q0=111,X0=112,j0=113,z0=114,Y0=115,Z0=116,Q0=117,J0=118,td=119,ed=120,rd=121,nd=122,id=123,sd=124,od=125,ud=126,ad=127,hd=128,cd=129,ld=130,pd=131,fd=132,dd=133,md=134,gd=135,wd=136,vd=137,yd=138,Ed=139,Id=140,bd=141,Sd=142,_d=143,Td=144,Pd=145,Od=146,Md=147,Ad=148,Nd=149,kd=150,Rd=151,xd=152,Ud=153,Cd=154,Hd=155,Ld=156,Dd=157,Bd=158,$d=159,Gd=160,Kd=161,Fd=162,Wd=163,Vd=164,qd=165,Xd=166,jd=167,zd=168,Yd=169,Zd=170,Qd=171,Jd=172,tm=173,em=174,rm=175,nm=176,im=177,sm=177,om=178,um=178,am=179,hm=180,cm=181,lm=182,pm=183,fm=184,dm=185,mm=253,gm=254,wm=255,ts={OP_FALSE:a0,OP_0:h0,OP_PUSHDATA1:c0,OP_PUSHDATA2:l0,OP_PUSHDATA4:p0,OP_1NEGATE:f0,OP_RESERVED:d0,OP_TRUE:m0,OP_1:g0,OP_2:w0,OP_3:v0,OP_4:y0,OP_5:E0,OP_6:I0,OP_7:b0,OP_8:S0,OP_9:_0,OP_10:T0,OP_11:P0,OP_12:O0,OP_13:M0,OP_14:A0,OP_15:N0,OP_16:k0,OP_NOP:R0,OP_VER:x0,OP_IF:U0,OP_NOTIF:C0,OP_VERIF:H0,OP_VERNOTIF:L0,OP_ELSE:D0,OP_ENDIF:B0,OP_VERIFY:$0,OP_RETURN:G0,OP_TOALTSTACK:K0,OP_FROMALTSTACK:F0,OP_2DROP:W0,OP_2DUP:V0,OP_3DUP:q0,OP_2OVER:X0,OP_2ROT:j0,OP_2SWAP:z0,OP_IFDUP:Y0,OP_DEPTH:Z0,OP_DROP:Q0,OP_DUP:J0,OP_NIP:td,OP_OVER:ed,OP_PICK:rd,OP_ROLL:nd,OP_ROT:id,OP_SWAP:sd,OP_TUCK:od,OP_CAT:ud,OP_SUBSTR:ad,OP_LEFT:hd,OP_RIGHT:cd,OP_SIZE:ld,OP_INVERT:pd,OP_AND:fd,OP_OR:dd,OP_XOR:md,OP_EQUAL:gd,OP_EQUALVERIFY:wd,OP_RESERVED1:vd,OP_RESERVED2:yd,OP_1ADD:Ed,OP_1SUB:Id,OP_2MUL:bd,OP_2DIV:Sd,OP_NEGATE:_d,OP_ABS:Td,OP_NOT:Pd,OP_0NOTEQUAL:Od,OP_ADD:Md,OP_SUB:Ad,OP_MUL:Nd,OP_DIV:kd,OP_MOD:Rd,OP_LSHIFT:xd,OP_RSHIFT:Ud,OP_BOOLAND:Cd,OP_BOOLOR:Hd,OP_NUMEQUAL:Ld,OP_NUMEQUALVERIFY:Dd,OP_NUMNOTEQUAL:Bd,OP_LESSTHAN:$d,OP_GREATERTHAN:Gd,OP_LESSTHANOREQUAL:Kd,OP_GREATERTHANOREQUAL:Fd,OP_MIN:Wd,OP_MAX:Vd,OP_WITHIN:qd,OP_RIPEMD160:Xd,OP_SHA1:jd,OP_SHA256:zd,OP_HASH160:Yd,OP_HASH256:Zd,OP_CODESEPARATOR:Qd,OP_CHECKSIG:Jd,OP_CHECKSIGVERIFY:tm,OP_CHECKMULTISIG:em,OP_CHECKMULTISIGVERIFY:rm,OP_NOP1:nm,OP_NOP2:im,OP_CHECKLOCKTIMEVERIFY:sm,OP_NOP3:om,OP_CHECKSEQUENCEVERIFY:um,OP_NOP4:am,OP_NOP5:hm,OP_NOP6:cm,OP_NOP7:lm,OP_NOP8:pm,OP_NOP9:fm,OP_NOP10:dm,OP_PUBKEYHASH:mm,OP_PUBKEY:gm,OP_INVALIDOPCODE:wm};var xe=ts;function Hu(e){return e<xe.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}function vm(e,t,r){var n=Hu(t);return n===1?e.writeUInt8(t,r):n===2?(e.writeUInt8(xe.OP_PUSHDATA1,r),e.writeUInt8(t,r+1)):n===3?(e.writeUInt8(xe.OP_PUSHDATA2,r),e.writeUInt16LE(t,r+1)):(e.writeUInt8(xe.OP_PUSHDATA4,r),e.writeUInt32LE(t,r+1)),n}function ym(e,t){var r=e.readUInt8(t),n,s;if(r<xe.OP_PUSHDATA1)n=r,s=1;else if(r===xe.OP_PUSHDATA1){if(t+2>e.length)return null;n=e.readUInt8(t+1),s=2}else if(r===xe.OP_PUSHDATA2){if(t+3>e.length)return null;n=e.readUInt16LE(t+1),s=3}else{if(t+5>e.length)return null;if(r!==xe.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=e.readUInt32LE(t+1),s=5}return{opcode:r,number:n,size:s}}var Em={encodingLength:Hu,encode:vm,decode:ym},Lu=ts,Du={};for(var Bu in Lu){var Im=Lu[Bu];Du[Im]=Bu}var bm=Du;(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=yn,r=En,n=X,s=Ho,i=pe,u=Em,c=$t;e.OPS=ts;const p=bm,g=e.OPS.OP_RESERVED;function y(k){return n.Number(k)&&(k===e.OPS.OP_0||k>=e.OPS.OP_1&&k<=e.OPS.OP_16||k===e.OPS.OP_1NEGATE)}function b(k){return n.Buffer(k)||y(k)}function O(k){return n.Array(k)&&k.every(b)}e.isPushOnly=O;function S(k){if(k.length===0)return e.OPS.OP_0;if(k.length===1){if(k[0]>=1&&k[0]<=16)return g+k[0];if(k[0]===129)return e.OPS.OP_1NEGATE}}function T(k){return m.isBuffer(k)}function H(k){return n.Array(k)}function x(k){return m.isBuffer(k)}function L(k){if(T(k))return k;c(n.Array,k);const B=k.reduce((l,f)=>x(f)?f.length===1&&S(f)!==void 0?l+1:l+u.encodingLength(f.length)+f.length:l+1,0),o=m.allocUnsafe(B);let h=0;if(k.forEach(l=>{if(x(l)){const f=S(l);if(f!==void 0){o.writeUInt8(f,h),h+=1;return}h+=u.encode(o,l.length,h),l.copy(o,h),h+=l.length}else o.writeUInt8(l,h),h+=1}),h!==o.length)throw new Error("Could not decode chunks");return o}e.compile=L;function M(k){if(H(k))return k;c(n.Buffer,k);const B=[];let o=0;for(;o<k.length;){const h=k[o];if(h>e.OPS.OP_0&&h<=e.OPS.OP_PUSHDATA4){const l=u.decode(k,o);if(l===null||(o+=l.size,o+l.number>k.length))return null;const f=k.slice(o,o+l.number);o+=l.number;const w=S(f);w!==void 0?B.push(w):B.push(f)}else B.push(h),o+=1}return B}e.decompile=M;function N(k){return T(k)&&(k=M(k)),k.map(B=>{if(x(B)){const o=S(B);if(o===void 0)return B.toString("hex");B=o}return p[B]}).join(" ")}e.toASM=N;function R(k){return c(n.String,k),L(k.split(" ").map(B=>e.OPS[B]!==void 0?e.OPS[B]:(c(n.Hex,B),m.from(B,"hex"))))}e.fromASM=R;function G(k){return k=M(k),c(O,k),k.map(B=>x(B)?B:B===e.OPS.OP_0?m.allocUnsafe(0):t.encode(B-g))}e.toStack=G;function C(k){return i.isPoint(k)}e.isCanonicalPubKey=C;function $(k){const B=k&-129;return B>0&&B<4}e.isDefinedHashType=$;function K(k){return!m.isBuffer(k)||!$(k[k.length-1])?!1:s.check(k.slice(0,-1))}e.isCanonicalScriptSignature=K,e.number=t,e.signature=r})(W);var me={};Object.defineProperty(me,"__esModule",{value:!0});function Sm(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){const n=r.call(this);return this[t]=n,n},set(n){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:n,writable:!0})}})}me.prop=Sm;function _m(e){let t;return()=>(t!==void 0||(t=e()),t)}me.value=_m,Object.defineProperty(Ji,"__esModule",{value:!0});const Tm=zt,In=W,$u=me,Ie=$t,Gu=In.OPS;function Pm(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Om(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),Ie({network:Ie.maybe(Ie.Object),output:Ie.maybe(Ie.Buffer),data:Ie.maybe(Ie.arrayOf(Ie.Buffer))},e);const r={name:"embed",network:e.network||Tm.bitcoin};if($u.prop(r,"output",()=>{if(e.data)return In.compile([Gu.OP_RETURN].concat(e.data))}),$u.prop(r,"data",()=>{if(e.output)return In.decompile(e.output).slice(1)}),t.validate&&e.output){const n=In.decompile(e.output);if(n[0]!==Gu.OP_RETURN)throw new TypeError("Output is invalid");if(!n.slice(1).every(Ie.Buffer))throw new TypeError("Output is invalid");if(e.data&&!Pm(e.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,e)}Ji.p2data=Om;var es={};Object.defineProperty(es,"__esModule",{value:!0});const Mm=zt,dr=W,Ue=me,mr=dr.OPS,qt=$t,Ku=pe,bn=mr.OP_RESERVED;function Fu(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Am(e,t){if(!e.input&&!e.output&&!(e.pubkeys&&e.m!==void 0)&&!e.signatures)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{});function r(c){return dr.isCanonicalScriptSignature(c)||(t.allowIncomplete&&c===mr.OP_0)!==void 0}qt({network:qt.maybe(qt.Object),m:qt.maybe(qt.Number),n:qt.maybe(qt.Number),output:qt.maybe(qt.Buffer),pubkeys:qt.maybe(qt.arrayOf(Ku.isPoint)),signatures:qt.maybe(qt.arrayOf(r)),input:qt.maybe(qt.Buffer)},e);const n={network:e.network||Mm.bitcoin};let s=[],i=!1;function u(c){i||(i=!0,s=dr.decompile(c),n.m=s[0]-bn,n.n=s[s.length-2]-bn,n.pubkeys=s.slice(1,-2))}if(Ue.prop(n,"output",()=>{if(e.m&&n.n&&e.pubkeys)return dr.compile([].concat(bn+e.m,e.pubkeys,bn+n.n,mr.OP_CHECKMULTISIG))}),Ue.prop(n,"m",()=>{if(n.output)return u(n.output),n.m}),Ue.prop(n,"n",()=>{if(n.pubkeys)return n.pubkeys.length}),Ue.prop(n,"pubkeys",()=>{if(e.output)return u(e.output),n.pubkeys}),Ue.prop(n,"signatures",()=>{if(e.input)return dr.decompile(e.input).slice(1)}),Ue.prop(n,"input",()=>{if(e.signatures)return dr.compile([mr.OP_0].concat(e.signatures))}),Ue.prop(n,"witness",()=>{if(n.input)return[]}),Ue.prop(n,"name",()=>{if(!(!n.m||!n.n))return`p2ms(${n.m} of ${n.n})`}),t.validate){if(e.output){if(u(e.output),!qt.Number(s[0]))throw new TypeError("Output is invalid");if(!qt.Number(s[s.length-2]))throw new TypeError("Output is invalid");if(s[s.length-1]!==mr.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(n.m<=0||n.n>16||n.m>n.n||n.n!==s.length-3)throw new TypeError("Output is invalid");if(!n.pubkeys.every(c=>Ku.isPoint(c)))throw new TypeError("Output is invalid");if(e.m!==void 0&&e.m!==n.m)throw new TypeError("m mismatch");if(e.n!==void 0&&e.n!==n.n)throw new TypeError("n mismatch");if(e.pubkeys&&!Fu(e.pubkeys,n.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(e.n!==void 0&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(n.n=e.pubkeys.length,n.n<n.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<n.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>n.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==mr.OP_0)throw new TypeError("Input is invalid");if(n.signatures.length===0||!n.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!Fu(e.signatures,n.signatures))throw new TypeError("Signature mismatch");if(e.m!==void 0&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(n,e)}es.p2ms=Am;var rs={};Object.defineProperty(rs,"__esModule",{value:!0});const Nm=zt,gr=W,wr=me,be=$t,Wu=gr.OPS,Vu=pe;function km(e,t){if(!e.input&&!e.output&&!e.pubkey&&!e.input&&!e.signature)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),be({network:be.maybe(be.Object),output:be.maybe(be.Buffer),pubkey:be.maybe(Vu.isPoint),signature:be.maybe(gr.isCanonicalScriptSignature),input:be.maybe(be.Buffer)},e);const r=wr.value(()=>gr.decompile(e.input)),n={name:"p2pk",network:e.network||Nm.bitcoin};if(wr.prop(n,"output",()=>{if(e.pubkey)return gr.compile([e.pubkey,Wu.OP_CHECKSIG])}),wr.prop(n,"pubkey",()=>{if(e.output)return e.output.slice(1,-1)}),wr.prop(n,"signature",()=>{if(e.input)return r()[0]}),wr.prop(n,"input",()=>{if(e.signature)return gr.compile([e.signature])}),wr.prop(n,"witness",()=>{if(n.input)return[]}),t.validate){if(e.output){if(e.output[e.output.length-1]!==Wu.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!Vu.isPoint(n.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(n.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(n.input))throw new TypeError("Signature mismatch");if(e.input){if(r().length!==1)throw new TypeError("Input is invalid");if(!gr.isCanonicalScriptSignature(n.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(n,e)}rs.p2pk=km;var ns={},Qt={};Object.defineProperty(Qt,"__esModule",{value:!0});const Sn=jr();function qu(e){try{return Sn("rmd160").update(e).digest()}catch{return Sn("ripemd160").update(e).digest()}}Qt.ripemd160=qu;function Rm(e){return Sn("sha1").update(e).digest()}Qt.sha1=Rm;function _n(e){return Sn("sha256").update(e).digest()}Qt.sha256=_n;function xm(e){return qu(_n(e))}Qt.hash160=xm;function Um(e){return _n(_n(e))}Qt.hash256=Um;var Tn=zr.Buffer;function Cm(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),i=s.charCodeAt(0);if(t[i]!==255)throw new TypeError(s+" is ambiguous");t[i]=n}var u=e.length,c=e.charAt(0),p=Math.log(u)/Math.log(256),g=Math.log(256)/Math.log(u);function y(S){if((Array.isArray(S)||S instanceof Uint8Array)&&(S=Tn.from(S)),!Tn.isBuffer(S))throw new TypeError("Expected Buffer");if(S.length===0)return"";for(var T=0,H=0,x=0,L=S.length;x!==L&&S[x]===0;)x++,T++;for(var M=(L-x)*g+1>>>0,N=new Uint8Array(M);x!==L;){for(var R=S[x],G=0,C=M-1;(R!==0||G<H)&&C!==-1;C--,G++)R+=256*N[C]>>>0,N[C]=R%u>>>0,R=R/u>>>0;if(R!==0)throw new Error("Non-zero carry");H=G,x++}for(var $=M-H;$!==M&&N[$]===0;)$++;for(var K=c.repeat(T);$<M;++$)K+=e.charAt(N[$]);return K}function b(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return Tn.alloc(0);for(var T=0,H=0,x=0;S[T]===c;)H++,T++;for(var L=(S.length-T)*p+1>>>0,M=new Uint8Array(L);S[T];){var N=t[S.charCodeAt(T)];if(N===255)return;for(var R=0,G=L-1;(N!==0||R<x)&&G!==-1;G--,R++)N+=u*M[G]>>>0,M[G]=N%256>>>0,N=N/256>>>0;if(N!==0)throw new Error("Non-zero carry");x=R,T++}for(var C=L-x;C!==L&&M[C]===0;)C++;var $=Tn.allocUnsafe(H+(L-C));$.fill(0,0,H);for(var K=H;C!==L;)$[K++]=M[C++];return $}function O(S){var T=b(S);if(T)return T;throw new Error("Non-base"+u+" character")}return{encode:y,decodeUnsafe:b,decode:O}}var Hm=Cm,Lm=Hm,Dm="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Xu=Lm(Dm);const Bm=Xr(Xu);var is=Xu,$m=zr.Buffer,Gm=function(e){function t(i){var u=e(i);return is.encode($m.concat([i,u],i.length+4))}function r(i){var u=i.slice(0,-4),c=i.slice(-4),p=e(u);if(!(c[0]^p[0]|c[1]^p[1]|c[2]^p[2]|c[3]^p[3]))return u}function n(i){var u=is.decodeUnsafe(i);if(u)return r(u)}function s(i){var u=is.decode(i),c=r(u);if(!c)throw new Error("Invalid checksum");return c}return{encode:t,decode:s,decodeUnsafe:n}},ju=jr(),Km=Gm;function Fm(e){var t=ju("sha256").update(e).digest();return ju("sha256").update(t).digest()}var Pn=Km(Fm);const zu=Xr(Pn);Object.defineProperty(ns,"__esModule",{value:!0});const ss=Qt,Wm=zt,vr=W,Se=me,ne=$t,Ce=vr.OPS,Yu=pe,Zu=Pn;function Vm(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),ne({network:ne.maybe(ne.Object),address:ne.maybe(ne.String),hash:ne.maybe(ne.BufferN(20)),output:ne.maybe(ne.BufferN(25)),pubkey:ne.maybe(Yu.isPoint),signature:ne.maybe(vr.isCanonicalScriptSignature),input:ne.maybe(ne.Buffer)},e);const r=Se.value(()=>{const u=Zu.decode(e.address),c=u.readUInt8(0),p=u.slice(1);return{version:c,hash:p}}),n=Se.value(()=>vr.decompile(e.input)),s=e.network||Wm.bitcoin,i={name:"p2pkh",network:s};if(Se.prop(i,"address",()=>{if(!i.hash)return;const u=m.allocUnsafe(21);return u.writeUInt8(s.pubKeyHash,0),i.hash.copy(u,1),Zu.encode(u)}),Se.prop(i,"hash",()=>{if(e.output)return e.output.slice(3,23);if(e.address)return r().hash;if(e.pubkey||i.pubkey)return ss.hash160(e.pubkey||i.pubkey)}),Se.prop(i,"output",()=>{if(i.hash)return vr.compile([Ce.OP_DUP,Ce.OP_HASH160,i.hash,Ce.OP_EQUALVERIFY,Ce.OP_CHECKSIG])}),Se.prop(i,"pubkey",()=>{if(e.input)return n()[1]}),Se.prop(i,"signature",()=>{if(e.input)return n()[0]}),Se.prop(i,"input",()=>{if(e.pubkey&&e.signature)return vr.compile([e.signature,e.pubkey])}),Se.prop(i,"witness",()=>{if(i.input)return[]}),t.validate){let u=m.from([]);if(e.address){if(r().version!==s.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(r().hash.length!==20)throw new TypeError("Invalid address");u=r().hash}if(e.hash){if(u.length>0&&!u.equals(e.hash))throw new TypeError("Hash mismatch");u=e.hash}if(e.output){if(e.output.length!==25||e.output[0]!==Ce.OP_DUP||e.output[1]!==Ce.OP_HASH160||e.output[2]!==20||e.output[23]!==Ce.OP_EQUALVERIFY||e.output[24]!==Ce.OP_CHECKSIG)throw new TypeError("Output is invalid");const c=e.output.slice(3,23);if(u.length>0&&!u.equals(c))throw new TypeError("Hash mismatch");u=c}if(e.pubkey){const c=ss.hash160(e.pubkey);if(u.length>0&&!u.equals(c))throw new TypeError("Hash mismatch");u=c}if(e.input){const c=n();if(c.length!==2)throw new TypeError("Input is invalid");if(!vr.isCanonicalScriptSignature(c[0]))throw new TypeError("Input has invalid signature");if(!Yu.isPoint(c[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(c[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(c[1]))throw new TypeError("Pubkey mismatch");const p=ss.hash160(c[1]);if(u.length>0&&!u.equals(p))throw new TypeError("Hash mismatch")}}return Object.assign(i,e)}ns.p2pkh=Vm;var os={};Object.defineProperty(os,"__esModule",{value:!0});const Qu=Qt,qm=zt,_e=W,ge=me,it=$t,On=_e.OPS,Ju=Pn;function Xm(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function jm(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),it({network:it.maybe(it.Object),address:it.maybe(it.String),hash:it.maybe(it.BufferN(20)),output:it.maybe(it.BufferN(23)),redeem:it.maybe({network:it.maybe(it.Object),output:it.maybe(it.Buffer),input:it.maybe(it.Buffer),witness:it.maybe(it.arrayOf(it.Buffer))}),input:it.maybe(it.Buffer),witness:it.maybe(it.arrayOf(it.Buffer))},e);let r=e.network;r||(r=e.redeem&&e.redeem.network||qm.bitcoin);const n={network:r},s=ge.value(()=>{const c=Ju.decode(e.address),p=c.readUInt8(0),g=c.slice(1);return{version:p,hash:g}}),i=ge.value(()=>_e.decompile(e.input)),u=ge.value(()=>{const c=i();return{network:r,output:c[c.length-1],input:_e.compile(c.slice(0,-1)),witness:e.witness||[]}});if(ge.prop(n,"address",()=>{if(!n.hash)return;const c=m.allocUnsafe(21);return c.writeUInt8(n.network.scriptHash,0),n.hash.copy(c,1),Ju.encode(c)}),ge.prop(n,"hash",()=>{if(e.output)return e.output.slice(2,22);if(e.address)return s().hash;if(n.redeem&&n.redeem.output)return Qu.hash160(n.redeem.output)}),ge.prop(n,"output",()=>{if(n.hash)return _e.compile([On.OP_HASH160,n.hash,On.OP_EQUAL])}),ge.prop(n,"redeem",()=>{if(e.input)return u()}),ge.prop(n,"input",()=>{if(!(!e.redeem||!e.redeem.input||!e.redeem.output))return _e.compile([].concat(_e.decompile(e.redeem.input),e.redeem.output))}),ge.prop(n,"witness",()=>{if(n.redeem&&n.redeem.witness)return n.redeem.witness;if(n.input)return[]}),ge.prop(n,"name",()=>{const c=["p2sh"];return n.redeem!==void 0&&c.push(n.redeem.name),c.join("-")}),t.validate){let c=m.from([]);if(e.address){if(s().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(s().hash.length!==20)throw new TypeError("Invalid address");c=s().hash}if(e.hash){if(c.length>0&&!c.equals(e.hash))throw new TypeError("Hash mismatch");c=e.hash}if(e.output){if(e.output.length!==23||e.output[0]!==On.OP_HASH160||e.output[1]!==20||e.output[22]!==On.OP_EQUAL)throw new TypeError("Output is invalid");const g=e.output.slice(2,22);if(c.length>0&&!c.equals(g))throw new TypeError("Hash mismatch");c=g}const p=g=>{if(g.output){const y=_e.decompile(g.output);if(!y||y.length<1)throw new TypeError("Redeem.output too short");const b=Qu.hash160(g.output);if(c.length>0&&!c.equals(b))throw new TypeError("Hash mismatch");c=b}if(g.input){const y=g.input.length>0,b=g.witness&&g.witness.length>0;if(!y&&!b)throw new TypeError("Empty input");if(y&&b)throw new TypeError("Input and witness provided");if(y){const O=_e.decompile(g.input);if(!_e.isPushOnly(O))throw new TypeError("Non push-only scriptSig")}}};if(e.input){const g=i();if(!g||g.length<1)throw new TypeError("Input too short");if(!m.isBuffer(u().output))throw new TypeError("Input is invalid");p(u())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==r)throw new TypeError("Network mismatch");if(e.input){const g=u();if(e.redeem.output&&!e.redeem.output.equals(g.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(g.input))throw new TypeError("Redeem.input mismatch")}p(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!Xm(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,e)}os.p2sh=jm;var us={};Object.defineProperty(us,"__esModule",{value:!0});const as=Qt,zm=zt,Mn=W,He=me,Yt=$t,ta=Mn.OPS,hs=pe,An=_i,Ym=m.alloc(0);function Zm(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),Yt({address:Yt.maybe(Yt.String),hash:Yt.maybe(Yt.BufferN(20)),input:Yt.maybe(Yt.BufferN(0)),network:Yt.maybe(Yt.Object),output:Yt.maybe(Yt.BufferN(22)),pubkey:Yt.maybe(hs.isPoint),signature:Yt.maybe(Mn.isCanonicalScriptSignature),witness:Yt.maybe(Yt.arrayOf(Yt.Buffer))},e);const r=He.value(()=>{const i=An.decode(e.address),u=i.words.shift(),c=An.fromWords(i.words);return{version:u,prefix:i.prefix,data:m.from(c)}}),n=e.network||zm.bitcoin,s={name:"p2wpkh",network:n};if(He.prop(s,"address",()=>{if(!s.hash)return;const i=An.toWords(s.hash);return i.unshift(0),An.encode(n.bech32,i)}),He.prop(s,"hash",()=>{if(e.output)return e.output.slice(2,22);if(e.address)return r().data;if(e.pubkey||s.pubkey)return as.hash160(e.pubkey||s.pubkey)}),He.prop(s,"output",()=>{if(s.hash)return Mn.compile([ta.OP_0,s.hash])}),He.prop(s,"pubkey",()=>{if(e.pubkey)return e.pubkey;if(e.witness)return e.witness[1]}),He.prop(s,"signature",()=>{if(e.witness)return e.witness[0]}),He.prop(s,"input",()=>{if(s.witness)return Ym}),He.prop(s,"witness",()=>{if(e.pubkey&&e.signature)return[e.signature,e.pubkey]}),t.validate){let i=m.from([]);if(e.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==20)throw new TypeError("Invalid address data");i=r().data}if(e.hash){if(i.length>0&&!i.equals(e.hash))throw new TypeError("Hash mismatch");i=e.hash}if(e.output){if(e.output.length!==22||e.output[0]!==ta.OP_0||e.output[1]!==20)throw new TypeError("Output is invalid");if(i.length>0&&!i.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");i=e.output.slice(2)}if(e.pubkey){const u=as.hash160(e.pubkey);if(i.length>0&&!i.equals(u))throw new TypeError("Hash mismatch");if(i=u,!hs.isPoint(e.pubkey)||e.pubkey.length!==33)throw new TypeError("Invalid pubkey for p2wpkh")}if(e.witness){if(e.witness.length!==2)throw new TypeError("Witness is invalid");if(!Mn.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!hs.isPoint(e.witness[1])||e.witness[1].length!==33)throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");const u=as.hash160(e.witness[1]);if(i.length>0&&!i.equals(u))throw new TypeError("Hash mismatch")}}return Object.assign(s,e)}us.p2wpkh=Zm;var cs={};Object.defineProperty(cs,"__esModule",{value:!0});const ea=Qt,Qm=zt,Le=W,Te=me,st=$t,ra=Le.OPS,Jm=pe,Nn=_i,ls=m.alloc(0);function tg(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function kn(e){return!!(m.isBuffer(e)&&e.length===65&&e[0]===4&&Jm.isPoint(e))}function eg(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),st({network:st.maybe(st.Object),address:st.maybe(st.String),hash:st.maybe(st.BufferN(32)),output:st.maybe(st.BufferN(34)),redeem:st.maybe({input:st.maybe(st.Buffer),network:st.maybe(st.Object),output:st.maybe(st.Buffer),witness:st.maybe(st.arrayOf(st.Buffer))}),input:st.maybe(st.BufferN(0)),witness:st.maybe(st.arrayOf(st.Buffer))},e);const r=Te.value(()=>{const u=Nn.decode(e.address),c=u.words.shift(),p=Nn.fromWords(u.words);return{version:c,prefix:u.prefix,data:m.from(p)}}),n=Te.value(()=>Le.decompile(e.redeem.input));let s=e.network;s||(s=e.redeem&&e.redeem.network||Qm.bitcoin);const i={network:s};if(Te.prop(i,"address",()=>{if(!i.hash)return;const u=Nn.toWords(i.hash);return u.unshift(0),Nn.encode(s.bech32,u)}),Te.prop(i,"hash",()=>{if(e.output)return e.output.slice(2);if(e.address)return r().data;if(i.redeem&&i.redeem.output)return ea.sha256(i.redeem.output)}),Te.prop(i,"output",()=>{if(i.hash)return Le.compile([ra.OP_0,i.hash])}),Te.prop(i,"redeem",()=>{if(e.witness)return{output:e.witness[e.witness.length-1],input:ls,witness:e.witness.slice(0,-1)}}),Te.prop(i,"input",()=>{if(i.witness)return ls}),Te.prop(i,"witness",()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){const u=Le.toStack(n());return i.redeem=Object.assign({witness:u},e.redeem),i.redeem.input=ls,[].concat(u,e.redeem.output)}if(e.redeem&&e.redeem.output&&e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)}),Te.prop(i,"name",()=>{const u=["p2wsh"];return i.redeem!==void 0&&u.push(i.redeem.name),u.join("-")}),t.validate){let u=m.from([]);if(e.address){if(r().prefix!==s.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==32)throw new TypeError("Invalid address data");u=r().data}if(e.hash){if(u.length>0&&!u.equals(e.hash))throw new TypeError("Hash mismatch");u=e.hash}if(e.output){if(e.output.length!==34||e.output[0]!==ra.OP_0||e.output[1]!==32)throw new TypeError("Output is invalid");const c=e.output.slice(2);if(u.length>0&&!u.equals(c))throw new TypeError("Hash mismatch");u=c}if(e.redeem){if(e.redeem.network&&e.redeem.network!==s)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){if(Le.decompile(e.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");const c=ea.sha256(e.redeem.output);if(u.length>0&&!u.equals(c))throw new TypeError("Hash mismatch");u=c}if(e.redeem.input&&!Le.isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!tg(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(e.redeem.input&&n().some(kn)||e.redeem.output&&(Le.decompile(e.redeem.output)||[]).some(kn))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(e.witness&&e.witness.length>0){const c=e.witness[e.witness.length-1];if(e.redeem&&e.redeem.output&&!e.redeem.output.equals(c))throw new TypeError("Witness and redeem.output mismatch");if(e.witness.some(kn)||(Le.decompile(c)||[]).some(kn))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(i,e)}cs.p2wsh=eg,Object.defineProperty(se,"__esModule",{value:!0});const rg=Ji;se.embed=rg.p2data;const ng=es;se.p2ms=ng.p2ms;const ig=rs;se.p2pk=ig.p2pk;const sg=ns;se.p2pkh=sg.p2pkh;const og=os;se.p2sh=og.p2sh;const ug=us;se.p2wpkh=ug.p2wpkh;const ag=cs;se.p2wsh=ag.p2wsh,Object.defineProperty(de,"__esModule",{value:!0});const na=zt,De=se,hg=W,ps=X,Rn=_i,ia=Pn,cg=$t;function sa(e){const t=ia.decode(e);if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");const r=t.readUInt8(0),n=t.slice(1);return{version:r,hash:n}}de.fromBase58Check=sa;function oa(e){const t=Rn.decode(e),r=Rn.fromWords(t.words.slice(1));return{version:t.words[0],prefix:t.prefix,data:m.from(r)}}de.fromBech32=oa;function lg(e,t){cg(ps.tuple(ps.Hash160bit,ps.UInt8),arguments);const r=m.allocUnsafe(21);return r.writeUInt8(t,0),e.copy(r,1),ia.encode(r)}de.toBase58Check=lg;function pg(e,t,r){const n=Rn.toWords(e);return n.unshift(t),Rn.encode(r,n)}de.toBech32=pg;function fg(e,t){t=t||na.bitcoin;try{return De.p2pkh({output:e,network:t}).address}catch{}try{return De.p2sh({output:e,network:t}).address}catch{}try{return De.p2wpkh({output:e,network:t}).address}catch{}try{return De.p2wsh({output:e,network:t}).address}catch{}throw new Error(hg.toASM(e)+" has no matching Address")}de.fromOutputScript=fg;function dg(e,t){t=t||na.bitcoin;let r,n;try{r=sa(e)}catch{}if(r){if(r.version===t.pubKeyHash)return De.p2pkh({hash:r.hash}).output;if(r.version===t.scriptHash)return De.p2sh({hash:r.hash}).output}else{try{n=oa(e)}catch{}if(n){if(n.prefix!==t.bech32)throw new Error(e+" has an invalid prefix");if(n.version===0){if(n.data.length===20)return De.p2wpkh({hash:n.data}).output;if(n.data.length===32)return De.p2wsh({hash:n.data}).output}}}throw new Error(e+" has no matching Script")}de.toOutputScript=dg;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});const ua=zt,ze=X,Pe=pe,mg=nc(),$e=$t,aa=Co,fs=$e.maybe($e.compile({compressed:ze.maybe(ze.Boolean),network:ze.maybe(ze.Network)}));let ha=class{constructor(e,t,r){this.__D=e,this.__Q=t,this.lowR=!1,r===void 0&&(r={}),this.compressed=r.compressed===void 0?!0:r.compressed,this.network=r.network||ua.bitcoin,t!==void 0&&(this.__Q=Pe.pointCompress(t,this.compressed))}get privateKey(){return this.__D}get publicKey(){return this.__Q||(this.__Q=Pe.pointFromScalar(this.__D,this.compressed)),this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return aa.encode(this.network.wif,this.__D,this.compressed)}sign(e,t){if(!this.__D)throw new Error("Missing private key");if(t===void 0&&(t=this.lowR),t===!1)return Pe.sign(e,this.__D);{let r=Pe.sign(e,this.__D);const n=m.alloc(32,0);let s=0;for(;r[0]>127;)s++,n.writeUIntLE(s,0,6),r=Pe.signWithEntropy(e,this.__D,n);return r}}verify(e,t){return Pe.verify(e,this.publicKey,t)}};function ds(e,t){if($e(ze.Buffer256bit,e),!Pe.isPrivate(e))throw new TypeError("Private key not in range [1, n)");return $e(fs,t),new ha(e,void 0,t)}Be.fromPrivateKey=ds;function gg(e,t){return $e(Pe.isPoint,e),$e(fs,t),new ha(void 0,e,t)}Be.fromPublicKey=gg;function wg(e,t){const r=aa.decode(e),n=r.version;if(ze.Array(t)){if(t=t.filter(s=>n===s.wif).pop(),!t)throw new Error("Unknown network version")}else if(t=t||ua.bitcoin,n!==t.wif)throw new Error("Invalid network version");return ds(r.privateKey,{compressed:r.compressed,network:t})}Be.fromWIF=wg;function vg(e){$e(fs,e),e===void 0&&(e={});const t=e.rng||mg;let r;do r=t(32),$e(ze.Buffer256bit,r);while(!Pe.isPrivate(r));return ds(r,e)}Be.makeRandom=vg;var ms={},le={};Object.defineProperty(le,"__esModule",{value:!0});const yr=X,ca=$t,xn=Ti;function la(e,t){if(typeof e!="number")throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function pa(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,la(n+r,9007199254740991),n+r}le.readUInt64LE=pa;function fa(e,t,r){return la(t,9007199254740991),e.writeInt32LE(t&-1,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}le.writeUInt64LE=fa;function yg(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e}le.reverseBuffer=yg;function Eg(e){const t=m.allocUnsafe(e.length);return e.copy(t),t}le.cloneBuffer=Eg;let Ig=class{constructor(e,t=0){this.buffer=e,this.offset=t,ca(yr.tuple(yr.Buffer,yr.UInt32),[e,t])}writeUInt8(e){this.offset=this.buffer.writeUInt8(e,this.offset)}writeInt32(e){this.offset=this.buffer.writeInt32LE(e,this.offset)}writeUInt32(e){this.offset=this.buffer.writeUInt32LE(e,this.offset)}writeUInt64(e){this.offset=fa(this.buffer,e,this.offset)}writeVarInt(e){xn.encode(e,this.buffer,this.offset),this.offset+=xn.encode.bytes}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.offset+=e.copy(this.buffer,this.offset)}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach(t=>this.writeVarSlice(t))}};le.BufferWriter=Ig;let bg=class{constructor(e,t=0){this.buffer=e,this.offset=t,ca(yr.tuple(yr.Buffer,yr.UInt32),[e,t])}readUInt8(){const e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){const e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){const e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){const e=pa(this.buffer,this.offset);return this.offset+=8,e}readVarInt(){const e=xn.decode(this.buffer,this.offset);return this.offset+=xn.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),t=[];for(let r=0;r<e;r++)t.push(this.readVarSlice());return t}};le.BufferReader=bg;var Er={};Object.defineProperty(Er,"__esModule",{value:!0});const Ge=le,Ye=Qt,da=W,Sg=W,J=X,Ze=$t,Un=Ti;function Ir(e){const t=e.length;return Un.encodingLength(t)+t}function _g(e){const t=e.length;return Un.encodingLength(t)+e.reduce((r,n)=>r+Ir(n),0)}const gs=m.allocUnsafe(0),ma=[],ws=m.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),ga=m.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),Tg=m.from("ffffffffffffffff","hex"),Pg={script:gs,valueBuffer:Tg};function Og(e){return e.value!==void 0}class Q{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(t,r){const n=new Ge.BufferReader(t),s=new Q;s.version=n.readInt32();const i=n.readUInt8(),u=n.readUInt8();let c=!1;i===Q.ADVANCED_TRANSACTION_MARKER&&u===Q.ADVANCED_TRANSACTION_FLAG?c=!0:n.offset-=2;const p=n.readVarInt();for(let y=0;y<p;++y)s.ins.push({hash:n.readSlice(32),index:n.readUInt32(),script:n.readVarSlice(),sequence:n.readUInt32(),witness:ma});const g=n.readVarInt();for(let y=0;y<g;++y)s.outs.push({value:n.readUInt64(),script:n.readVarSlice()});if(c){for(let y=0;y<p;++y)s.ins[y].witness=n.readVector();if(!s.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(s.locktime=n.readUInt32(),r)return s;if(n.offset!==t.length)throw new Error("Transaction has unexpected data");return s}static fromHex(t){return Q.fromBuffer(m.from(t,"hex"),!1)}static isCoinbaseHash(t){Ze(J.Hash256bit,t);for(let r=0;r<32;++r)if(t[r]!==0)return!1;return!0}isCoinbase(){return this.ins.length===1&&Q.isCoinbaseHash(this.ins[0].hash)}addInput(t,r,n,s){return Ze(J.tuple(J.Hash256bit,J.UInt32,J.maybe(J.UInt32),J.maybe(J.Buffer)),arguments),J.Null(n)&&(n=Q.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:r,script:s||gs,sequence:n,witness:ma})-1}addOutput(t,r){return Ze(J.tuple(J.Buffer,J.Satoshi),arguments),this.outs.push({script:t,value:r})-1}hasWitnesses(){return this.ins.some(t=>t.witness.length!==0)}weight(){const t=this.byteLength(!1),r=this.byteLength(!0);return t*3+r}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(t=!0){const r=t&&this.hasWitnesses();return(r?10:8)+Un.encodingLength(this.ins.length)+Un.encodingLength(this.outs.length)+this.ins.reduce((n,s)=>n+40+Ir(s.script),0)+this.outs.reduce((n,s)=>n+8+Ir(s.script),0)+(r?this.ins.reduce((n,s)=>n+_g(s.witness),0):0)}clone(){const t=new Q;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map(r=>({hash:r.hash,index:r.index,script:r.script,sequence:r.sequence,witness:r.witness})),t.outs=this.outs.map(r=>({script:r.script,value:r.value})),t}hashForSignature(t,r,n){if(Ze(J.tuple(J.UInt32,J.Buffer,J.Number),arguments),t>=this.ins.length)return ga;const s=da.compile(da.decompile(r).filter(c=>c!==Sg.OPS.OP_CODESEPARATOR)),i=this.clone();if((n&31)===Q.SIGHASH_NONE)i.outs=[],i.ins.forEach((c,p)=>{p!==t&&(c.sequence=0)});else if((n&31)===Q.SIGHASH_SINGLE){if(t>=this.outs.length)return ga;i.outs.length=t+1;for(let c=0;c<t;c++)i.outs[c]=Pg;i.ins.forEach((c,p)=>{p!==t&&(c.sequence=0)})}n&Q.SIGHASH_ANYONECANPAY?(i.ins=[i.ins[t]],i.ins[0].script=s):(i.ins.forEach(c=>{c.script=gs}),i.ins[t].script=s);const u=m.allocUnsafe(i.byteLength(!1)+4);return u.writeInt32LE(n,u.length-4),i.__toBuffer(u,0,!1),Ye.hash256(u)}hashForWitnessV0(t,r,n,s){Ze(J.tuple(J.UInt32,J.Buffer,J.Satoshi,J.UInt32),arguments);let i=m.from([]),u,c=ws,p=ws,g=ws;if(s&Q.SIGHASH_ANYONECANPAY||(i=m.allocUnsafe(36*this.ins.length),u=new Ge.BufferWriter(i,0),this.ins.forEach(b=>{u.writeSlice(b.hash),u.writeUInt32(b.index)}),p=Ye.hash256(i)),!(s&Q.SIGHASH_ANYONECANPAY)&&(s&31)!==Q.SIGHASH_SINGLE&&(s&31)!==Q.SIGHASH_NONE&&(i=m.allocUnsafe(4*this.ins.length),u=new Ge.BufferWriter(i,0),this.ins.forEach(b=>{u.writeUInt32(b.sequence)}),g=Ye.hash256(i)),(s&31)!==Q.SIGHASH_SINGLE&&(s&31)!==Q.SIGHASH_NONE){const b=this.outs.reduce((O,S)=>O+8+Ir(S.script),0);i=m.allocUnsafe(b),u=new Ge.BufferWriter(i,0),this.outs.forEach(O=>{u.writeUInt64(O.value),u.writeVarSlice(O.script)}),c=Ye.hash256(i)}else if((s&31)===Q.SIGHASH_SINGLE&&t<this.outs.length){const b=this.outs[t];i=m.allocUnsafe(8+Ir(b.script)),u=new Ge.BufferWriter(i,0),u.writeUInt64(b.value),u.writeVarSlice(b.script),c=Ye.hash256(i)}i=m.allocUnsafe(156+Ir(r)),u=new Ge.BufferWriter(i,0);const y=this.ins[t];return u.writeUInt32(this.version),u.writeSlice(p),u.writeSlice(g),u.writeSlice(y.hash),u.writeUInt32(y.index),u.writeVarSlice(r),u.writeUInt64(n),u.writeUInt32(y.sequence),u.writeSlice(c),u.writeUInt32(this.locktime),u.writeUInt32(s),Ye.hash256(i)}getHash(t){return t&&this.isCoinbase()?m.alloc(32,0):Ye.hash256(this.__toBuffer(void 0,void 0,t))}getId(){return Ge.reverseBuffer(this.getHash(!1)).toString("hex")}toBuffer(t,r){return this.__toBuffer(t,r,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(t,r){Ze(J.tuple(J.Number,J.Buffer),arguments),this.ins[t].script=r}setWitness(t,r){Ze(J.tuple(J.Number,[J.Buffer]),arguments),this.ins[t].witness=r}__toBuffer(t,r,n=!1){t||(t=m.allocUnsafe(this.byteLength(n)));const s=new Ge.BufferWriter(t,r||0);s.writeInt32(this.version);const i=n&&this.hasWitnesses();return i&&(s.writeUInt8(Q.ADVANCED_TRANSACTION_MARKER),s.writeUInt8(Q.ADVANCED_TRANSACTION_FLAG)),s.writeVarInt(this.ins.length),this.ins.forEach(u=>{s.writeSlice(u.hash),s.writeUInt32(u.index),s.writeVarSlice(u.script),s.writeUInt32(u.sequence)}),s.writeVarInt(this.outs.length),this.outs.forEach(u=>{Og(u)?s.writeUInt64(u.value):s.writeSlice(u.valueBuffer),s.writeVarSlice(u.script)}),i&&this.ins.forEach(u=>{s.writeVector(u.witness)}),s.writeUInt32(this.locktime),r!==void 0?t.slice(r,s.offset):t}}Q.DEFAULT_SEQUENCE=4294967295,Q.SIGHASH_ALL=1,Q.SIGHASH_NONE=2,Q.SIGHASH_SINGLE=3,Q.SIGHASH_ANYONECANPAY=128,Q.ADVANCED_TRANSACTION_MARKER=0,Q.ADVANCED_TRANSACTION_FLAG=1,Er.Transaction=Q,Object.defineProperty(ms,"__esModule",{value:!0});const Cn=le,vs=Qt,Mg=Er,Ag=X,Ng=ic,kg=$t,ys=Ti,Es=new TypeError("Cannot compute merkle root for zero transactions"),wa=new TypeError("Cannot compute witness commit for non-segwit block");class or{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(t){if(t.length<80)throw new Error("Buffer too small (< 80 bytes)");const r=new Cn.BufferReader(t),n=new or;if(n.version=r.readInt32(),n.prevHash=r.readSlice(32),n.merkleRoot=r.readSlice(32),n.timestamp=r.readUInt32(),n.bits=r.readUInt32(),n.nonce=r.readUInt32(),t.length===80)return n;const s=()=>{const c=Mg.Transaction.fromBuffer(r.buffer.slice(r.offset),!0);return r.offset+=c.byteLength(),c},i=r.readVarInt();n.transactions=[];for(let c=0;c<i;++c){const p=s();n.transactions.push(p)}const u=n.getWitnessCommit();return u&&(n.witnessCommit=u),n}static fromHex(t){return or.fromBuffer(m.from(t,"hex"))}static calculateTarget(t){const r=((t&4278190080)>>24)-3,n=t&8388607,s=m.alloc(32,0);return s.writeUIntBE(n,29-r,3),s}static calculateMerkleRoot(t,r){if(kg([{getHash:Ag.Function}],t),t.length===0)throw Es;if(r&&!va(t))throw wa;const n=t.map(i=>i.getHash(r)),s=Ng(n,vs.hash256);return r?vs.hash256(m.concat([s,t[0].ins[0].witness[0]])):s}getWitnessCommit(){if(!va(this.transactions))return null;const t=this.transactions[0].outs.filter(n=>n.script.slice(0,6).equals(m.from("6a24aa21a9ed","hex"))).map(n=>n.script.slice(6,38));if(t.length===0)return null;const r=t[t.length-1];return r instanceof m&&r.length===32?r:null}hasWitnessCommit(){return this.witnessCommit instanceof m&&this.witnessCommit.length===32||this.getWitnessCommit()!==null}hasWitness(){return Rg(this.transactions)}weight(){const t=this.byteLength(!1,!1),r=this.byteLength(!1,!0);return t*3+r}byteLength(t,r=!0){return t||!this.transactions?80:80+ys.encodingLength(this.transactions.length)+this.transactions.reduce((n,s)=>n+s.byteLength(r),0)}getHash(){return vs.hash256(this.toBuffer(!0))}getId(){return Cn.reverseBuffer(this.getHash()).toString("hex")}getUTCDate(){const t=new Date(0);return t.setUTCSeconds(this.timestamp),t}toBuffer(t){const r=m.allocUnsafe(this.byteLength(t)),n=new Cn.BufferWriter(r);return n.writeInt32(this.version),n.writeSlice(this.prevHash),n.writeSlice(this.merkleRoot),n.writeUInt32(this.timestamp),n.writeUInt32(this.bits),n.writeUInt32(this.nonce),t||!this.transactions||(ys.encode(this.transactions.length,r,n.offset),n.offset+=ys.encode.bytes,this.transactions.forEach(s=>{const i=s.byteLength();s.toBuffer(r,n.offset),n.offset+=i})),r}toHex(t){return this.toBuffer(t).toString("hex")}checkTxRoots(){const t=this.hasWitnessCommit();return!t&&this.hasWitness()?!1:this.__checkMerkleRoot()&&(t?this.__checkWitnessCommit():!0)}checkProofOfWork(){const t=Cn.reverseBuffer(this.getHash()),r=or.calculateTarget(this.bits);return t.compare(r)<=0}__checkMerkleRoot(){if(!this.transactions)throw Es;const t=or.calculateMerkleRoot(this.transactions);return this.merkleRoot.compare(t)===0}__checkWitnessCommit(){if(!this.transactions)throw Es;if(!this.hasWitnessCommit())throw wa;const t=or.calculateMerkleRoot(this.transactions,!0);return this.witnessCommit.compare(t)===0}}ms.Block=or;function va(e){return e instanceof Array&&e[0]&&e[0].ins&&e[0].ins instanceof Array&&e[0].ins[0]&&e[0].ins[0].witness&&e[0].ins[0].witness instanceof Array&&e[0].ins[0].witness.length>0}function Rg(e){return e instanceof Array&&e.some(t=>typeof t=="object"&&t.ins instanceof Array&&t.ins.some(r=>typeof r=="object"&&r.witness instanceof Array&&r.witness.length>0))}var Is={};Object.defineProperty(Is,"__esModule",{value:!0});const ya=sc,Hn=uc,we=oc,Ea=de,Ln=le,xg=Qt,Ia=Be,Ug=zt,Xt=se,Jt=W,Gt=Er,Cg={network:Ug.bitcoin,maximumFeeRate:5e3};class ii{constructor(t={},r=new ya.Psbt(new ba)){this.data=r,this.opts=Object.assign({},Cg,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},this.data.inputs.length===0&&this.setVersion(2);const n=(s,i,u,c)=>Object.defineProperty(s,i,{enumerable:u,writable:c});n(this,"__CACHE",!1,!0),n(this,"opts",!1,!0)}static fromBase64(t,r={}){const n=m.from(t,"base64");return this.fromBuffer(n,r)}static fromHex(t,r={}){const n=m.from(t,"hex");return this.fromBuffer(n,r)}static fromBuffer(t,r={}){const n=ya.Psbt.fromBuffer(t,Hg),s=new ii(r,n);return Wg(s.__CACHE.__TX,s.__CACHE),s}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(t){this.setVersion(t)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(t){this.setLocktime(t)}get txInputs(){return this.__CACHE.__TX.ins.map(t=>({hash:Ln.cloneBuffer(t.hash),index:t.index,sequence:t.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map(t=>{let r;try{r=Ea.fromOutputScript(t.script,this.opts.network)}catch{}return{script:Ln.cloneBuffer(t.script),value:t.value,address:r}})}combine(...t){return this.data.combine(...t.map(r=>r.data)),this}clone(){const t=ii.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){Bn(t),this.opts.maximumFeeRate=t}setVersion(t){Bn(t),Dr(this.data.inputs,"setVersion");const r=this.__CACHE;return r.__TX.version=t,r.__EXTRACTED_TX=void 0,this}setLocktime(t){Bn(t),Dr(this.data.inputs,"setLocktime");const r=this.__CACHE;return r.__TX.locktime=t,r.__EXTRACTED_TX=void 0,this}setInputSequence(t,r){Bn(r),Dr(this.data.inputs,"setInputSequence");const n=this.__CACHE;if(n.__TX.ins.length<=t)throw new Error("Input index too high");return n.__TX.ins[t].sequence=r,n.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach(r=>this.addInput(r)),this}addInput(t){if(arguments.length>1||!t||t.hash===void 0||t.index===void 0)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");Dr(this.data.inputs,"addInput"),t.witnessScript&&Kn(t.witnessScript);const r=this.__CACHE;this.data.addInput(t);const n=r.__TX.ins[r.__TX.ins.length-1];Aa(r,n);const s=this.data.inputs.length-1,i=this.data.inputs[s];return i.nonWitnessUtxo&&Ss(this.__CACHE,i,s),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach(r=>this.addOutput(r)),this}addOutput(t){if(arguments.length>1||!t||t.value===void 0||t.address===void 0&&t.script===void 0)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");Dr(this.data.inputs,"addOutput");const{address:r}=t;if(typeof r=="string"){const{network:s}=this.opts,i=Ea.toOutputScript(r,s);t=Object.assign(t,{script:i})}const n=this.__CACHE;return this.data.addOutput(t),n.__FEE=void 0,n.__FEE_RATE=void 0,n.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(_a))throw new Error("Not finalized");const r=this.__CACHE;if(t||Gg(this,r,this.opts),r.__EXTRACTED_TX)return r.__EXTRACTED_TX;const n=r.__TX.clone();return Ba(this.data.inputs,n,r,!0),n}getFeeRate(){return xa("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return xa("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return we.checkForInput(this.data.inputs,0),Br(this.data.inputs.length).forEach(t=>this.finalizeInput(t)),this}finalizeInput(t,r=Vg){const n=we.checkForInput(this.data.inputs,t),{script:s,isP2SH:i,isP2WSH:u,isSegwit:c}=zg(t,n,this.__CACHE);if(!s)throw new Error(`No script found for input #${t}`);Kg(n);const{finalScriptSig:p,finalScriptWitness:g}=r(t,n,s,c,i,u);if(p&&this.data.updateInput(t,{finalScriptSig:p}),g&&this.data.updateInput(t,{finalScriptWitness:g}),!p&&!g)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}getInputType(t){const r=we.checkForInput(this.data.inputs,t),n=$a(t,r,this.__CACHE),s=Gn(n,t,"input",r.redeemScript||tw(r.finalScriptSig),r.witnessScript||ew(r.finalScriptWitness)),i=s.type==="raw"?"":s.type+"-",u=Ka(s.meaningfulScript);return i+u}inputHasPubkey(t,r){const n=we.checkForInput(this.data.inputs,t);return Qg(r,n,t,this.__CACHE)}inputHasHDKey(t,r){const n=we.checkForInput(this.data.inputs,t),s=Oa(r);return!!n.bip32Derivation&&n.bip32Derivation.some(s)}outputHasPubkey(t,r){const n=we.checkForOutput(this.data.outputs,t);return Jg(r,n,t,this.__CACHE)}outputHasHDKey(t,r){const n=we.checkForOutput(this.data.outputs,t),s=Oa(r);return!!n.bip32Derivation&&n.bip32Derivation.some(s)}validateSignaturesOfAllInputs(){return we.checkForInput(this.data.inputs,0),Br(this.data.inputs.length).map(t=>this.validateSignaturesOfInput(t)).reduce((t,r)=>r===!0&&t,!0)}validateSignaturesOfInput(t,r){const n=this.data.inputs[t],s=(n||{}).partialSig;if(!n||!s||s.length<1)throw new Error("No signatures to validate");const i=r?s.filter(y=>y.pubkey.equals(r)):s;if(i.length<1)throw new Error("No signatures for this pubkey");const u=[];let c,p,g;for(const y of i){const b=Jt.signature.decode(y.signature),{hash:O,script:S}=g!==b.hashType?Ca(t,Object.assign({},n,{sighashType:b.hashType}),this.__CACHE,!0):{hash:c,script:p};g=b.hashType,c=O,p=S,Ma(y.pubkey,S,"verify");const T=Ia.fromPublicKey(y.pubkey);u.push(T.verify(O,b.signature))}return u.every(y=>y===!0)}signAllInputsHD(t,r=[Gt.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");const n=[];for(const s of Br(this.data.inputs.length))try{this.signInputHD(s,t,r),n.push(!0)}catch{n.push(!1)}if(n.every(s=>s===!1))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,r=[Gt.Transaction.SIGHASH_ALL]){return new Promise((n,s)=>{if(!t||!t.publicKey||!t.fingerprint)return s(new Error("Need HDSigner to sign input"));const i=[],u=[];for(const c of Br(this.data.inputs.length))u.push(this.signInputHDAsync(c,t,r).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(u).then(()=>{if(i.every(c=>c===!1))return s(new Error("No inputs were signed"));n()})})}signInputHD(t,r,n=[Gt.Transaction.SIGHASH_ALL]){if(!r||!r.publicKey||!r.fingerprint)throw new Error("Need HDSigner to sign input");return Ha(t,this.data.inputs,r).forEach(s=>this.signInput(t,s,n)),this}signInputHDAsync(t,r,n=[Gt.Transaction.SIGHASH_ALL]){return new Promise((s,i)=>{if(!r||!r.publicKey||!r.fingerprint)return i(new Error("Need HDSigner to sign input"));const u=Ha(t,this.data.inputs,r).map(c=>this.signInputAsync(t,c,n));return Promise.all(u).then(()=>{s()}).catch(i)})}signAllInputs(t,r=[Gt.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=[];for(const s of Br(this.data.inputs.length))try{this.signInput(s,t,r),n.push(!0)}catch{n.push(!1)}if(n.every(s=>s===!1))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,r=[Gt.Transaction.SIGHASH_ALL]){return new Promise((n,s)=>{if(!t||!t.publicKey)return s(new Error("Need Signer to sign input"));const i=[],u=[];for(const[c]of this.data.inputs.entries())u.push(this.signInputAsync(c,t,r).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(u).then(()=>{if(i.every(c=>c===!1))return s(new Error("No inputs were signed"));n()})})}signInput(t,r,n=[Gt.Transaction.SIGHASH_ALL]){if(!r||!r.publicKey)throw new Error("Need Signer to sign input");const{hash:s,sighashType:i}=Ua(this.data.inputs,t,r.publicKey,this.__CACHE,n),u=[{pubkey:r.publicKey,signature:Jt.signature.encode(r.sign(s),i)}];return this.data.updateInput(t,{partialSig:u}),this}signInputAsync(t,r,n=[Gt.Transaction.SIGHASH_ALL]){return Promise.resolve().then(()=>{if(!r||!r.publicKey)throw new Error("Need Signer to sign input");const{hash:s,sighashType:i}=Ua(this.data.inputs,t,r.publicKey,this.__CACHE,n);return Promise.resolve(r.sign(s)).then(u=>{const c=[{pubkey:r.publicKey,signature:Jt.signature.encode(u,i)}];this.data.updateInput(t,{partialSig:c})})})}toBuffer(){return bs(this.__CACHE),this.data.toBuffer()}toHex(){return bs(this.__CACHE),this.data.toHex()}toBase64(){return bs(this.__CACHE),this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,r){return r.witnessScript&&Kn(r.witnessScript),this.data.updateInput(t,r),r.nonWitnessUtxo&&Ss(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,r){return this.data.updateOutput(t,r),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,r){return this.data.addUnknownKeyValToInput(t,r),this}addUnknownKeyValToOutput(t,r){return this.data.addUnknownKeyValToOutput(t,r),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}}Is.Psbt=ii;const Hg=e=>new ba(e);class ba{constructor(t=m.from([2,0,0,0,0,0,0,0,0,0])){this.tx=Gt.Transaction.fromBuffer(t),Fg(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(t.hash===void 0||t.index===void 0||!m.isBuffer(t.hash)&&typeof t.hash!="string"||typeof t.index!="number")throw new Error("Error adding input.");const r=typeof t.hash=="string"?Ln.reverseBuffer(m.from(t.hash,"hex")):t.hash;this.tx.addInput(r,t.index,t.sequence)}addOutput(t){if(t.script===void 0||t.value===void 0||!m.isBuffer(t.script)||typeof t.value!="number")throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}}function Lg(e,t,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return Sa(1,e.partialSig);case"multisig":const n=Xt.p2ms({output:t});return Sa(n.m,e.partialSig,n.pubkeys);default:return!1}}function bs(e){if(e.__UNSAFE_SIGN_NONSEGWIT!==!1)throw new Error("Not BIP174 compliant, can not export")}function Sa(e,t,r){if(!t)return!1;let n;if(r?n=r.map(s=>{const i=Ia.fromPublicKey(s,{compressed:!0}).publicKey;return t.find(u=>u.pubkey.equals(i))}).filter(s=>!!s):n=t,n.length>e)throw new Error("Too many signatures");return n.length===e}function _a(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function br(e){return t=>{try{return e({output:t}),!0}catch{return!1}}}const Dg=br(Xt.p2ms),Bg=br(Xt.p2pk),$g=br(Xt.p2pkh),Dn=br(Xt.p2wpkh),Ta=br(Xt.p2wsh),Pa=br(Xt.p2sh);function Oa(e){return t=>!(!t.masterFingerprint.equals(e.fingerprint)||!e.derivePath(t.path).publicKey.equals(t.pubkey))}function Bn(e){if(typeof e!="number"||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function Gg(e,t,r){const n=t.__FEE_RATE||e.getFeeRate(),s=t.__EXTRACTED_TX.virtualSize(),i=n*s;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(i/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${s} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}function Dr(e,t){e.forEach(r=>{let n=!1,s=[];if((r.partialSig||[]).length===0){if(!r.finalScriptSig&&!r.finalScriptWitness)return;s=jg(r)}else s=r.partialSig;if(s.forEach(i=>{const{hashType:u}=Jt.signature.decode(i.signature),c=[];switch(u&Gt.Transaction.SIGHASH_ANYONECANPAY&&c.push("addInput"),u&31){case Gt.Transaction.SIGHASH_ALL:break;case Gt.Transaction.SIGHASH_SINGLE:case Gt.Transaction.SIGHASH_NONE:c.push("addOutput"),c.push("setInputSequence");break}c.indexOf(t)===-1&&(n=!0)}),n)throw new Error("Can not modify transaction, signatures exist.")})}function Kg(e){if(!e.sighashType||!e.partialSig)return;const{partialSig:t,sighashType:r}=e;t.forEach(n=>{const{hashType:s}=Jt.signature.decode(n.signature);if(r!==s)throw new Error("Signature sighash does not match input sighash type")})}function Ma(e,t,r){if(!_s(e,t))throw new Error(`Can not ${r} for this input with the key ${e.toString("hex")}`)}function Fg(e){if(!e.ins.every(t=>t.script&&t.script.length===0&&t.witness&&t.witness.length===0))throw new Error("Format Error: Transaction ScriptSigs are not empty")}function Wg(e,t){e.ins.forEach(r=>{Aa(t,r)})}function Aa(e,t){const r=Ln.reverseBuffer(m.from(t.hash)).toString("hex")+":"+t.index;if(e.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[r]=1}function Na(e,t){return(r,n,s,i)=>{const u=e({redeem:{output:s}}).output;if(!n.equals(u))throw new Error(`${t} for ${i} #${r} doesn't match the scriptPubKey in the prevout`)}}const ka=Na(Xt.p2sh,"Redeem script"),Ra=Na(Xt.p2wsh,"Witness script");function xa(e,t,r,n){if(!r.every(_a))throw new Error(`PSBT must be finalized to calculate ${t}`);if(e==="__FEE_RATE"&&n.__FEE_RATE)return n.__FEE_RATE;if(e==="__FEE"&&n.__FEE)return n.__FEE;let s,i=!0;if(n.__EXTRACTED_TX?(s=n.__EXTRACTED_TX,i=!1):s=n.__TX.clone(),Ba(r,s,n,i),e==="__FEE_RATE")return n.__FEE_RATE;if(e==="__FEE")return n.__FEE}function Vg(e,t,r,n,s,i){const u=Ka(r);if(!Lg(t,r,u))throw new Error(`Can not finalize input #${e}`);return qg(r,u,t.partialSig,n,s,i)}function qg(e,t,r,n,s,i){let u,c;const p=Xg(e,t,r),g=i?Xt.p2wsh({redeem:p}):null,y=s?Xt.p2sh({redeem:g||p}):null;return n?(g?c=Da(g.witness):c=Da(p.witness),y&&(u=y.input)):y?u=y.input:u=p.input,{finalScriptSig:u,finalScriptWitness:c}}function Ua(e,t,r,n,s){const i=we.checkForInput(e,t),{hash:u,sighashType:c,script:p}=Ca(t,i,n,!1,s);return Ma(r,p,"sign"),{hash:u,sighashType:c}}function Ca(e,t,r,n,s){const i=r.__TX,u=t.sighashType||Gt.Transaction.SIGHASH_ALL;if(s&&s.indexOf(u)<0){const b=Zg(u);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${b}`)}let c,p;if(t.nonWitnessUtxo){const b=$n(r,t,e),O=i.ins[e].hash,S=b.getHash();if(!O.equals(S))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);const T=i.ins[e].index;p=b.outs[T]}else if(t.witnessUtxo)p=t.witnessUtxo;else throw new Error("Need a Utxo input item for signing");const{meaningfulScript:g,type:y}=Gn(p.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(y)>=0)c=i.hashForWitnessV0(e,g,p.value,u);else if(Dn(g)){const b=Xt.p2pkh({hash:g.slice(2)}).output;c=i.hashForWitnessV0(e,b,p.value,u)}else{if(t.nonWitnessUtxo===void 0&&r.__UNSAFE_SIGN_NONSEGWIT===!1)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: ${g.toString("hex")}`);!n&&r.__UNSAFE_SIGN_NONSEGWIT!==!1&&console.warn(`Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as the old TransactionBuilder class when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.
*********************
PROCEED WITH CAUTION!
*********************`),c=i.hashForSignature(e,g,u)}return{script:g,sighashType:u,hash:c}}function Xg(e,t,r){let n;switch(t){case"multisig":const s=Yg(e,r);n=Xt.p2ms({output:e,signatures:s});break;case"pubkey":n=Xt.p2pk({output:e,signature:r[0].signature});break;case"pubkeyhash":n=Xt.p2pkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=Xt.p2wpkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break}return n}function jg(e){const t=e.finalScriptSig?Jt.decompile(e.finalScriptSig)||[]:[],r=e.finalScriptWitness?Jt.decompile(e.finalScriptWitness)||[]:[];return t.concat(r).filter(n=>m.isBuffer(n)&&Jt.isCanonicalScriptSignature(n)).map(n=>({signature:n}))}function zg(e,t,r){const n=r.__TX,s={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(s.isP2SH=!!t.redeemScript,s.isP2WSH=!!t.witnessScript,t.witnessScript)s.script=t.witnessScript;else if(t.redeemScript)s.script=t.redeemScript;else if(t.nonWitnessUtxo){const i=$n(r,t,e),u=n.ins[e].index;s.script=i.outs[u].script}else t.witnessUtxo&&(s.script=t.witnessUtxo.script);return(t.witnessScript||Dn(s.script))&&(s.isSegwit=!0),s}function Ha(e,t,r){const n=we.checkForInput(t,e);if(!n.bip32Derivation||n.bip32Derivation.length===0)throw new Error("Need bip32Derivation to sign with HD");const s=n.bip32Derivation.map(i=>{if(i.masterFingerprint.equals(r.fingerprint))return i}).filter(i=>!!i);if(s.length===0)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return s.map(i=>{const u=r.derivePath(i.path);if(!i.pubkey.equals(u.publicKey))throw new Error("pubkey did not match bip32Derivation");return u})}function Yg(e,t){return Xt.p2ms({output:e}).pubkeys.map(r=>(t.filter(n=>n.pubkey.equals(r))[0]||{}).signature).filter(r=>!!r)}function La(e){let t=0;function r(u){return t+=u,e.slice(t-u,t)}function n(){const u=Hn.decode(e,t);return t+=Hn.decode.bytes,u}function s(){return r(n())}function i(){const u=n(),c=[];for(let p=0;p<u;p++)c.push(s());return c}return i()}function Zg(e){let t=e&Gt.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(e&31){case Gt.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case Gt.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case Gt.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE";break}return t}function Da(e){let t=m.allocUnsafe(0);function r(u){t=m.concat([t,m.from(u)])}function n(u){const c=t.length,p=Hn.encodingLength(u);t=m.concat([t,m.allocUnsafe(p)]),Hn.encode(u,t,c)}function s(u){n(u.length),r(u)}function i(u){n(u.length),u.forEach(s)}return i(e),t}function Ss(e,t,r){e.__NON_WITNESS_UTXO_BUF_CACHE[r]=t.nonWitnessUtxo;const n=Gt.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const s=e,i=r;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){const u=s.__NON_WITNESS_UTXO_BUF_CACHE[i],c=s.__NON_WITNESS_UTXO_TX_CACHE[i];if(u!==void 0)return u;{const p=c.toBuffer();return s.__NON_WITNESS_UTXO_BUF_CACHE[i]=p,p}},set(u){s.__NON_WITNESS_UTXO_BUF_CACHE[i]=u}})}function Ba(e,t,r,n){let s=0;e.forEach((p,g)=>{if(n&&p.finalScriptSig&&(t.ins[g].script=p.finalScriptSig),n&&p.finalScriptWitness&&(t.ins[g].witness=La(p.finalScriptWitness)),p.witnessUtxo)s+=p.witnessUtxo.value;else if(p.nonWitnessUtxo){const y=$n(r,p,g),b=t.ins[g].index,O=y.outs[b];s+=O.value}});const i=t.outs.reduce((p,g)=>p+g.value,0),u=s-i;if(u<0)throw new Error("Outputs are spending more than Inputs");const c=t.virtualSize();r.__FEE=u,r.__EXTRACTED_TX=t,r.__FEE_RATE=Math.floor(u/c)}function $n(e,t,r){const n=e.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||Ss(e,t,r),n[r]}function $a(e,t,r){if(t.witnessUtxo!==void 0)return t.witnessUtxo.script;if(t.nonWitnessUtxo!==void 0)return $n(r,t,e).outs[r.__TX.ins[e].index].script;throw new Error("Can't find pubkey in input without Utxo data")}function Qg(e,t,r,n){const s=$a(r,t,n),{meaningfulScript:i}=Gn(s,r,"input",t.redeemScript,t.witnessScript);return _s(e,i)}function Jg(e,t,r,n){const s=n.__TX.outs[r].script,{meaningfulScript:i}=Gn(s,r,"output",t.redeemScript,t.witnessScript);return _s(e,i)}function tw(e){if(!e)return;const t=Jt.decompile(e);if(!t)return;const r=t[t.length-1];if(!(!m.isBuffer(r)||Ga(r)||rw(r)||!Jt.decompile(r)))return r}function ew(e){if(!e)return;const t=La(e),r=t[t.length-1];if(!(Ga(r)||!Jt.decompile(r)))return r}function Ga(e){return e.length===33&&Jt.isCanonicalPubKey(e)}function rw(e){return Jt.isCanonicalScriptSignature(e)}function Gn(e,t,r,n,s){const i=Pa(e),u=i&&n&&Ta(n),c=Ta(e);if(i&&n===void 0)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((c||u)&&s===void 0)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let p;return u?(p=s,ka(t,e,n,r),Ra(t,n,s,r),Kn(p)):c?(p=s,Ra(t,e,s,r),Kn(p)):i?(p=n,ka(t,e,n,r)):p=e,{meaningfulScript:p,type:u?"p2sh-p2wsh":i?"p2sh":c?"p2wsh":"raw"}}function Kn(e){if(Dn(e)||Pa(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function _s(e,t){const r=xg.hash160(e),n=Jt.decompile(t);if(n===null)throw new Error("Unknown script error");return n.some(s=>typeof s=="number"?!1:s.equals(e)||s.equals(r))}function Ka(e){return Dn(e)?"witnesspubkeyhash":$g(e)?"pubkeyhash":Dg(e)?"multisig":Bg(e)?"pubkey":"nonstandard"}function Br(e){return[...Array(e).keys()]}var Ts={},Sr={},_r={},Ps={};Object.defineProperty(Ps,"__esModule",{value:!0});const Os=W,Fa=W;function nw(e){return e===Fa.OPS.OP_0||Os.isCanonicalScriptSignature(e)}function Wa(e,t){const r=Os.decompile(e);return r.length<2||r[0]!==Fa.OPS.OP_0?!1:t?r.slice(1).every(nw):r.slice(1).every(Os.isCanonicalScriptSignature)}Ps.check=Wa,Wa.toJSON=()=>"multisig input";var Ms={};Object.defineProperty(Ms,"__esModule",{value:!0});const Va=W,qa=W,Xa=X,ja=qa.OPS.OP_RESERVED;function za(e,t){const r=Va.decompile(e);if(r.length<4||r[r.length-1]!==qa.OPS.OP_CHECKMULTISIG||!Xa.Number(r[0])||!Xa.Number(r[r.length-2]))return!1;const n=r[0]-ja,s=r[r.length-2]-ja;return n<=0||s>16||n>s||s!==r.length-3?!1:t?!0:r.slice(1,-2).every(Va.isCanonicalPubKey)}Ms.check=za,za.toJSON=()=>"multi-sig output",Object.defineProperty(_r,"__esModule",{value:!0});const iw=Ps;_r.input=iw;const sw=Ms;_r.output=sw;var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0});const Ya=W,ow=Ya.OPS;function As(e){const t=Ya.compile(e);return t.length>1&&t[0]===ow.OP_RETURN}Fn.check=As,As.toJSON=()=>"null data output";const uw={check:As};Fn.output=uw;var Tr={},Ns={};Object.defineProperty(Ns,"__esModule",{value:!0});const Za=W;function Qa(e){const t=Za.decompile(e);return t.length===1&&Za.isCanonicalScriptSignature(t[0])}Ns.check=Qa,Qa.toJSON=()=>"pubKey input";var ks={};Object.defineProperty(ks,"__esModule",{value:!0});const Ja=W,aw=W;function th(e){const t=Ja.decompile(e);return t.length===2&&Ja.isCanonicalPubKey(t[0])&&t[1]===aw.OPS.OP_CHECKSIG}ks.check=th,th.toJSON=()=>"pubKey output",Object.defineProperty(Tr,"__esModule",{value:!0});const hw=Ns;Tr.input=hw;const cw=ks;Tr.output=cw;var Pr={},Rs={};Object.defineProperty(Rs,"__esModule",{value:!0});const xs=W;function eh(e){const t=xs.decompile(e);return t.length===2&&xs.isCanonicalScriptSignature(t[0])&&xs.isCanonicalPubKey(t[1])}Rs.check=eh,eh.toJSON=()=>"pubKeyHash input";var Us={};Object.defineProperty(Us,"__esModule",{value:!0});const lw=W,Wn=W;function rh(e){const t=lw.compile(e);return t.length===25&&t[0]===Wn.OPS.OP_DUP&&t[1]===Wn.OPS.OP_HASH160&&t[2]===20&&t[23]===Wn.OPS.OP_EQUALVERIFY&&t[24]===Wn.OPS.OP_CHECKSIG}Us.check=rh,rh.toJSON=()=>"pubKeyHash output",Object.defineProperty(Pr,"__esModule",{value:!0});const pw=Rs;Pr.input=pw;const fw=Us;Pr.output=fw;var Vn={},Cs={},qn={};Object.defineProperty(qn,"__esModule",{value:!0});const dw=W,mw=W;function nh(e){const t=dw.compile(e);return t.length===22&&t[0]===mw.OPS.OP_0&&t[1]===20}qn.check=nh,nh.toJSON=()=>"Witness pubKeyHash output";var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});const gw=W,ww=W;function ih(e){const t=gw.compile(e);return t.length===34&&t[0]===ww.OPS.OP_0&&t[1]===32}Xn.check=ih,ih.toJSON=()=>"Witness scriptHash output",Object.defineProperty(Cs,"__esModule",{value:!0});const $r=W,sh=_r,oh=Tr,uh=Pr,vw=qn,yw=Xn;function ah(e,t){const r=$r.decompile(e);if(r.length<1)return!1;const n=r[r.length-1];if(!m.isBuffer(n))return!1;const s=$r.decompile($r.compile(r.slice(0,-1))),i=$r.decompile(n);return!i||!$r.isPushOnly(s)?!1:r.length===1?yw.check(i)||vw.check(i):!!(uh.input.check(s)&&uh.output.check(i)||sh.input.check(s,t)&&sh.output.check(i)||oh.input.check(s)&&oh.output.check(i))}Cs.check=ah,ah.toJSON=()=>"scriptHash input";var Hs={};Object.defineProperty(Hs,"__esModule",{value:!0});const Ew=W,hh=W;function ch(e){const t=Ew.compile(e);return t.length===23&&t[0]===hh.OPS.OP_HASH160&&t[1]===20&&t[22]===hh.OPS.OP_EQUAL}Hs.check=ch,ch.toJSON=()=>"scriptHash output",Object.defineProperty(Vn,"__esModule",{value:!0});const Iw=Cs;Vn.input=Iw;const bw=Hs;Vn.output=bw;var Ls={},Gr={};Object.defineProperty(Gr,"__esModule",{value:!0});const Ds=W,lh=W,Sw=X,ph=$t,fh=m.from("aa21a9ed","hex");function Bs(e){const t=Ds.compile(e);return t.length>37&&t[0]===lh.OPS.OP_RETURN&&t[1]===36&&t.slice(2,6).equals(fh)}Gr.check=Bs,Bs.toJSON=()=>"Witness commitment output";function _w(e){ph(Sw.Hash256bit,e);const t=m.allocUnsafe(36);return fh.copy(t,0),e.copy(t,4),Ds.compile([lh.OPS.OP_RETURN,t])}Gr.encode=_w;function Tw(e){return ph(Bs,e),Ds.decompile(e)[1].slice(4,36)}Gr.decode=Tw,Object.defineProperty(Ls,"__esModule",{value:!0});const Pw=Gr;Ls.output=Pw;var jn={},$s={};Object.defineProperty($s,"__esModule",{value:!0});const Gs=W;function Ow(e){return Gs.isCanonicalPubKey(e)&&e.length===33}function dh(e){const t=Gs.decompile(e);return t.length===2&&Gs.isCanonicalScriptSignature(t[0])&&Ow(t[1])}$s.check=dh,dh.toJSON=()=>"witnessPubKeyHash input",Object.defineProperty(jn,"__esModule",{value:!0});const Mw=$s;jn.input=Mw;const Aw=qn;jn.output=Aw;var zn={},Ks={};Object.defineProperty(Ks,"__esModule",{value:!0});const mh=W,gh=$t,wh=_r,vh=Tr,yh=Pr;function Eh(e,t){if(gh(gh.Array,e),e.length<1)return!1;const r=e[e.length-1];if(!m.isBuffer(r))return!1;const n=mh.decompile(r);if(!n||n.length===0)return!1;const s=mh.compile(e.slice(0,-1));return!!(yh.input.check(s)&&yh.output.check(n)||wh.input.check(s,t)&&wh.output.check(n)||vh.input.check(s)&&vh.output.check(n))}Ks.check=Eh,Eh.toJSON=()=>"witnessScriptHash input",Object.defineProperty(zn,"__esModule",{value:!0});const Nw=Ks;zn.input=Nw;const kw=Xn;zn.output=kw,Object.defineProperty(Sr,"__esModule",{value:!0});const Fs=W,Ih=_r,Rw=Fn,bh=Tr,Sh=Pr,_h=Vn,xw=Ls,Th=jn,Ph=zn,Ft={P2MS:"multisig",NONSTANDARD:"nonstandard",NULLDATA:"nulldata",P2PK:"pubkey",P2PKH:"pubkeyhash",P2SH:"scripthash",P2WPKH:"witnesspubkeyhash",P2WSH:"witnessscripthash",WITNESS_COMMITMENT:"witnesscommitment"};Sr.types=Ft;function Uw(e){if(Th.output.check(e))return Ft.P2WPKH;if(Ph.output.check(e))return Ft.P2WSH;if(Sh.output.check(e))return Ft.P2PKH;if(_h.output.check(e))return Ft.P2SH;const t=Fs.decompile(e);if(!t)throw new TypeError("Invalid script");return Ih.output.check(t)?Ft.P2MS:bh.output.check(t)?Ft.P2PK:xw.output.check(t)?Ft.WITNESS_COMMITMENT:Rw.output.check(t)?Ft.NULLDATA:Ft.NONSTANDARD}Sr.output=Uw;function Cw(e,t){const r=Fs.decompile(e);if(!r)throw new TypeError("Invalid script");return Sh.input.check(r)?Ft.P2PKH:_h.input.check(r,t)?Ft.P2SH:Ih.input.check(r,t)?Ft.P2MS:bh.input.check(r)?Ft.P2PK:Ft.NONSTANDARD}Sr.input=Cw;function Hw(e,t){const r=Fs.decompile(e);if(!r)throw new TypeError("Invalid script");return Th.input.check(r)?Ft.P2WPKH:Ph.input.check(r,t)?Ft.P2WSH:Ft.NONSTANDARD}Sr.witness=Hw,Object.defineProperty(Ts,"__esModule",{value:!0});const Lw=de,Dw=le,Qe=Sr,Oh=Qt,Bw=Be,$w=zt,tt=se,Je=W,Gw=W,Oe=Er,Me=X,Y=$t,F=Qe.types,Kw=new Set(["p2pkh","p2pk","p2wpkh","p2ms","p2sh-p2pkh","p2sh-p2pk","p2sh-p2wpkh","p2sh-p2ms","p2wsh-p2pkh","p2wsh-p2pk","p2wsh-p2ms","p2sh-p2wsh-p2pkh","p2sh-p2wsh-p2pk","p2sh-p2wsh-p2ms"]);function et(e,t,r){try{Y(e,t)}catch{throw new Error(r)}}function Fw(e){return typeof e=="string"||e instanceof String}function Ww(e){return e instanceof Oe.Transaction}class go{constructor(t=$w.bitcoin,r=2500){this.network=t,this.maximumFeeRate=r,this.__PREV_TX_SET={},this.__INPUTS=[],this.__TX=new Oe.Transaction,this.__TX.version=2,this.__USE_LOW_R=!1,console.warn("Deprecation Warning: TransactionBuilder will be removed in the future. (v6.x.x or later) Please use the Psbt class instead. Examples of usage are available in the transactions-psbt.js integration test file on our Github. A high level explanation is available in the psbt.ts and psbt.js files as well.")}static fromTransaction(t,r){const n=new go(r);return n.setVersion(t.version),n.setLockTime(t.locktime),t.outs.forEach(s=>{n.addOutput(s.script,s.value)}),t.ins.forEach(s=>{n.__addInputUnsafe(s.hash,s.index,{sequence:s.sequence,script:s.script,witness:s.witness})}),n.__INPUTS.forEach((s,i)=>{Vw(s,t,i)}),n}setLowR(t){return Y(Y.maybe(Y.Boolean),t),t===void 0&&(t=!0),this.__USE_LOW_R=t,t}setLockTime(t){if(Y(Me.UInt32,t),this.__INPUTS.some(r=>r.signatures?r.signatures.some(n=>n!==void 0):!1))throw new Error("No, this would invalidate signatures");this.__TX.locktime=t}setVersion(t){Y(Me.UInt32,t),this.__TX.version=t}addInput(t,r,n,s){if(!this.__canModifyInputs())throw new Error("No, this would invalidate signatures");let i;if(Fw(t))t=Dw.reverseBuffer(m.from(t,"hex"));else if(Ww(t)){const u=t.outs[r];s=u.script,i=u.value,t=t.getHash(!1)}return this.__addInputUnsafe(t,r,{sequence:n,prevOutScript:s,value:i})}addOutput(t,r){if(!this.__canModifyOutputs())throw new Error("No, this would invalidate signatures");return typeof t=="string"&&(t=Lw.toOutputScript(t,this.network)),this.__TX.addOutput(t,r)}build(){return this.__build(!1)}buildIncomplete(){return this.__build(!0)}sign(t,r,n,s,i,u){jw(zw(this.network,this.__INPUTS,this.__needsOutputs.bind(this),this.__TX,t,r,n,s,i,u,this.__USE_LOW_R))}__addInputUnsafe(t,r,n){if(Oe.Transaction.isCoinbaseHash(t))throw new Error("coinbase inputs not supported");const s=t.toString("hex")+":"+r;if(this.__PREV_TX_SET[s]!==void 0)throw new Error("Duplicate TxOut: "+s);let i={};if(n.script!==void 0&&(i=Yn(n.script,n.witness||[])),n.value!==void 0&&(i.value=n.value),!i.prevOutScript&&n.prevOutScript){let c;if(!i.pubkeys&&!i.signatures){const p=Kr(n.prevOutScript);p.pubkeys&&(i.pubkeys=p.pubkeys,i.signatures=p.signatures),c=p.type}i.prevOutScript=n.prevOutScript,i.prevOutType=c||Qe.output(n.prevOutScript)}const u=this.__TX.addInput(t,r,n.sequence,n.scriptSig);return this.__INPUTS[u]=i,this.__PREV_TX_SET[s]=!0,u}__build(t){if(!t){if(!this.__TX.ins.length)throw new Error("Transaction has no inputs");if(!this.__TX.outs.length)throw new Error("Transaction has no outputs")}const r=this.__TX.clone();if(this.__INPUTS.forEach((n,s)=>{if(!n.prevOutType&&!t)throw new Error("Transaction is not complete");const i=Ws(n.prevOutType,n,t);if(!i){if(!t&&n.prevOutType===F.NONSTANDARD)throw new Error("Unknown input type");if(!t)throw new Error("Not enough information");return}r.setInputScript(s,i.input),r.setWitness(s,i.witness)}),!t&&this.__overMaximumFees(r.virtualSize()))throw new Error("Transaction has absurd fees");return r}__canModifyInputs(){return this.__INPUTS.every(t=>t.signatures?t.signatures.every(r=>r?(qs(r)&Oe.Transaction.SIGHASH_ANYONECANPAY)!==0:!0):!0)}__needsOutputs(t){return t===Oe.Transaction.SIGHASH_ALL?this.__TX.outs.length===0:this.__TX.outs.length===0&&this.__INPUTS.some(r=>r.signatures?r.signatures.some(n=>!(!n||qs(n)&Oe.Transaction.SIGHASH_NONE)):!1)}__canModifyOutputs(){const t=this.__TX.ins.length,r=this.__TX.outs.length;return this.__INPUTS.every(n=>n.signatures===void 0?!0:n.signatures.every(s=>{if(!s)return!0;const i=qs(s)&31;return i===Oe.Transaction.SIGHASH_NONE?!0:i===Oe.Transaction.SIGHASH_SINGLE?t<=r:!1}))}__overMaximumFees(t){const r=this.__INPUTS.reduce((s,i)=>s+(i.value>>>0),0),n=this.__TX.outs.reduce((s,i)=>s+i.value,0);return(r-n)/t>this.maximumFeeRate}}Ts.TransactionBuilder=go;function Yn(e,t,r,n){if(e.length===0&&t.length===0)return{};if(!r){let s=Qe.input(e,!0),i=Qe.witness(t,!0);s===F.NONSTANDARD&&(s=void 0),i===F.NONSTANDARD&&(i=void 0),r=s||i}switch(r){case F.P2WPKH:{const{output:s,pubkey:i,signature:u}=tt.p2wpkh({witness:t});return{prevOutScript:s,prevOutType:F.P2WPKH,pubkeys:[i],signatures:[u]}}case F.P2PKH:{const{output:s,pubkey:i,signature:u}=tt.p2pkh({input:e});return{prevOutScript:s,prevOutType:F.P2PKH,pubkeys:[i],signatures:[u]}}case F.P2PK:{const{signature:s}=tt.p2pk({input:e});return{prevOutType:F.P2PK,pubkeys:[void 0],signatures:[s]}}case F.P2MS:{const{m:s,pubkeys:i,signatures:u}=tt.p2ms({input:e,output:n},{allowIncomplete:!0});return{prevOutType:F.P2MS,pubkeys:i,signatures:u,maxSignatures:s}}}if(r===F.P2SH){const{output:s,redeem:i}=tt.p2sh({input:e,witness:t}),u=Qe.output(i.output),c=Yn(i.input,i.witness,u,i.output);return c.prevOutType?{prevOutScript:s,prevOutType:F.P2SH,redeemScript:i.output,redeemScriptType:c.prevOutType,witnessScript:c.witnessScript,witnessScriptType:c.witnessScriptType,pubkeys:c.pubkeys,signatures:c.signatures}:{}}if(r===F.P2WSH){const{output:s,redeem:i}=tt.p2wsh({input:e,witness:t}),u=Qe.output(i.output);let c;return u===F.P2WPKH?c=Yn(i.input,i.witness,u):c=Yn(Je.compile(i.witness),[],u,i.output),c.prevOutType?{prevOutScript:s,prevOutType:F.P2WSH,witnessScript:i.output,witnessScriptType:c.prevOutType,pubkeys:c.pubkeys,signatures:c.signatures}:{}}return{prevOutType:F.NONSTANDARD,prevOutScript:e}}function Vw(e,t,r){if(e.redeemScriptType!==F.P2MS||!e.redeemScript||e.pubkeys.length===e.signatures.length)return;const n=e.signatures.concat();e.signatures=e.pubkeys.map(s=>{const i=Bw.fromPublicKey(s);let u;return n.some((c,p)=>{if(!c)return!1;const g=Je.signature.decode(c),y=t.hashForSignature(r,e.redeemScript,g.hashType);return i.verify(y,g.signature)?(n[p]=void 0,u=c,!0):!1}),u})}function Kr(e,t){Y(Me.Buffer,e);const r=Qe.output(e);switch(r){case F.P2PKH:{if(!t)return{type:r};const n=tt.p2pkh({output:e}).hash,s=Oh.hash160(t);return n.equals(s)?{type:r,pubkeys:[t],signatures:[void 0]}:{type:r}}case F.P2WPKH:{if(!t)return{type:r};const n=tt.p2wpkh({output:e}).hash,s=Oh.hash160(t);return n.equals(s)?{type:r,pubkeys:[t],signatures:[void 0]}:{type:r}}case F.P2PK:{const n=tt.p2pk({output:e});return{type:r,pubkeys:[n.pubkey],signatures:[void 0]}}case F.P2MS:{const n=tt.p2ms({output:e});return{type:r,pubkeys:n.pubkeys,signatures:n.pubkeys.map(()=>{}),maxSignatures:n.m}}}return{type:r}}function qw(e,t,r,n){if(r&&n){const i=tt.p2wsh({redeem:{output:n}}),u=tt.p2wsh({output:r}),c=tt.p2sh({redeem:{output:r}}),p=tt.p2sh({redeem:i});if(!i.hash.equals(u.hash))throw new Error("Witness script inconsistent with prevOutScript");if(!c.hash.equals(p.hash))throw new Error("Redeem script inconsistent with prevOutScript");const g=Kr(i.redeem.output,t);if(!g.pubkeys)throw new Error(g.type+" not supported as witnessScript ("+Je.toASM(n)+")");e.signatures&&e.signatures.some(b=>b!==void 0)&&(g.signatures=e.signatures);const y=n;if(g.type===F.P2WPKH)throw new Error("P2SH(P2WSH(P2WPKH)) is a consensus failure");return{redeemScript:r,redeemScriptType:F.P2WSH,witnessScript:n,witnessScriptType:g.type,prevOutType:F.P2SH,prevOutScript:c.output,hasWitness:!0,signScript:y,signType:g.type,pubkeys:g.pubkeys,signatures:g.signatures,maxSignatures:g.maxSignatures}}if(r){const i=tt.p2sh({redeem:{output:r}});if(e.prevOutScript){let p;try{p=tt.p2sh({output:e.prevOutScript})}catch{throw new Error("PrevOutScript must be P2SH")}if(!i.hash.equals(p.hash))throw new Error("Redeem script inconsistent with prevOutScript")}const u=Kr(i.redeem.output,t);if(!u.pubkeys)throw new Error(u.type+" not supported as redeemScript ("+Je.toASM(r)+")");e.signatures&&e.signatures.some(p=>p!==void 0)&&(u.signatures=e.signatures);let c=r;return u.type===F.P2WPKH&&(c=tt.p2pkh({pubkey:u.pubkeys[0]}).output),{redeemScript:r,redeemScriptType:u.type,prevOutType:F.P2SH,prevOutScript:i.output,hasWitness:u.type===F.P2WPKH,signScript:c,signType:u.type,pubkeys:u.pubkeys,signatures:u.signatures,maxSignatures:u.maxSignatures}}if(n){const i=tt.p2wsh({redeem:{output:n}});if(e.prevOutScript){const p=tt.p2wsh({output:e.prevOutScript});if(!i.hash.equals(p.hash))throw new Error("Witness script inconsistent with prevOutScript")}const u=Kr(i.redeem.output,t);if(!u.pubkeys)throw new Error(u.type+" not supported as witnessScript ("+Je.toASM(n)+")");e.signatures&&e.signatures.some(p=>p!==void 0)&&(u.signatures=e.signatures);const c=n;if(u.type===F.P2WPKH)throw new Error("P2WSH(P2WPKH) is a consensus failure");return{witnessScript:n,witnessScriptType:u.type,prevOutType:F.P2WSH,prevOutScript:i.output,hasWitness:!0,signScript:c,signType:u.type,pubkeys:u.pubkeys,signatures:u.signatures,maxSignatures:u.maxSignatures}}if(e.prevOutType&&e.prevOutScript){if(e.prevOutType===F.P2SH)throw new Error("PrevOutScript is "+e.prevOutType+", requires redeemScript");if(e.prevOutType===F.P2WSH)throw new Error("PrevOutScript is "+e.prevOutType+", requires witnessScript");if(!e.prevOutScript)throw new Error("PrevOutScript is missing");const i=Kr(e.prevOutScript,t);if(!i.pubkeys)throw new Error(i.type+" not supported ("+Je.toASM(e.prevOutScript)+")");e.signatures&&e.signatures.some(c=>c!==void 0)&&(i.signatures=e.signatures);let u=e.prevOutScript;return i.type===F.P2WPKH&&(u=tt.p2pkh({pubkey:i.pubkeys[0]}).output),{prevOutType:i.type,prevOutScript:e.prevOutScript,hasWitness:i.type===F.P2WPKH,signScript:u,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}const s=tt.p2pkh({pubkey:t}).output;return{prevOutType:F.P2PKH,prevOutScript:s,hasWitness:!1,signScript:s,signType:F.P2PKH,pubkeys:[t],signatures:[void 0]}}function Ws(e,t,r){const n=t.pubkeys||[];let s=t.signatures||[];switch(e){case F.P2PKH:{if(n.length===0||s.length===0)break;return tt.p2pkh({pubkey:n[0],signature:s[0]})}case F.P2WPKH:{if(n.length===0||s.length===0)break;return tt.p2wpkh({pubkey:n[0],signature:s[0]})}case F.P2PK:{if(n.length===0||s.length===0)break;return tt.p2pk({signature:s[0]})}case F.P2MS:{const i=t.maxSignatures;r?s=s.map(c=>c||Gw.OPS.OP_0):s=s.filter(c=>c);const u=!r||i===s.length;return tt.p2ms({m:i,pubkeys:n,signatures:s},{allowIncomplete:r,validate:u})}case F.P2SH:{const i=Ws(t.redeemScriptType,t,r);return i?tt.p2sh({redeem:{output:i.output||t.redeemScript,input:i.input,witness:i.witness}}):void 0}case F.P2WSH:{const i=Ws(t.witnessScriptType,t,r);return i?tt.p2wsh({redeem:{output:t.witnessScript,input:i.input,witness:i.witness}}):void 0}}}function Vs(e){return e.signScript!==void 0&&e.signType!==void 0&&e.pubkeys!==void 0&&e.signatures!==void 0&&e.signatures.length===e.pubkeys.length&&e.pubkeys.length>0&&(e.hasWitness===!1||e.value!==void 0)}function qs(e){return e.readUInt8(e.length-1)}function Xw(e,t){if(!Kw.has(t.prevOutScriptType))throw new TypeError(`Unknown prevOutScriptType "${t.prevOutScriptType}"`);et(Y.Number,t.vin,"sign must include vin parameter as Number (input index)"),et(Me.Signer,t.keyPair,"sign must include keyPair parameter as Signer interface"),et(Y.maybe(Y.Number),t.hashType,"sign hashType parameter must be a number");const r=(e[t.vin]||[]).prevOutType,n=t.prevOutScriptType;switch(n){case"p2pkh":if(r&&r!=="pubkeyhash")throw new TypeError(`input #${t.vin} is not of type p2pkh: ${r}`);et(Y.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),et(Y.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),et(Y.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2pk":if(r&&r!=="pubkey")throw new TypeError(`input #${t.vin} is not of type p2pk: ${r}`);et(Y.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),et(Y.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),et(Y.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2wpkh":if(r&&r!=="witnesspubkeyhash")throw new TypeError(`input #${t.vin} is not of type p2wpkh: ${r}`);et(Y.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),et(Y.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),et(Me.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2ms":if(r&&r!=="multisig")throw new TypeError(`input #${t.vin} is not of type p2ms: ${r}`);et(Y.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),et(Y.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),et(Y.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2sh-p2wpkh":if(r&&r!=="scripthash")throw new TypeError(`input #${t.vin} is not of type p2sh-p2wpkh: ${r}`);et(Y.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),et(Y.Buffer,t.redeemScript,`${n} requires redeemScript`),et(Me.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2ms":case"p2sh-p2pk":case"p2sh-p2pkh":if(r&&r!=="scripthash")throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);et(Y.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),et(Y.Buffer,t.redeemScript,`${n} requires redeemScript`),et(Y.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2wsh-p2ms":case"p2wsh-p2pk":case"p2wsh-p2pkh":if(r&&r!=="witnessscripthash")throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);et(Y.Buffer,t.witnessScript,`${n} requires witnessScript`),et(Y.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),et(Me.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2wsh-p2ms":case"p2sh-p2wsh-p2pk":case"p2sh-p2wsh-p2pkh":if(r&&r!=="scripthash")throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);et(Y.Buffer,t.witnessScript,`${n} requires witnessScript`),et(Y.Buffer,t.redeemScript,`${n} requires witnessScript`),et(Me.Satoshi,t.witnessValue,`${n} requires witnessScript`);break}}function jw({input:e,ourPubKey:t,keyPair:r,signatureHash:n,hashType:s,useLowR:i}){let u=!1;for(const[c,p]of e.pubkeys.entries()){if(!t.equals(p))continue;if(e.signatures[c])throw new Error("Signature already exists");if(t.length!==33&&e.hasWitness)throw new Error("BIP143 rejects uncompressed public keys in P2WPKH or P2WSH");const g=r.sign(n,i);e.signatures[c]=Je.signature.encode(g,s),u=!0}if(!u)throw new Error("Key pair cannot sign for this input")}function zw(e,t,r,n,s,i,u,c,p,g,y){let b;if(typeof s=="number")console.warn("DEPRECATED: TransactionBuilder sign method arguments will change in v6, please use the TxbSignArg interface"),b=s;else if(typeof s=="object")Xw(t,s),{vin:b,keyPair:i,redeemScript:u,hashType:c,witnessValue:p,witnessScript:g}=s;else throw new TypeError("TransactionBuilder sign first arg must be TxbSignArg or number");if(i===void 0)throw new Error("sign requires keypair");if(i.network&&i.network!==e)throw new TypeError("Inconsistent network");if(!t[b])throw new Error("No input at index: "+b);if(c=c||Oe.Transaction.SIGHASH_ALL,r(c))throw new Error("Transaction needs outputs");const O=t[b];if(O.redeemScript!==void 0&&u&&!O.redeemScript.equals(u))throw new Error("Inconsistent redeemScript");const S=i.publicKey||i.getPublicKey&&i.getPublicKey();if(!Vs(O)){if(p!==void 0){if(O.value!==void 0&&O.value!==p)throw new Error("Input did not match witnessValue");Y(Me.Satoshi,p),O.value=p}if(!Vs(O)){const H=qw(O,S,u,g);Object.assign(O,H)}if(!Vs(O))throw Error(O.prevOutType+" not supported")}let T;return O.hasWitness?T=n.hashForWitnessV0(b,O.signScript,O.value,c):T=n.hashForSignature(b,O.signScript,c),{input:O,ourPubKey:S,keyPair:i,signatureHash:T,hashType:c,useLowR:!!y}}Object.defineProperty(ee,"__esModule",{value:!0});const Yw=lr;ee.bip32=Yw;const Zw=de;ee.address=Zw;const Qw=Qt;var tr=ee.crypto=Qw;const Jw=Be;ee.ECPair=Jw;const tv=zt;ee.networks=tv;const ev=se;ee.payments=ev;const rv=W;ee.script=rv;var nv=ms;ee.Block=nv.Block;var iv=Is;ee.Psbt=iv.Psbt;var sv=W;ee.opcodes=sv.OPS;var ov=Er;ee.Transaction=ov.Transaction;var uv=Ts;ee.TransactionBuilder=uv.TransactionBuilder;function Xs(e){const t=m.alloc(1+e.length*4);return t[0]=e.length,e.forEach((r,n)=>{t.writeUInt32BE(r,1+4*n)}),t}function js(e){const t=e?Ae(e):[];return Xs(t)}function zs(e){return Oi.fromPathArray(e).toString()}function Ae(e){return Oi.fromString(e).toPathArray()}function Mh(e){const t=zu.decode(e);return t.slice(t.length-33)}function Ah(e){const t=zu.decode(e);return{chaincode:t.slice(13,45),pubkey:t.slice(t.length-33),version:t.readUInt32BE(0)}}function av(e){for(let t=e.length-1;t>=0;t--)if(e[t]>=2147483648)return e.slice(0,t+1);return[]}function Nh(e){if(e>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");const t=m.alloc(8,0);for(let r=0;r<t.length;r++){const n=e&255;t[r]=n,e=(e-n)/256}return t}function kh(e){let t=0;if(e.length!=8)throw new Error("Expected Bufffer of lenght 8");if(e[7]!=0)throw new Error("Can't encode numbers > MAX_SAFE_INT");if(e[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(let r=e.length-1;r>=0;r--)t=t*256+e[r];return t}class jt{constructor(){this.bufs=[]}write(t,r){const n=m.alloc(t);r(n),this.bufs.push(n)}writeUInt8(t){this.write(1,r=>r.writeUInt8(t,0))}writeInt32(t){this.write(4,r=>r.writeInt32LE(t,0))}writeUInt32(t){this.write(4,r=>r.writeUInt32LE(t,0))}writeUInt64(t){const r=Nh(t);this.writeSlice(r)}writeVarInt(t){this.bufs.push(Pi.encode(t))}writeSlice(t){this.bufs.push(m.from(t))}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}buffer(){return m.concat(this.bufs)}}class er{constructor(t,r=0){this.buffer=t,this.offset=r}available(){return this.buffer.length-this.offset}readUInt8(){const t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){const t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){const t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){const t=this.readSlice(8);return kh(t)}readVarInt(){const t=Pi.decode(this.buffer,this.offset);return this.offset+=Pi.decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");const r=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const t=this.readVarInt(),r=[];for(let n=0;n<t;n++)r.push(this.readVarSlice());return r}}const Ke=50,hv=1,Rh=0,Zn=4294967295,Ys=1,xh=118,Zs=169,Qn=20,cv=135,Uh=136,Ch=172;var lv=ac();const Jn=Xr(lv);function Or(e){return new Lo().update(Jn("sha256").update(e).digest()).digest()}class pv{constructor(t,r){this.psbt=t,this.masterFp=r}}class ti extends pv{spendingCondition(t){if(t.length!=1)throw new Error("Expected single key, got "+t.length);return this.singleKeyCondition(t[0])}setInput(t,r,n,s,i){if(s.length!=1)throw new Error("Expected single key, got "+s.length);if(i.length!=1)throw new Error("Expected single path, got "+i.length);this.setSingleKeyInput(t,r,n,s[0],i[0])}setOwnOutput(t,r,n,s){if(n.length!=1)throw new Error("Expected single key, got "+n.length);if(s.length!=1)throw new Error("Expected single path, got "+s.length);this.setSingleKeyOutput(t,r,n[0],s[0])}}class fv extends ti{singleKeyCondition(t){const r=new jt,n=Or(t);return r.writeSlice(m.from([xh,Zs,Qn])),r.writeSlice(n),r.writeSlice(m.from([Uh,Ch])),{scriptPubKey:r.buffer()}}setSingleKeyInput(t,r,n,s,i){if(!r)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,r),this.psbt.setInputBip32Derivation(t,s,this.masterFp,i)}setSingleKeyOutput(t,r,n,s){this.psbt.setOutputBip32Derivation(t,n,this.masterFp,s)}getDescriptorTemplate(){return"pkh(@0)"}}class dv extends ti{singleKeyCondition(t){const r=t.slice(1),n=new jt,s=this.getTaprootOutputKey(r);return n.writeSlice(m.from([81,32])),n.writeSlice(s),{scriptPubKey:n.buffer()}}setSingleKeyInput(t,r,n,s,i){const u=s.slice(1);this.psbt.setInputTapBip32Derivation(t,u,[],this.masterFp,i),this.psbt.setInputWitnessUtxo(t,n.amount,n.cond.scriptPubKey)}setSingleKeyOutput(t,r,n,s){const i=n.slice(1);this.psbt.setOutputTapBip32Derivation(t,i,[],this.masterFp,s)}getDescriptorTemplate(){return"tr(@0)"}hashTapTweak(t){const r=tr.sha256(m.from("TapTweak","utf-8"));return tr.sha256(m.concat([r,r,t]))}getTaprootOutputKey(t){if(t.length!=32)throw new Error("Expected 32 byte pubkey. Got "+t.length);const r=m.concat([m.from([2]),t]),n=this.hashTapTweak(t);return m.from(pe.pointAddScalar(r,n)).slice(1)}}class mv extends ti{singleKeyCondition(t){const r=new jt,n=this.createRedeemScript(t),s=Or(n);return r.writeSlice(m.from([Zs,Qn])),r.writeSlice(s),r.writeUInt8(cv),{scriptPubKey:r.buffer(),redeemScript:n}}setSingleKeyInput(t,r,n,s,i){if(!r)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,r),this.psbt.setInputBip32Derivation(t,s,this.masterFp,i);const u=n.cond.redeemScript,c=this.createRedeemScript(s);if(u&&!c.equals(u))throw new Error(`User-supplied redeemScript ${u.toString("hex")} doesn't
       match expected ${c.toString("hex")} for input ${t}`);this.psbt.setInputRedeemScript(t,c),this.psbt.setInputWitnessUtxo(t,n.amount,n.cond.scriptPubKey)}setSingleKeyOutput(t,r,n,s){this.psbt.setOutputRedeemScript(t,r.redeemScript),this.psbt.setOutputBip32Derivation(t,n,this.masterFp,s)}getDescriptorTemplate(){return"sh(wpkh(@0))"}createRedeemScript(t){const r=Or(t);return m.concat([m.from("0014","hex"),r])}}class gv extends ti{singleKeyCondition(t){const r=new jt,n=Or(t);return r.writeSlice(m.from([0,Qn])),r.writeSlice(n),{scriptPubKey:r.buffer()}}setSingleKeyInput(t,r,n,s,i){if(!r)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,r),this.psbt.setInputBip32Derivation(t,s,this.masterFp,i),this.psbt.setInputWitnessUtxo(t,n.amount,n.cond.scriptPubKey)}setSingleKeyOutput(t,r,n,s){this.psbt.setOutputBip32Derivation(t,n,this.masterFp,s)}getDescriptorTemplate(){return"wpkh(@0)"}}class rr{constructor(t,r=tr.sha256){this.leaves=t,this.h=r;const n=this.calculateRoot(t);this.rootNode=n.root,this.leafNodes=n.leaves}getRoot(){return this.rootNode.hash}size(){return this.leaves.length}getLeaves(){return this.leaves}getLeafHash(t){return this.leafNodes[t].hash}getProof(t){if(t>=this.leaves.length)throw Error("Index out of bounds");return Js(this.leafNodes[t])}calculateRoot(t){const r=t.length;if(r==0)return{root:new Qs(void 0,void 0,m.alloc(32,0)),leaves:[]};if(r==1){const y=new Qs(void 0,void 0,t[0]);return{root:y,leaves:[y]}}const n=vv(r),s=this.calculateRoot(t.slice(0,n)),i=this.calculateRoot(t.slice(n)),u=s.root,c=i.root,p=this.hashNode(u.hash,c.hash),g=new Qs(u,c,p);return u.parent=g,c.parent=g,{root:g,leaves:s.leaves.concat(i.leaves)}}hashNode(t,r){return this.h(m.concat([m.from([1]),t,r]))}}function nr(e,t=tr.sha256){return wv(m.from([0]),e,t)}function wv(e,t,r){return r(m.concat([e,t]))}class Qs{constructor(t,r,n){this.leftChild=t,this.rightChild=r,this.hash=n}isLeaf(){return this.leftChild==null}}function Js(e){if(!e.parent)return[];if(e.parent.leftChild==e){if(!e.parent.rightChild)throw new Error("Expected right child to exist");return[e.parent.rightChild.hash,...Js(e.parent)]}else{if(!e.parent.leftChild)throw new Error("Expected left child to exist");return[e.parent.leftChild.hash,...Js(e.parent)]}}function vv(e){if(e<2)throw Error("Expected n >= 2");return yv(e)?e/2:1<<Math.floor(Math.log2(e))}function yv(e){return(e&e-1)==0}class Hh{constructor(t,r){this.descriptorTemplate=t,this.keys=[r]}getWalletId(){return tr.sha256(this.serialize())}serialize(){const t=this.keys.map(s=>m.from(s,"ascii")),r=new rr(t.map(s=>nr(s))),n=new jt;return n.writeUInt8(1),n.writeUInt8(0),n.writeVarSlice(m.from(this.descriptorTemplate,"ascii")),n.writeVarInt(this.keys.length),n.writeSlice(r.getRoot()),n.buffer()}}function Lh(e,t,r){const n=zs(t);return`[${e.toString("hex")}${n.substring(1)}]${r}/**`}function Ev(e){var t,r;const n=new jt;n.writeUInt32(e.getGlobalTxVersion());const s=!!e.getInputWitnessUtxo(0);s&&n.writeSlice(m.from([0,1]));const i=e.getGlobalInputCount();n.writeVarInt(i);const u=new jt;for(let p=0;p<i;p++)n.writeSlice(e.getInputPreviousTxid(p)),n.writeUInt32(e.getInputOutputIndex(p)),n.writeVarSlice((t=e.getInputFinalScriptsig(p))!==null&&t!==void 0?t:m.from([])),n.writeUInt32(e.getInputSequence(p)),s&&u.writeSlice(e.getInputFinalScriptwitness(p));const c=e.getGlobalOutputCount();n.writeVarInt(c);for(let p=0;p<c;p++)n.writeUInt64(e.getOutputAmount(p)),n.writeVarSlice(e.getOutputScript(p));return n.writeSlice(u.buffer()),n.writeUInt32((r=e.getGlobalFallbackLocktime())!==null&&r!==void 0?r:0),n.buffer()}var te;(function(e){e[e.TX_VERSION=2]="TX_VERSION",e[e.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",e[e.INPUT_COUNT=4]="INPUT_COUNT",e[e.OUTPUT_COUNT=5]="OUTPUT_COUNT",e[e.TX_MODIFIABLE=6]="TX_MODIFIABLE",e[e.VERSION=251]="VERSION"})(te||(te={}));var V;(function(e){e[e.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",e[e.WITNESS_UTXO=1]="WITNESS_UTXO",e[e.PARTIAL_SIG=2]="PARTIAL_SIG",e[e.SIGHASH_TYPE=3]="SIGHASH_TYPE",e[e.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",e[e.BIP32_DERIVATION=6]="BIP32_DERIVATION",e[e.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",e[e.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",e[e.PREVIOUS_TXID=14]="PREVIOUS_TXID",e[e.OUTPUT_INDEX=15]="OUTPUT_INDEX",e[e.SEQUENCE=16]="SEQUENCE",e[e.TAP_KEY_SIG=19]="TAP_KEY_SIG",e[e.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION"})(V||(V={}));var oe;(function(e){e[e.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",e[e.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",e[e.AMOUNT=3]="AMOUNT",e[e.SCRIPT=4]="SCRIPT",e[e.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})(oe||(oe={}));const Iv=m.from([112,115,98,116,255]);class bv extends Error{}class Dh{constructor(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}setGlobalTxVersion(t){this.setGlobal(te.TX_VERSION,Mr(t))}getGlobalTxVersion(){return this.getGlobal(te.TX_VERSION).readUInt32LE(0)}setGlobalFallbackLocktime(t){this.setGlobal(te.FALLBACK_LOCKTIME,Mr(t))}getGlobalFallbackLocktime(){var t;return(t=this.getGlobalOptional(te.FALLBACK_LOCKTIME))===null||t===void 0?void 0:t.readUInt32LE(0)}setGlobalInputCount(t){this.setGlobal(te.INPUT_COUNT,Bh(t))}getGlobalInputCount(){return $h(this.getGlobal(te.INPUT_COUNT))}setGlobalOutputCount(t){this.setGlobal(te.OUTPUT_COUNT,Bh(t))}getGlobalOutputCount(){return $h(this.getGlobal(te.OUTPUT_COUNT))}setGlobalTxModifiable(t){this.setGlobal(te.TX_MODIFIABLE,t)}getGlobalTxModifiable(){return this.getGlobalOptional(te.TX_MODIFIABLE)}setGlobalPsbtVersion(t){this.setGlobal(te.VERSION,Mr(t))}getGlobalPsbtVersion(){return this.getGlobal(te.VERSION).readUInt32LE(0)}setInputNonWitnessUtxo(t,r){this.setInput(t,V.NON_WITNESS_UTXO,Z(),r)}getInputNonWitnessUtxo(t){return this.getInputOptional(t,V.NON_WITNESS_UTXO,Z())}setInputWitnessUtxo(t,r,n){const s=new jt;s.writeSlice(r),s.writeVarSlice(n),this.setInput(t,V.WITNESS_UTXO,Z(),s.buffer())}getInputWitnessUtxo(t){const r=this.getInputOptional(t,V.WITNESS_UTXO,Z());if(!r)return;const n=new er(r);return{amount:n.readSlice(8),scriptPubKey:n.readVarSlice()}}setInputPartialSig(t,r,n){this.setInput(t,V.PARTIAL_SIG,r,n)}getInputPartialSig(t,r){return this.getInputOptional(t,V.PARTIAL_SIG,r)}setInputSighashType(t,r){this.setInput(t,V.SIGHASH_TYPE,Z(),Mr(r))}getInputSighashType(t){const r=this.getInputOptional(t,V.SIGHASH_TYPE,Z());if(r)return r.readUInt32LE(0)}setInputRedeemScript(t,r){this.setInput(t,V.REDEEM_SCRIPT,Z(),r)}getInputRedeemScript(t){return this.getInputOptional(t,V.REDEEM_SCRIPT,Z())}setInputBip32Derivation(t,r,n,s){if(r.length!=33)throw new Error("Invalid pubkey length: "+r.length);this.setInput(t,V.BIP32_DERIVATION,r,this.encodeBip32Derivation(n,s))}getInputBip32Derivation(t,r){const n=this.getInputOptional(t,V.BIP32_DERIVATION,r);if(n)return this.decodeBip32Derivation(n)}setInputFinalScriptsig(t,r){this.setInput(t,V.FINAL_SCRIPTSIG,Z(),r)}getInputFinalScriptsig(t){return this.getInputOptional(t,V.FINAL_SCRIPTSIG,Z())}setInputFinalScriptwitness(t,r){this.setInput(t,V.FINAL_SCRIPTWITNESS,Z(),r)}getInputFinalScriptwitness(t){return this.getInput(t,V.FINAL_SCRIPTWITNESS,Z())}setInputPreviousTxId(t,r){this.setInput(t,V.PREVIOUS_TXID,Z(),r)}getInputPreviousTxid(t){return this.getInput(t,V.PREVIOUS_TXID,Z())}setInputOutputIndex(t,r){this.setInput(t,V.OUTPUT_INDEX,Z(),Mr(r))}getInputOutputIndex(t){return this.getInput(t,V.OUTPUT_INDEX,Z()).readUInt32LE(0)}setInputSequence(t,r){this.setInput(t,V.SEQUENCE,Z(),Mr(r))}getInputSequence(t){var r,n;return(n=(r=this.getInputOptional(t,V.SEQUENCE,Z()))===null||r===void 0?void 0:r.readUInt32LE(0))!==null&&n!==void 0?n:4294967295}setInputTapKeySig(t,r){this.setInput(t,V.TAP_KEY_SIG,Z(),r)}getInputTapKeySig(t){return this.getInputOptional(t,V.TAP_KEY_SIG,Z())}setInputTapBip32Derivation(t,r,n,s,i){if(r.length!=32)throw new Error("Invalid pubkey length: "+r.length);const u=this.encodeTapBip32Derivation(n,s,i);this.setInput(t,V.TAP_BIP32_DERIVATION,r,u)}getInputTapBip32Derivation(t,r){const n=this.getInput(t,V.TAP_BIP32_DERIVATION,r);return this.decodeTapBip32Derivation(n)}getInputKeyDatas(t,r){return this.getKeyDatas(this.inputMaps[t],r)}setOutputRedeemScript(t,r){this.setOutput(t,oe.REDEEM_SCRIPT,Z(),r)}getOutputRedeemScript(t){return this.getOutput(t,oe.REDEEM_SCRIPT,Z())}setOutputBip32Derivation(t,r,n,s){this.setOutput(t,oe.BIP_32_DERIVATION,r,this.encodeBip32Derivation(n,s))}getOutputBip32Derivation(t,r){const n=this.getOutput(t,oe.BIP_32_DERIVATION,r);return this.decodeBip32Derivation(n)}setOutputAmount(t,r){this.setOutput(t,oe.AMOUNT,Z(),Tv(r))}getOutputAmount(t){const r=this.getOutput(t,oe.AMOUNT,Z());return kh(r)}setOutputScript(t,r){this.setOutput(t,oe.SCRIPT,Z(),r)}getOutputScript(t){return this.getOutput(t,oe.SCRIPT,Z())}setOutputTapBip32Derivation(t,r,n,s,i){const u=this.encodeTapBip32Derivation(n,s,i);this.setOutput(t,oe.TAP_BIP32_DERIVATION,r,u)}getOutputTapBip32Derivation(t,r){const n=this.getOutput(t,oe.TAP_BIP32_DERIVATION,r);return this.decodeTapBip32Derivation(n)}deleteInputEntries(t,r){this.inputMaps[t].forEach((n,s,i)=>{this.isKeyType(s,r)&&i.delete(s)})}copy(t){this.copyMap(this.globalMap,t.globalMap),this.copyMaps(this.inputMaps,t.inputMaps),this.copyMaps(this.outputMaps,t.outputMaps)}copyMaps(t,r){t.forEach((n,s)=>{const i=new Map;this.copyMap(n,i),r[s]=i})}copyMap(t,r){t.forEach((n,s)=>r.set(s,m.from(n)))}serialize(){const t=new jt;return t.writeSlice(m.from([112,115,98,116,255])),to(t,this.globalMap),this.inputMaps.forEach(r=>{to(t,r)}),this.outputMaps.forEach(r=>{to(t,r)}),t.buffer()}deserialize(t){const r=new er(t);if(!r.readSlice(5).equals(Iv))throw new Error("Invalid magic bytes");for(;this.readKeyPair(this.globalMap,r););for(let n=0;n<this.getGlobalInputCount();n++)for(this.inputMaps[n]=new Map;this.readKeyPair(this.inputMaps[n],r););for(let n=0;n<this.getGlobalOutputCount();n++)for(this.outputMaps[n]=new Map;this.readKeyPair(this.outputMaps[n],r););}readKeyPair(t,r){const n=r.readVarInt();if(n==0)return!1;const s=r.readUInt8(),i=r.readSlice(n-1),u=r.readVarSlice();return eo(t,s,i,u),!0}getKeyDatas(t,r){const n=[];return t.forEach((s,i)=>{this.isKeyType(i,[r])&&n.push(m.from(i.substring(2),"hex"))}),n}isKeyType(t,r){const n=m.from(t.substring(0,2),"hex").readUInt8(0);return r.some(s=>s==n)}setGlobal(t,r){const n=new ei(t,m.from([]));this.globalMap.set(n.toString(),r)}getGlobal(t){return Fr(this.globalMap,t,Z(),!1)}getGlobalOptional(t){return Fr(this.globalMap,t,Z(),!0)}setInput(t,r,n,s){eo(this.getMap(t,this.inputMaps),r,n,s)}getInput(t,r,n){return Fr(this.inputMaps[t],r,n,!1)}getInputOptional(t,r,n){return Fr(this.inputMaps[t],r,n,!0)}setOutput(t,r,n,s){eo(this.getMap(t,this.outputMaps),r,n,s)}getOutput(t,r,n){return Fr(this.outputMaps[t],r,n,!1)}getMap(t,r){return r[t]?r[t]:r[t]=new Map}encodeBip32Derivation(t,r){const n=new jt;return this.writeBip32Derivation(n,t,r),n.buffer()}decodeBip32Derivation(t){const r=new er(t);return this.readBip32Derivation(r)}writeBip32Derivation(t,r,n){t.writeSlice(r),n.forEach(s=>{t.writeUInt32(s)})}readBip32Derivation(t){const r=t.readSlice(4),n=[];for(;t.offset<t.buffer.length;)n.push(t.readUInt32());return{masterFingerprint:r,path:n}}encodeTapBip32Derivation(t,r,n){const s=new jt;return s.writeVarInt(t.length),t.forEach(i=>{s.writeSlice(i)}),this.writeBip32Derivation(s,r,n),s.buffer()}decodeTapBip32Derivation(t){const r=new er(t),n=r.readVarInt(),s=[];for(let u=0;u<n;u++)s.push(r.readSlice(32));const i=this.readBip32Derivation(r);return Object.assign({hashes:s},i)}}function Fr(e,t,r,n){if(!e)throw Error("No such map");const s=new ei(t,r),i=e.get(s.toString());if(!i){if(n)return;throw new bv(s.toString())}return m.from(i)}class ei{constructor(t,r){this.keyType=t,this.keyData=r}toString(){const t=new jt;return this.toBuffer(t),t.buffer().toString("hex")}serialize(t){t.writeVarInt(1+this.keyData.length),this.toBuffer(t)}toBuffer(t){t.writeUInt8(this.keyType),t.writeSlice(this.keyData)}}class Sv{constructor(t,r){this.key=t,this.value=r}serialize(t){this.key.serialize(t),t.writeVarSlice(this.value)}}function _v(e){return new ei(e.readUInt8(0),e.slice(1))}function to(e,t){for(const r of t.keys()){const n=t.get(r);new Sv(_v(m.from(r,"hex")),n).serialize(e)}e.writeUInt8(0)}function Z(){return m.from([])}function eo(e,t,r,n){const s=new ei(t,r);e.set(s.toString(),n)}function Mr(e){const t=m.alloc(4);return t.writeUInt32LE(e,0),t}function Tv(e){return Nh(e)}function Bh(e){const t=new jt;return t.writeVarInt(e),t.buffer()}function $h(e){return new er(e).readVarInt()}function Pv(e){const t=e.getGlobalInputCount();for(let r=0;r<t;r++){const n=e.getInputKeyDatas(r,V.PARTIAL_SIG),s=e.getInputTapKeySig(r);if(n.length==0&&!s)throw Error(`No signature for input ${r} present`);if(n.length>0){if(n.length>1)throw Error(`Expected exactly one signature, got ${n.length}`);if(s)throw Error("Both taproot and non-taproot signatures present.");const i=!!e.getInputWitnessUtxo(r),u=e.getInputRedeemScript(r),c=!!u,p=e.getInputPartialSig(r,n[0]);if(!p)throw new Error("Expected partial signature for input "+r);if(i){const g=new jt;if(g.writeVarInt(2),g.writeVarInt(p.length),g.writeSlice(p),g.writeVarInt(n[0].length),g.writeSlice(n[0]),e.setInputFinalScriptwitness(r,g.buffer()),c){if(!u||u.length==0)throw new Error("Expected non-empty redeemscript. Can't finalize intput "+r);const y=new jt;y.writeUInt8(u.length),y.writeSlice(u),e.setInputFinalScriptsig(r,y.buffer())}}else{const g=new jt;Gh(g,p),Gh(g,n[0]),e.setInputFinalScriptsig(r,g.buffer())}}else{const i=e.getInputTapKeySig(r);if(!i)throw Error("No taproot signature found");if(i.length!=64&&i.length!=65)throw Error("Unexpected length of schnorr signature.");const u=new jt;u.writeVarInt(1),u.writeVarSlice(i),e.setInputFinalScriptwitness(r,u.buffer())}Ov(e,r)}}function Ov(e,t){const r=[V.BIP32_DERIVATION,V.PARTIAL_SIG,V.TAP_BIP32_DERIVATION,V.TAP_KEY_SIG],n=!!e.getInputWitnessUtxo(t),s=!!e.getInputNonWitnessUtxo(t);n&&s&&r.push(V.NON_WITNESS_UTXO),e.deleteInputEntries(t,r)}function Gh(e,t){if(t.length<=75)e.writeUInt8(t.length);else if(t.length<=256)e.writeUInt8(76),e.writeUInt8(t.length);else if(t.length<=256*256){e.writeUInt8(77);const r=m.alloc(2);r.writeUInt16LE(t.length,0),e.writeSlice(r)}e.writeSlice(t)}function Ar(e,t){if(e[t]<253)return[e[t],1];if(e[t]===253)return[(e[t+2]<<8)+e[t+1],3];if(e[t]===254)return[(e[t+4]<<24)+(e[t+3]<<16)+(e[t+2]<<8)+e[t+1],5];throw new Error("getVarint called with unexpected parameters")}function Wt(e){if(e<253){const r=m.alloc(1);return r[0]=e,r}if(e<=65535){const r=m.alloc(3);return r[0]=253,r[1]=e&255,r[2]=e>>8&255,r}const t=m.alloc(5);return t[0]=254,t[1]=e&255,t[2]=e>>8&255,t[3]=e>>16&255,t[4]=e>>24&255,t}function Kh({outputs:e}){let t=m.alloc(0);return typeof e<"u"&&(t=m.concat([t,Wt(e.length)]),e.forEach(r=>{t=m.concat([t,r.amount,Wt(r.script.length),r.script])})),t}function ro(e,t,r,n=[]){const s=n.includes("decred"),i=n.includes("zcash"),u=n.includes("bech32");let c=m.alloc(0);const p=typeof e.witness<"u"&&!t;e.inputs.forEach(y=>{c=s||u?m.concat([c,y.prevout,m.from([0]),y.sequence]):m.concat([c,y.prevout,Wt(y.script.length),y.script,y.sequence])});let g=Kh(e);return typeof e.outputs<"u"&&typeof e.locktime<"u"&&(g=m.concat([g,p&&e.witness||m.alloc(0),e.locktime,e.nExpiryHeight||m.alloc(0),e.extraData||m.alloc(0)])),i?m.concat([e.version,e.nVersionGroupId||m.alloc(0),m.from([180,208,214,194]),e.locktime||m.from([0,0,0,0]),e.nExpiryHeight||m.from([0,0,0,0]),p?m.from("0001","hex"):m.alloc(0),Wt(e.inputs.length),c,g]):m.concat([e.version,r||m.alloc(0),e.nVersionGroupId||m.alloc(0),p?m.from("0001","hex"):m.alloc(0),Wt(e.inputs.length),c,g])}var Fe=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};class Mv{constructor(t){this.client=t}getWalletXpub(t){return Fe(this,arguments,void 0,function*({path:r,xpubVersion:n}){const s=Ae(r),i=yield this.client.getExtendedPubkey(!1,s),u=Ah(i);if(u.version!=n)throw new Error(`Expected xpub version ${n} doesn't match the xpub version from the device ${u.version}`);return i})}getWalletPublicKey(t,r){return Fe(this,void 0,void 0,function*(){var n,s;if(!Hv(t))throw Error(`non-standard path: ${t}`);const i=Ae(t),u=yield this.client.getExtendedPubkey(!1,i),c=(n=r==null?void 0:r.verify)!==null&&n!==void 0?n:!1,p=yield this.getWalletAddress(i,Av((s=r==null?void 0:r.format)!==null&&s!==void 0?s:"legacy"),c),g=Ah(u);return{publicKey:m.from(pe.pointCompress(g.pubkey,!1)).toString("hex"),bitcoinAddress:p,chainCode:g.chaincode.toString("hex")}})}getWalletAddress(t,r,n){return Fe(this,void 0,void 0,function*(){const s=av(t);if(s.length+2!=t.length)return"";const i=yield this.client.getExtendedPubkey(!1,s),u=yield this.client.getMasterFingerprint(),c=new Hh(r,Lh(u,s,i)),p=t.slice(-2,t.length);return this.client.getWalletAddress(c,m.alloc(32,0),p[0],p[1],n)})}createPaymentTransaction(t){return Fe(this,void 0,void 0,function*(){const r=t.inputs.length;if(r==0)throw Error("No inputs");const n=new Dh,s=yield this.client.getMasterFingerprint(),i=Nv(t,n,s);t.lockTime!=null&&n.setGlobalFallbackLocktime(t.lockTime),n.setGlobalInputCount(r),n.setGlobalPsbtVersion(2),n.setGlobalTxVersion(2);let u=0;const c=()=>{t.onDeviceStreaming&&t.onDeviceStreaming({total:2*r,index:u,progress:++u/(2*r)})};let p="",g=[];for(let N=0;N<r;N++){c();const R=Ae(t.associatedKeysets[N]);p==""&&(g=R.slice(0,-2),p=yield this.client.getExtendedPubkey(!1,g)),yield this.setInput(n,N,t.inputs[N],R,i,s,t.sigHashType)}const y=m.from(t.outputScriptHex,"hex"),b=new er(y),O=b.readVarInt();n.setGlobalOutputCount(O);const S=yield this.outputScriptAt(g,i,t.changePath);let T=!S;for(let N=0;N<O;N++){const R=Number(b.readUInt64()),G=b.readVarSlice();if(n.setOutputAmount(N,R),n.setOutputScript(N,G),S&&G.equals(S==null?void 0:S.cond.scriptPubKey)){T=!0;const C=Ae(t.changePath),$=S.pubkey;i.setOwnOutput(N,S.cond,[$],[C])}}if(!T)throw new Error("Change script not found among outputs! "+(S==null?void 0:S.cond.scriptPubKey.toString("hex")));const H=Lh(s,g,p),x=new Hh(i.getDescriptorTemplate(),H);t.onDeviceSignatureRequested&&t.onDeviceSignatureRequested();let L=!1;const M=()=>{L||(L=!0,t.onDeviceSignatureGranted&&t.onDeviceSignatureGranted()),c()};return yield this.signPsbt(n,x,M),Pv(n),Ev(n).toString("hex")})}signMessage(t){return Fe(this,arguments,void 0,function*({path:r,messageHex:n}){const s=Ae(r),i=m.from(n,"hex"),u=yield this.client.signMessage(i,s),c=m.from(u,"base64"),p=c.readUInt8()-27-4,g=c.slice(1,33).toString("hex"),y=c.slice(33,65).toString("hex");return{v:p,r:g,s:y}})}outputScriptAt(t,r,n){return Fe(this,void 0,void 0,function*(){if(!n)return;const s=Ae(n);for(let c=0;c<t.length;c++)if(t[c]!=s[c])throw new Error(`Path ${n} not in account ${zs(t)}`);const i=yield this.client.getExtendedPubkey(!1,s),u=Mh(i);return{cond:r.spendingCondition([u]),pubkey:u}})}setInput(t,r,n,s,i,u,c){return Fe(this,void 0,void 0,function*(){const p=n[0],g=n[1],y=n[2]?m.from(n[2],"hex"):void 0,b=n[3];b!=null&&t.setInputSequence(r,b),c!=null&&t.setInputSighashType(r,c);const O=ro(p,!0),S=tr.hash256(O),T=yield this.client.getExtendedPubkey(!1,s),H=Mh(T);if(!p.outputs)throw Error("Missing outputs array in transaction to sign");const x=p.outputs[g],L={cond:{scriptPubKey:x.script,redeemScript:y},amount:x.amount};i.setInput(r,O,L,[H],[s]),t.setInputPreviousTxId(r,S),t.setInputOutputIndex(r,g)})}signPsbt(t,r,n){return Fe(this,void 0,void 0,function*(){(yield this.client.signPsbt(t,r,m.alloc(32,0),n)).forEach((s,i)=>{const u=t.getInputKeyDatas(i,V.BIP32_DERIVATION);let c;if(u.length!=1){if(c=t.getInputKeyDatas(i,V.TAP_BIP32_DERIVATION),c.length==0)throw Error(`Missing pubkey derivation for input ${i}`);t.setInputTapKeySig(i,s)}else c=u[0],t.setInputPartialSig(i,c,s)})})}}function Av(e){if(e=="legacy")return"pkh(@0)";if(e=="p2sh")return"sh(wpkh(@0))";if(e=="bech32")return"wpkh(@0)";if(e=="bech32m")return"tr(@0)";throw new Error("Unsupported address format "+e)}function Nv(e,t,r){return e.additionals.includes("bech32m")?new dv(t,r):e.additionals.includes("bech32")?new gv(t,r):e.segwit?new mv(t,r):new fv(t,r)}const Wr=2147483648,kv=[0,1,88],Rv=[44,49,84,86],xv=[48],no=e=>e>=Wr,Fh=e=>e===void 0||e<Wr,Wh=e=>e===void 0||e===0||e===1,Vh=new Set(kv.map(e=>e+Wr)),Uv=new Set(Rv.map(e=>e+Wr)),Cv=new Set(xv.map(e=>e+Wr));function Hv(e){const t=Ae(e);return!!(t.length>=3&&t.length<=5&&Uv.has(t[0])&&Vh.has(t[1])&&no(t[2])&&Wh(t[3])&&Fh(t[4])||t.length>=4&&t.length<=6&&Cv.has(t[0])&&Vh.has(t[1])&&no(t[2])&&no(t[3])&&Wh(t[4])&&Fh(t[5]))}var Lv=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};const qh={legacy:0,p2sh:1,bech32:2,cashaddr:3};function io(e,t){return Lv(this,void 0,void 0,function*(){const{path:r,verify:n,format:s}=Object.assign({verify:!1,format:"legacy"},t);if(!(s in qh))throw new Error("btc.getWalletPublicKey invalid format="+s);const i=js(r),u=n?1:0,c=qh[s],p=yield e.send(224,64,u,c,i),g=p[0],y=p[1+g],b=p.slice(1,1+g).toString("hex"),O=p.slice(1+g+1,1+g+1+y).toString("ascii"),S=p.slice(1+g+1+y,1+g+1+y+32).toString("hex");return{publicKey:b,bitcoinAddress:O,chainCode:S}})}var so=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};function Nr(e,t,r){return so(this,void 0,void 0,function*(){let n,s=!1;if(typeof r=="number"){s=!0;const u=m.alloc(4);u.writeUInt32BE(r,0),n=m.concat([u,t],t.length+4)}else n=t;const i=yield e.send(224,66,s?0:128,0,n);return i.slice(0,i.length-2).toString("hex")})}function oo(e,t,r){return so(this,arguments,void 0,function*(n,s,i,u=[]){const{version:c,inputs:p,outputs:g,locktime:y,nExpiryHeight:b,extraData:O}=i;if(!g||!y)throw new Error("getTrustedInput: locktime & outputs is expected");const S=u.includes("decred"),T=u.includes("stealthcoin"),H=(R,G)=>so(this,void 0,void 0,function*(){const C=G||m.alloc(0),$=[];let K=0;for(;K!==R.length;){const B=R.length-K>Ke?Ke:R.length-K;K+B!==R.length?$.push(R.slice(K,K+B)):$.push(m.concat([R.slice(K,K+B),C])),K+=B}R.length===0&&$.push(C);let k;for(const B of $)k=yield Nr(n,B);return k}),x=R=>Nr(n,R);yield Nr(n,m.concat([i.version,i.timestamp||m.alloc(0),i.nVersionGroupId||m.alloc(0),Wt(p.length)]),s);for(const R of p){const G=T&&m.compare(c,m.from([2,0,0,0]))===0,C=S?R.tree||m.from([0]):m.alloc(0),$=m.concat([R.prevout,C,G?m.from([0]):Wt(R.script.length)]);yield Nr(n,$),yield S?x(m.concat([R.script,R.sequence])):G?x(R.sequence):H(R.script,R.sequence)}yield Nr(n,Wt(g.length));for(const R of g){const G=m.concat([R.amount,S?m.from([0,0]):m.alloc(0),Wt(R.script.length),R.script]);yield Nr(n,G)}const L=[];b&&b.length>0&&L.push(b),O&&O.length>0&&L.push(O);let M;if(L.length){const R=m.concat(L);M=S?R:m.concat([Wt(R.length),R])}const N=yield H(m.concat([y,M||m.alloc(0)]));return Do(N,"missing result in processScriptBlocks"),N})}var Dv=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};function uo(e,t,r,n,s=!1,i=!1,u=[]){const c=u.includes("cashaddr")?3:s?u.includes("sapling")?5:i?4:2:0;return e.send(224,68,r?0:128,t?c:128,n)}function ri(e,t,r,n){return Dv(this,arguments,void 0,function*(s,i,u,c,p=!1,g=!1,y=[],b=!1){let O=m.concat([u.version,u.timestamp||m.alloc(0),u.nVersionGroupId||m.alloc(0),Wt(u.inputs.length)]);yield uo(s,i,!0,O,p,g,y);let S=0;const T=y.includes("decred");for(const H of u.inputs){let x;const L=c[S].value;p?b&&c[S].trustedInput?x=m.from([1,L.length]):x=m.from([2]):c[S].trustedInput?x=m.from([1,c[S].value.length]):x=m.from([0]),O=m.concat([x,L,T?m.from([0]):m.alloc(0),Wt(H.script.length)]),yield uo(s,i,!1,O,p,g,y);const M=[];let N=0;if(H.script.length===0)M.push(H.sequence);else for(;N!==H.script.length;){const R=H.script.length-N>Ke?Ke:H.script.length-N;N+R!==H.script.length?M.push(H.script.slice(N,N+R)):M.push(m.concat([H.script.slice(N,N+R),H.sequence])),N+=R}for(const R of M)yield uo(s,i,!1,R,p,g,y);S++}})}function ao(e,t,r,n=[]){if(!r)throw new Error("getTrustedInputBIP143: missing tx");if(n.includes("decred"))throw new Error("Decred does not implement BIP143");let s=Jn("sha256").update(Jn("sha256").update(ro(r,!0)).digest()).digest();const i=m.alloc(4);i.writeUInt32LE(t,0);const{outputs:u,locktime:c}=r;if(!u||!c)throw new Error("getTrustedInputBIP143: locktime & outputs is expected");if(!u[t])throw new Error("getTrustedInputBIP143: wrong index");return s=m.concat([s,i,u[t].amount]),s.toString("hex")}function Bv(e){const t=e[64]&1?3:2,r=m.alloc(1);return r[0]=t,m.concat([r,e.slice(1,33)])}function ho(e,t,r,n,s,i=[]){const u=i.includes("decred"),c=js(t),p=m.alloc(4);p.writeUInt32BE(r,0);let g=u?m.concat([c,p,s||m.from([0,0,0,0]),m.from([n])]):m.concat([c,m.from([0]),p,m.from([n])]);return s&&!u&&(g=m.concat([g,s])),e.send(224,72,0,0,g).then(y=>y.length>0?(y[0]=48,y.slice(0,y.length-2)):y)}var $v=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};function Xh(e,t){const r=js(t);return e.send(224,74,255,0,r)}function ni(e,t){return $v(this,arguments,void 0,function*(r,n,s=[]){let i=0;const u=128;if(s.includes("decred"))return r.send(224,74,u,0,n);for(;i<n.length;){const c=i+Ke>=n.length?n.length-i:Ke,p=i+c===n.length?128:0,g=n.slice(i,i+c);yield r.send(224,74,p,0,g),i+=c}})}var jh=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};const zh=e=>jh(void 0,void 0,void 0,function*(){const t=yield e.send(176,1,0,0);let r=0;const n=t[r++];Do(n===1,"getAppAndVersion: format not supported");const s=t[r++],i=t.slice(r,r+=s).toString("ascii"),u=t[r++],c=t.slice(r,r+=u).toString("ascii"),p=t[r++],g=t.slice(r,r+=p);return{name:i,version:c,flags:g}}),Gv=e=>jh(void 0,void 0,void 0,function*(){try{yield e.send(224,196,0,0)}catch{return!1}return!0});function Kv({version:e,name:t}){return t==="Decred"?!1:t==="Exchange"?!0:Vi.gte(e,"1.4.0")}var Fv=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};const Wv={lockTime:Rh,sigHashType:Ys,segwit:!1,additionals:[],onDeviceStreaming:e=>{},onDeviceSignatureGranted:()=>{},onDeviceSignatureRequested:()=>{}};function Vv(e,t){return Fv(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},Wv),t),{inputs:n,associatedKeysets:s,changePath:i,outputScriptHex:u,lockTime:c,sigHashType:p,segwit:g,initialTimestamp:y,additionals:b,expiryHeight:O,onDeviceStreaming:S,onDeviceSignatureGranted:T,onDeviceSignatureRequested:H}=r;let x=r.useTrustedInputForSegwit;if(x===void 0)try{const _=yield zh(e);x=Kv(_)}catch(_){if(_.statusCode===27904)x=!1;else throw _}const L=(_,P)=>{const{length:U}=n;if(U<3)return;const D=U*_+P,q=2*U,ie=D/q;S({progress:ie,total:q,index:D})},M=b.includes("decred"),N=b.includes("zcash"),R=b.includes("stealthcoin"),G=Date.now(),C=b.includes("sapling"),$=g&&b.includes("bech32"),K=g||!!b&&(b.includes("abc")||b.includes("gold")||b.includes("bip143"))||!!O&&!M,k=m.alloc(4);k.writeUInt32LE(c,0);const B=m.alloc(0),o=m.alloc(0),h=m.alloc(4);O&&!M?h.writeUInt32LE(N?2147483653:C?2147483652:2147483651,0):R?h.writeUInt32LE(2,0):h.writeUInt32LE(1,0);const l=[],f=[],w=[],E=[];let I=!0;const d={inputs:[],version:h,timestamp:m.alloc(0)},a=K&&!x?ao:oo,v=m.from(u,"hex");L(0,0);for(const _ of n){{const D=yield a(e,_[1],_[0],b);Bo("hw","got trustedInput="+D);const q=m.alloc(4);q.writeUInt32LE(_.length>=4&&typeof _[3]=="number"?_[3]:Zn,0),l.push({trustedInput:!0,value:m.from(D,"hex"),sequence:q})}const{outputs:P}=_[0],U=_[1];P&&U<=P.length-1&&f.push(P[U]),O&&!M?(d.nVersionGroupId=m.from(N?[10,39,167,38]:C?[133,32,47,137]:[112,130,196,3]),d.nExpiryHeight=O,d.extraData=m.from(C?[0,0,0,0,0,0,0,0,0,0,0]:[0])):M&&(d.nExpiryHeight=O)}d.inputs=n.map((_,P)=>{const U=m.alloc(4);return U.writeUInt32LE(_.length>=4&&typeof _[3]=="number"?_[3]:Zn,0),{script:N?f[P].script:B,prevout:o,sequence:U}});{const _=[];for(let P=0;P<n.length;P++){const U=yield io(e,{path:s[P]});L(0,P+1),_.push(U)}for(let P=0;P<_.length;P++)E.push(Bv(m.from(_[P].publicKey,"hex")))}y!==void 0&&(d.timestamp=m.alloc(4),d.timestamp.writeUInt32LE(Math.floor(y+(Date.now()-G)/1e3),0)),H(),K&&(yield ri(e,!0,d,l,!0,!!O,b,x),i&&(yield Xh(e,i)),yield ni(e,v)),O&&!M&&(yield ho(e,"",c,Ys,O));for(let _=0;_<n.length;_++){const P=n[_],U=n[_].length>=3&&typeof P[2]=="string"?m.from(P[2],"hex"):g?m.concat([m.from([xh,Zs,Qn]),Or(E[_]),m.from([Uh,Ch])]):f[_].script,D=Object.assign({},d),q=K?[l[_]]:l;K?D.inputs=[Object.assign(Object.assign({},D.inputs[_]),{script:U})]:D.inputs[_].script=U,yield ri(e,!K&&I,D,q,K,!!O&&!M,b,x),K||(i&&(yield Xh(e,i)),yield ni(e,v,b)),I&&(T(),L(1,0));const ie=yield ho(e,s[_],c,p,O,b);L(1,_+1),w.push(ie),d.inputs[_].script=B,I&&(I=!1)}for(let _=0;_<n.length;_++){if(g)d.witness=m.alloc(0),$||(d.inputs[_].script=m.concat([m.from("160014","hex"),Or(E[_])]));else{const U=m.alloc(1),D=m.alloc(1);U[0]=w[_].length,D[0]=E[_].length,d.inputs[_].script=m.concat([U,w[_],D,E[_]])}const P=K&&!x?0:4;d.inputs[_].prevout=l[_].value.slice(P,P+36)}d.locktime=k;let A=m.concat([ro(d,!1,d.timestamp,b),v]);if(g&&!M){let _=m.alloc(0);for(let P=0;P<n.length;P++){const U=m.concat([m.from("02","hex"),m.from([w[P].length]),w[P],m.from([E[P].length]),E[P]]);_=m.concat([_,U])}A=m.concat([A,_])}if(N||(A=m.concat([A,k]),O&&(A=m.concat([A,d.nExpiryHeight||m.alloc(0),d.extraData||m.alloc(0)]))),M){let _=m.from([d.inputs.length]);n.forEach((P,U)=>{_=m.concat([_,m.from([0,0,0,0,0,0,0,0]),m.from([0,0,0,0]),m.from([255,255,255,255]),m.from([d.inputs[U].script.length]),d.inputs[U].script])}),A=m.concat([A,_])}return N&&(A=m.concat([A,m.from([0,0,0])])),A.toString("hex")})}var qv=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};function Xv(e,t){return qv(this,arguments,void 0,function*(r,{path:n,messageHex:s}){const i=Oi.fromString(n).toPathArray(),u=m.from(s,"hex");let c=0;for(;c!==u.length;){const O=c===0?Ke-1-i.length*4-4:Ke,S=c+O>u.length?u.length-c:O,T=m.alloc(c===0?1+i.length*4+2+S:S);c===0?(T[0]=i.length,i.forEach((H,x)=>{T.writeUInt32BE(H,1+4*x)}),T.writeUInt16BE(u.length,1+4*i.length),u.copy(T,1+4*i.length+2,c,c+S)):u.copy(T,0,c,c+S),yield r.send(224,78,0,c===0?1:128,T),c+=S}const p=yield r.send(224,78,128,0,m.from([0])),g=p[0]-48;let y=p.slice(4,4+p[3]);y[0]===0&&(y=y.slice(1)),y=y.toString("hex"),c=4+p[3]+2;let b=p.slice(c,c+p[c-1]);return b[0]===0&&(b=b.slice(1)),b=b.toString("hex"),{v:g,r:y,s:b}})}var co=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};class lo{constructor(t){this.transport=t,this.derivationsCache={}}derivatePath(t){return co(this,void 0,void 0,function*(){if(this.derivationsCache[t])return this.derivationsCache[t];const r=yield io(this.transport,{path:t});return this.derivationsCache[t]=r,r})}getWalletXpub(t){return co(this,arguments,void 0,function*({path:r,xpubVersion:n}){const s=Ae(r),i=s.slice(0,-1),u=yield this.derivatePath(zs(i)),c=yield this.derivatePath(r),p=jv(Zh(m.from(u.publicKey,"hex")));return zv(n,s.length,p,s[s.length-1],m.from(c.chainCode,"hex"),Zh(m.from(c.publicKey,"hex")))})}getWalletPublicKey(t,r){if((r==null?void 0:r.format)==="bech32m")throw new Error("Unsupported address format bech32m");return io(this.transport,Object.assign(Object.assign({},r),{path:t}))}createPaymentTransaction(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return Vv(this.transport,t)}signMessage(t){return co(this,arguments,void 0,function*({path:r,messageHex:n}){return Xv(this.transport,{path:r,messageHex:n})})}}function jv(e){return Qv(e).slice(0,4)}function Yh(e){const t=m.allocUnsafe(4);return t.writeUInt32BE(e,0),t}const Zh=e=>m.concat([m.from([2+(e[64]&1)]),e.slice(1,33)]);function zv(e,t,r,n,s,i){const u=Yh(n);u[0]|=128;const c=m.concat([Yh(e),m.from([t]),r,u,s,i]),p=Yv(c).slice(0,4);return Bm.encode(m.concat([c,p]))}function po(e){return Jn("sha256").update(e).digest()}function Yv(e){return po(po(e))}function Zv(e){return new Lo().update(e).digest()}function Qv(e){return Zv(po(e))}class Jv{constructor(t,r){if(t.length!=r.length)throw new Error("keys and values should have the same length");for(let n=0;n<t.length-1;n++)if(t[n].toString("hex")>=t[n+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=t,this.keysTree=new rr(t.map(n=>nr(n))),this.values=r,this.valuesTree=new rr(r.map(n=>nr(n)))}commitment(){return m.concat([Wt(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])}}class qr extends Dh{constructor(t){super(),this.inputMerkleMaps=[],this.outputMerkleMaps=[],t.copy(this),this.globalMerkleMap=qr.createMerkleMap(this.globalMap);for(let r=0;r<this.getGlobalInputCount();r++)this.inputMerkleMaps.push(qr.createMerkleMap(this.inputMaps[r]));this.inputMapCommitments=[...this.inputMerkleMaps.values()].map(r=>r.commitment());for(let r=0;r<this.getGlobalOutputCount();r++)this.outputMerkleMaps.push(qr.createMerkleMap(this.outputMaps[r]));this.outputMapCommitments=[...this.outputMerkleMaps.values()].map(r=>r.commitment())}getGlobalSize(){return this.globalMap.size}getGlobalKeysValuesRoot(){return this.globalMerkleMap.commitment()}static createMerkleMap(t){const r=[...t.keys()].sort(),n=r.map(i=>{const u=t.get(i);if(!u)throw new Error("No value for key "+i);return u}),s=r.map(i=>m.from(i,"hex"));return new Jv(s,n)}}var ir;(function(e){e[e.YIELD=16]="YIELD",e[e.GET_PREIMAGE=64]="GET_PREIMAGE",e[e.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",e[e.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",e[e.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS"})(ir||(ir={}));class Vr{}class ty extends Vr{constructor(t,r){super(),this.progressCallback=r,this.code=ir.YIELD,this.results=t}execute(t){return this.results.push(m.from(t.subarray(1))),this.progressCallback(),m.from("")}}class ey extends Vr{constructor(t,r){super(),this.code=ir.GET_PREIMAGE,this.known_preimages=t,this.queue=r}execute(t){const r=m.from(t.subarray(1));if(r.length!=33)throw new Error("Invalid request, unexpected trailing data");if(r[0]!=0)throw new Error("Unsupported request, the first byte should be 0");const n=m.alloc(32);for(let u=0;u<32;u++)n[u]=r[1+u];const s=n.toString("hex"),i=this.known_preimages.get(s);if(i!=null){const u=Wt(i.length),c=255-u.length-1,p=Math.min(c,i.length);if(p<i.length)for(let g=p;g<i.length;g++)this.queue.push(m.from([i[g]]));return m.concat([u,m.from([p]),m.from(i.subarray(0,p))])}throw Error(`Requested unknown preimage for: ${s}`)}}class ry extends Vr{constructor(t,r){super(),this.code=ir.GET_MERKLE_LEAF_PROOF,this.known_trees=t,this.queue=r}execute(t){const r=m.from(t.subarray(1));if(r.length<34)throw new Error("Invalid request, expected at least 34 bytes");const n=new er(r),s=n.readSlice(32).toString("hex");let i,u;try{i=n.readVarInt(),u=n.readVarInt()}catch{throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}const c=this.known_trees.get(s);if(!c)throw Error(`Requested Merkle leaf proof for unknown tree: ${s}`);if(u>=i||c.size()!=i)throw Error("Invalid index or tree size.");if(this.queue.length!=0)throw Error("This command should not execute when the queue is not empty.");const p=c.getProof(u),g=Math.min(Math.floor(221/32),p.length),y=p.length-g;return y>0&&this.queue.push(...p.slice(-y)),m.concat([c.getLeafHash(u),m.from([p.length]),m.from([g]),...p.slice(0,g)])}}class ny extends Vr{constructor(t){super(),this.code=ir.GET_MERKLE_LEAF_INDEX,this.known_trees=t}execute(t){const r=m.from(t.subarray(1));if(r.length!=64)throw new Error("Invalid request, unexpected trailing data");const n=m.alloc(32);for(let y=0;y<32;y++)n[y]=r.readUInt8(y);const s=n.toString("hex"),i=m.alloc(32);for(let y=0;y<32;y++)i[y]=r.readUInt8(32+y);const u=i.toString("hex"),c=this.known_trees.get(s);if(!c)throw Error(`Requested Merkle leaf index for unknown root: ${s}`);let p=0,g=0;for(let y=0;y<c.size();y++)if(c.getLeafHash(y).toString("hex")==u){g=1,p=y;break}return m.concat([m.from([g]),Wt(p)])}}class iy extends Vr{constructor(t){super(),this.code=ir.GET_MORE_ELEMENTS,this.queue=t}execute(t){if(t.length!=1)throw new Error("Invalid request, unexpected trailing data");if(this.queue.length===0)throw new Error("No elements to get");const r=this.queue[0].length;if(this.queue.some(u=>u.length!=r))throw new Error("The queue contains elements with different byte length, which is not expected");const n=Math.floor(253/r),s=Math.min(n,this.queue.length),i=this.queue.splice(0,s);return m.concat([m.from([s]),m.from([r]),...i])}}class fo{constructor(t){this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;const r=[new ty(this.yielded,t),new ey(this.preimages,this.queue),new ny(this.roots),new ry(this.roots,this.queue),new iy(this.queue)];for(const n of r){if(this.commands.has(n.code))throw new Error(`Multiple commands with code ${n.code}`);this.commands.set(n.code,n)}}getYielded(){return this.yielded}addKnownPreimage(t){this.preimages.set(tr.sha256(t).toString("hex"),t)}addKnownList(t){for(const n of t){const s=m.concat([m.from([0]),n]);this.addKnownPreimage(s)}const r=new rr(t.map(n=>nr(n)));this.roots.set(r.getRoot().toString("hex"),r)}addKnownMapping(t){this.addKnownList(t.keys),this.addKnownList(t.values)}execute(t){if(t.length==0)throw new Error("Unexpected empty command");const r=t[0],n=this.commands.get(r);if(!n)throw new Error(`Unexpected command code ${r}`);return n.execute(t)}}var kr=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};const sy=225,oy=248;var sr;(function(e){e[e.GET_PUBKEY=0]="GET_PUBKEY",e[e.REGISTER_WALLET=2]="REGISTER_WALLET",e[e.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",e[e.SIGN_PSBT=4]="SIGN_PSBT",e[e.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT",e[e.SIGN_MESSAGE=16]="SIGN_MESSAGE"})(sr||(sr={}));var mo;(function(e){e[e.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED"})(mo||(mo={}));class uy{constructor(t){this.transport=t}makeRequest(t,r,n){return kr(this,void 0,void 0,function*(){let s=yield this.transport.send(sy,t,0,0,r,[36864,57344]);for(;s.readUInt16BE(s.length-2)===57344;){if(!n)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");const i=s.slice(0,-2),u=n.execute(i);s=yield this.transport.send(oy,mo.CONTINUE_INTERRUPTED,0,0,u,[36864,57344])}return s.slice(0,-2)})}getExtendedPubkey(t,r){return kr(this,void 0,void 0,function*(){if(r.length>6)throw new Error("Path too long. At most 6 levels allowed.");return(yield this.makeRequest(sr.GET_PUBKEY,m.concat([m.from(t?[1]:[0]),Xs(r)]))).toString("ascii")})}getWalletAddress(t,r,n,s,i){return kr(this,void 0,void 0,function*(){if(n!==0&&n!==1)throw new Error("Change can only be 0 or 1");if(s<0||!Number.isInteger(s))throw new Error("Invalid address index");if(r!=null&&r.length!=32)throw new Error("Invalid HMAC length");const u=new fo(()=>{});u.addKnownList(t.keys.map(p=>m.from(p,"ascii"))),u.addKnownPreimage(t.serialize());const c=m.alloc(4);return c.writeUInt32BE(s,0),(yield this.makeRequest(sr.GET_WALLET_ADDRESS,m.concat([m.from(i?[1]:[0]),t.getWalletId(),r||m.alloc(32,0),m.from([n]),c]),u)).toString("ascii")})}signPsbt(t,r,n,s){return kr(this,void 0,void 0,function*(){const i=new qr(t);if(n!=null&&n.length!=32)throw new Error("Invalid HMAC length");const u=new fo(s);u.addKnownList(r.keys.map(b=>m.from(b,"ascii"))),u.addKnownPreimage(r.serialize()),u.addKnownMapping(i.globalMerkleMap);for(const b of i.inputMerkleMaps)u.addKnownMapping(b);for(const b of i.outputMerkleMaps)u.addKnownMapping(b);u.addKnownList(i.inputMapCommitments);const c=new rr(i.inputMapCommitments.map(b=>nr(b))).getRoot();u.addKnownList(i.outputMapCommitments);const p=new rr(i.outputMapCommitments.map(b=>nr(b))).getRoot();yield this.makeRequest(sr.SIGN_PSBT,m.concat([i.getGlobalKeysValuesRoot(),Wt(i.getGlobalInputCount()),c,Wt(i.getGlobalOutputCount()),p,r.getWalletId(),n||m.alloc(32,0)]),u);const g=u.getYielded(),y=new Map;for(const b of g)y.set(b[0],b.slice(1));return y})}getMasterFingerprint(){return kr(this,void 0,void 0,function*(){return this.makeRequest(sr.GET_MASTER_FINGERPRINT,m.from([]))})}signMessage(t,r){return kr(this,void 0,void 0,function*(){if(r.length>6)throw new Error("Path too long. At most 6 levels allowed.");const n=new fo(()=>{}),s=Math.ceil(t.length/64),i=[];for(let c=0;c<s;c++)i.push(t.subarray(64*c,64*c+64));n.addKnownList(i);const u=new rr(i.map(c=>nr(c))).getRoot();return(yield this.makeRequest(sr.SIGN_MESSAGE,m.concat([Xs(r),Wt(t.length),u]),n)).toString("base64")})}}function ay(e){let t="TX";return t+=" version "+e.version.toString("hex"),e.locktime&&(t+=" locktime "+e.locktime.toString("hex")),e.witness&&(t+=" witness "+e.witness.toString("hex")),e.timestamp&&(t+=" timestamp "+e.timestamp.toString("hex")),e.nVersionGroupId&&(t+=" nVersionGroupId "+e.nVersionGroupId.toString("hex")),e.nExpiryHeight&&(t+=" nExpiryHeight "+e.nExpiryHeight.toString("hex")),e.extraData&&(t+=" extraData "+e.extraData.toString("hex")),e.inputs.forEach(({prevout:r,script:n,sequence:s},i)=>{t+=`
input ${i}:`,t+=` prevout ${r.toString("hex")}`,t+=` script ${n.toString("hex")}`,t+=` sequence ${s.toString("hex")}`}),(e.outputs||[]).forEach(({amount:r,script:n},s)=>{t+=`
output ${s}:`,t+=` amount ${r.toString("hex")}`,t+=` script ${n.toString("hex")}`}),t}function hy(e,t=!1,r=!1,n=!1,s=[]){const i=[],u=[];let c=!1,p=0,g=m.alloc(0),y=m.alloc(0),b=m.alloc(0),O=m.alloc(0),S,T;const H=s.includes("decred"),x=s.includes("zencash"),L=s.includes("zcash"),M=m.from(e,"hex"),N=M.slice(p,p+4),R=N.equals(m.from([3,0,0,128]))||N.equals(m.from([4,0,0,128]))||N.equals(m.from([5,0,0,128])),G=L&&N.equals(m.from([5,0,0,128]));p+=4,!r&&t&&M[p]===0&&M[p+1]!==0&&!x&&(p+=2,c=!0),r&&(g=M.slice(p,4+p),p+=4),R&&(b=M.slice(p,4+p),p+=4),G&&(T=M.slice(p+4,p+8),y=M.slice(p+8,p+12),p+=12);let C=Ar(M,p);const $=C[0];p+=C[1];for(let B=0;B<$;B++){const o=M.slice(p,p+36);p+=36;let h=m.alloc(0),l=m.alloc(0);H?(l=M.slice(p,p+1),p+=1):(C=Ar(M,p),p+=C[1],h=M.slice(p,p+C[0]),p+=C[0]);const f=M.slice(p,p+4);p+=4,i.push({prevout:o,script:h,sequence:f,tree:l})}C=Ar(M,p);const K=C[0];p+=C[1];for(let B=0;B<K;B++){const o=M.slice(p,p+8);p+=8,H&&(p+=2),C=Ar(M,p),p+=C[1];const h=M.slice(p,p+C[0]);p+=C[0],u.push({amount:o,script:h})}if(c?(S=M.slice(p,-4),T=M.slice(M.length-4)):G||(T=M.slice(p,p+4)),p+=4,(R||H)&&!G&&(y=M.slice(p,p+4),p+=4),n&&(O=M.slice(p)),H){if(C=Ar(M,p),p+=C[1],C[0]!==$)throw new Error("splitTransaction: incoherent number of witnesses");for(let B=0;B<$;B++){p+=8,p+=4,p+=4,C=Ar(M,p),p+=C[1];const o=M.slice(p,p+C[0]);p+=C[0],i[B].script=o}}const k={version:N,inputs:i,outputs:u,locktime:T,witness:S,timestamp:g,nVersionGroupId:b,nExpiryHeight:y,extraData:O};return Bo("btc",`splitTransaction ${e}:
${ay(k)}`),k}var cy=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};const ly={lockTime:Rh,sigHashType:Ys,segwit:!1,transactionVersion:hv};function py(e,t){return cy(this,void 0,void 0,function*(){const{inputs:r,associatedKeysets:n,outputScriptHex:s,lockTime:i,sigHashType:u,segwit:c,transactionVersion:p}=Object.assign(Object.assign({},ly),t),g=m.alloc(0),y=m.alloc(0),b=m.alloc(4);b.writeUInt32LE(p,0);const O=[],S=[],T=[];let H=!0;const x={inputs:[],version:b},L=c?ao:oo,M=m.from(s,"hex");for(const N of r){{const C=yield L(e,N[1],N[0]),$=m.alloc(4);$.writeUInt32LE(N.length>=4&&typeof N[3]=="number"?N[3]:Zn,0),O.push({trustedInput:!1,value:c?m.from(C,"hex"):m.from(C,"hex").slice(4,40),sequence:$})}const{outputs:R}=N[0],G=N[1];R&&G<=R.length-1&&S.push(R[G])}for(let N=0;N<r.length;N++){const R=m.alloc(4);R.writeUInt32LE(r[N].length>=4&&typeof r[N][3]=="number"?r[N][3]:Zn,0),x.inputs.push({script:g,prevout:y,sequence:R})}c&&(yield ri(e,!0,x,O,!0),yield ni(e,M));for(let N=0;N<r.length;N++){const R=r[N],G=r[N].length>=3&&typeof R[2]=="string"?m.from(R[2],"hex"):S[N].script,C=Object.assign({},x),$=c?[O[N]]:O;c?C.inputs=[Object.assign(Object.assign({},C.inputs[N]),{script:G})]:C.inputs[N].script=G,yield ri(e,!c&&H,C,$,c),c||(yield ni(e,M));const K=yield ho(e,n[N],i,u);T.push(c?K.toString("hex"):K.slice(0,K.length-1).toString("hex")),x.inputs[N].script=g,H&&(H=!1)}return T})}var Qh=function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(u){u(i)})}return new(r||(r=Promise))(function(i,u){function c(y){try{g(n.next(y))}catch(b){u(b)}}function p(y){try{g(n.throw(y))}catch(b){u(b)}}function g(y){y.done?i(y.value):s(y.value).then(c,p)}g((n=n.apply(e,t||[])).next())})};class fy{constructor({transport:t,scrambleKey:r="BTC",currency:n="bitcoin"}){this._transport=t,this._transport.decorateAppAPIMethods(this,["getWalletXpub","getWalletPublicKey","signP2SHTransaction","signMessage","createPaymentTransaction","getTrustedInput","getTrustedInputBIP143"],r),this._impl=(()=>{switch(n){case"bitcoin":case"bitcoin_testnet":case"qtum":return new Mv(new uy(this._transport));default:return new lo(this._transport)}})()}getWalletXpub(t){return this.changeImplIfNecessary().then(r=>r.getWalletXpub(t))}getWalletPublicKey(t,r){let n;return arguments.length>2||typeof r=="boolean"?(console.warn("btc.getWalletPublicKey deprecated signature used. Please switch to getWalletPublicKey(path, { format, verify })"),n={verify:!!r,format:arguments[2]?"p2sh":"legacy"}):n=r||{},this.changeImplIfNecessary().then(s=>s.getWalletPublicKey(t,n))}signMessage(t,r){return this.changeImplIfNecessary().then(n=>n.signMessage({path:t,messageHex:r}))}createPaymentTransaction(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return this.changeImplIfNecessary().then(r=>r.createPaymentTransaction(t))}signP2SHTransaction(t){return py(this._transport,t)}splitTransaction(t,r=!1,n=!1,s=!1,i=[]){return hy(t,r,n,s,i)}serializeTransactionOutputs(t){return Kh(t)}getTrustedInput(t,r,n=[]){return oo(this._transport,t,r,n)}getTrustedInputBIP143(t,r,n=[]){return ao(this._transport,t,r,n)}changeImplIfNecessary(){return Qh(this,void 0,void 0,function*(){if(this._impl instanceof lo)return this._impl;const{name:t,version:r}=yield zh(this._transport);return(yield Qh(this,void 0,void 0,function*(){switch(t){case"Bitcoin":case"Bitcoin Test":return Vi.lt(r,"2.1.0");case"Bitcoin Legacy":case"Bitcoin Test Legacy":return!0;case"Exchange":return yield Gv(this._transport);case"Qtum":return Vi.lt(r,"3.0.0");default:return!0}}))&&(this._impl=new lo(this._transport)),this._impl})}}export{fy as default};
