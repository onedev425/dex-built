import{r as o,dh as X,t as i,R as C,j as e,q as t,T as S,A as $,aE as E,O as J,h as K,di as Q,$ as Z,bT as ee,bS as se,s as q,Y as U,bR as ie,E as te,p as ae,I as T,w as R,k as ne,D as N,bU as W,bV as le,dj as re,bc as oe,l as de,L as ce,ag as me,a9 as he,bf as ue,bY as pe,dk as O,aM as xe,aL as ge,M as ye,z as je,br as be}from"./assets/index-CyIKZwcA.js";import{P as fe}from"./GQQXxAVl.js";import{R as we}from"./DG2H1jGl.js";import{V as ve}from"./DA3rLf5F.js";import{P as u}from"./DKb0irD5.js";import{A as Se}from"./TP_WktaR.js";import{I as Ne}from"./nkxDqpDa.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[s]="bdcf7f4a-43d1-4e6b-92ec-9ee853276dc2",a._sentryDebugIdIdentifier="sentry-dbid-bdcf7f4a-43d1-4e6b-92ec-9ee853276dc2")}catch{}})();const Ce=o.memo(({asset:a,lpName:s,assetShare:p,contentRef:x,lastAddedDate:l,maxHeightStyle:g,poolShare:j,runeShare:d,shareType:c,runeWithdrawn:y,assetWithdrawn:b,runePending:m,assetPending:v,pendingTicker:f})=>{const n=o.useCallback(k=>X(k,{toFixed:6}),[]),I=o.useMemo(()=>[...m!=="0"?[{label:i("views.liquidity.runePending"),value:n(m)}]:[],...v!=="0"?[{label:i("views.liquidity.assetPending"),value:n(v)}]:[],...[u.SYM,u.RUNE_ASYM].includes(c)?[{label:`${C.symbol} ${i("views.liquidity.share")}`,value:e.jsxs(t,{center:!0,className:"gap-2",children:[e.jsx(S,{children:`${d} ${C.symbol}`}),e.jsx($,{asset:C,size:24})]})}]:[],...[u.SYM,u.ASSET_ASYM].includes(c)?[{label:`${a.ticker} ${i("views.liquidity.share")}`,value:e.jsxs(t,{center:!0,className:"gap-2",children:[e.jsx(S,{children:`${p} ${a.ticker}`}),e.jsx($,{asset:a,size:24})]})}]:[],{label:i("views.liquidity.poolShare"),value:j},...y!=="0"?[{label:i("views.liquidity.runeWithdrawn"),value:n(y)}]:[],...b!=="0"?[{label:i("views.liquidity.assetWithdrawn"),value:n(b)}]:[],{label:i("views.liquidity.lastAdded"),value:l}],[m,n,v,c,d,a,p,j,y,b,l]);return e.jsxs(t,{col:!0,className:"overflow-hidden ease-in-out transition-all",ref:x,style:g,children:[!!f&&e.jsx(S,{className:"brightness-90",textStyle:"caption",variant:"yellow",children:i("pendingLiquidity.content",{asset:f})}),e.jsxs(t,{col:!0,className:"self-stretch pt-1 pb-2",children:[e.jsx(t,{alignCenter:!0,row:!0,justify:"between",children:e.jsx(S,{className:"px-1.5",textStyle:"caption",variant:"cyan",children:s})}),e.jsx(Ne,{horizontalInset:!0,items:I,size:"sm"})]})]})}),Me=({poolUnits:a,liquidityUnits:s})=>{const p=q.fromBigInt(BigInt(a),8);return q.fromBigInt(BigInt(s)).div(p).getValue("number")},qe=({dateLastAdded:a,shareType:s,withFooter:p,pool:x,poolUnits:l="0",sharedUnits:g,runePending:j,hardCapReached:d,assetPending:c,assetWithdrawn:y,runeWithdrawn:b,poolAssetDepth:m="0",poolRuneDepth:v="0"})=>{const f=E(),{isActive:n,contentRef:I,toggle:k,maxHeightStyle:Y}=J(),{isMdActive:D}=K(),r=o.useMemo(()=>Q(x),[x]),h=o.useMemo(()=>Z.fromStringSync(x),[x]),w=o.useMemo(()=>{if(Number(j)>0)return r;if(Number(c)>0)return C.ticker},[c,r,j]),z=o.useMemo(()=>`${(s===u.SYM?[C.ticker,r]:s===u.ASSET_ASYM?[r]:[C.ticker]).join(" + ")} LP`,[r,s]),{runeShare:B,assetShare:_,poolShare:L}=o.useMemo(()=>{const M={liquidityUnits:g,poolUnits:l,runeDepth:v,assetDepth:m},A=Number.parseInt(l)>0,F=A?ee(M).getValue("string"):"0",H=A?se(M).getValue("string"):"0",V=s===u.SYM&&A?q.fromBigInt(BigInt(M.runeDepth),U.THOR).mul(M.liquidityUnits).div(l).getValue("string"):F,G=s===u.SYM&&A?q.fromBigInt(BigInt(M.assetDepth),U.THOR).mul(M.liquidityUnits).div(l).getValue("string"):H,P=A?Me({liquidityUnits:g,poolUnits:l}):0;return{runeShare:new q(V).toSignificant(6),assetShare:new q(G).toSignificant(6),poolShare:P>1e-4?`${ie(P,5)}`:"~0%"}},[m,v,l,s,g]);return e.jsx(t,{col:!0,justifyCenter:!0,className:"self-stretch",children:e.jsxs(te,{className:"!rounded-2xl p-2 !gap-1",type:w?"warn":"primary",children:[e.jsxs(t,{alignCenter:!0,className:"cursor-pointer",justify:"between",onClick:k,children:[e.jsxs(t,{center:!0,children:[w&&e.jsx(ae,{content:i("pendingLiquidity.pendingLiquidity"),children:e.jsx(T,{className:"mr-3",color:"yellow",name:"warn",size:24})}),e.jsx(t,{col:!0,children:e.jsx(Se,{inline:!0,asset1:h,asset2:C,size:n&&D?40:32})}),e.jsx(S,{className:R("mx-1 md:mx-3 !transition-all",n?"text-body md:!text-subtitle1":"!text-body"),fontWeight:"semibold",children:z})]}),e.jsxs(t,{center:!0,className:"gap-2",children:[e.jsxs(t,{col:!0,align:"end",children:[e.jsx(S,{className:R("!transition-all",n?"!text-body":"!text-caption"),fontWeight:"normal",children:` ${i("views.liquidity.poolShare")}`}),e.jsx(S,{className:R("!transition-all",n?"!text-subtitle1":"!text-body"),fontWeight:"bold",children:L})]}),e.jsx(T,{className:R("transform duration-300 ease",{"-rotate-180":n}),color:"secondary",name:"chevronDown"})]})]}),e.jsx(Ce,{asset:h,assetPending:c,assetShare:_,assetWithdrawn:y,contentRef:I,lastAddedDate:ne.unix(Number(a)).format("YYYY-MM-DD"),lpName:z,maxHeightStyle:Y,pendingTicker:w,poolShare:L,runePending:j,runeShare:B,runeWithdrawn:b,shareType:s}),p&&e.jsxs(t,{justifyCenter:!0,className:"space-x-6 md:pr-0",children:[e.jsx(t,{className:"w-full",children:e.jsx(N,{stretch:!0,className:"px-8 md:px-12",disabled:d,onClick:()=>f(W(h)),rightIcon:d?e.jsx(T,{name:"infoCircle",size:20}):void 0,tooltip:d?i("views.liquidity.hardCapReachedTooltip"):void 0,tooltipClasses:"text-center mx-[-2px]",variant:d?"fancyError":"primary",children:w?i("views.liquidity.completeButton"):i("views.liquidity.addButton")})}),e.jsx(t,{className:"w-full",children:e.jsx(N,{stretch:!0,className:"px-8 md:px-12",onClick:()=>f(le(h)),variant:"secondary",children:i("common.withdraw")})})]})]})})},Ie=({chain:a,data:s,hardCapReached:p})=>{const x=o.useCallback(({assetAddress:d,runeAddress:c})=>d&&c?u.SYM:d?u.ASSET_ASYM:c?u.RUNE_ASYM:u.SYM,[]),[l,g]=o.useMemo(()=>{var y,b;const d=(y=s==null?void 0:s.find(({assetAddress:m})=>m))==null?void 0:y.assetAddress,c=(b=s==null?void 0:s.find(({runeAddress:m})=>m))==null?void 0:b.runeAddress;return[d,c]},[s]),j=o.useMemo(()=>`${re()}?${g||l?`${a.toLowerCase()}=${g||l}`:""}`,[l,a,g]);return e.jsxs(t,{col:!0,className:"gap-1",children:[e.jsx(oe,{className:"!mx-1.5 pl-1.5",label:e.jsx(S,{children:de(a,!0)}),size:"sm",value:e.jsx(t,{className:"gap-x-2 mb-1",children:e.jsx(ce,{external:!0,to:j,children:e.jsx(N,{className:"px-2.5",leftIcon:e.jsx(T,{name:"chart",size:16}),tooltip:i("common.viewOnThoryield"),variant:"borderlessTint"})})})}),s.map(d=>o.createElement(qe,{...d,withFooter:!0,hardCapReached:p,key:d.pool,shareType:x(d)}))]})},ke=()=>{const a=E(),{setIsConnectModalOpen:s}=me(),{walletAddresses:p,isWalletLoading:x}=he(),l=ue(),[g,j]=o.useState(!0),[d,c]=o.useState(!1),[y,b]=o.useState({}),[m,v]=o.useState({}),f=o.useMemo(()=>Object.values(m).length>0?Object.values(m):p,[p,m]),{data:n,isFetching:I,refetch:k}=pe(f,{skip:!f.length||x}),Y=o.useMemo(()=>n==null?void 0:n.some(({assetPending:r,runePending:h})=>Number.parseInt(r)>0||Number.parseInt(h)>0),[n]),D=o.useMemo(()=>(n==null?void 0:n.reduce((r,h)=>{const[w]=h.pool.split(".");return r[w]=[...r[w]||[],h],r},{}))??{},[n]);return e.jsxs(fe,{description:i("views.liquidity.description"),header:e.jsx(ve,{actionsComponent:e.jsxs(e.Fragment,{children:[O&&e.jsx(N,{className:"mr-4",onClick:()=>c(!0),size:"sm",variant:"fancy",children:"Test Modal"}),e.jsx(we,{loading:x||I,onLoad:k})]}),title:i("common.liquidityPosition")}),keywords:"LP, Liquidity provider, THORSwap, THORChain, DEFI, DEX",title:i("views.liquidity.title"),children:[e.jsxs(t,{col:!0,className:"gap-3 self-stretch",children:[Y&&g&&e.jsx(xe,{className:"mt-0 mb-4",content:i("pendingLiquidity.pendingInfoGeneral"),onClose:()=>j(!1),title:i("pendingLiquidity.pendingInfoTitle"),type:"warn"}),e.jsx(t,{className:"w-full gap-x-8",justify:"between",children:f.length>0?e.jsxs(e.Fragment,{children:[e.jsx(t,{className:"w-full",children:e.jsx(N,{stretch:!0,disabled:l,onClick:()=>a(W()),rightIcon:l?e.jsx(T,{name:"infoCircle",size:20}):void 0,size:"lg",tooltip:l?i("views.liquidity.hardCapReachedTooltip"):void 0,tooltipClasses:"text-center mx-[-2px]",variant:l?"fancyError":"primary",children:i("common.deposit")})}),e.jsx(t,{className:"w-full",children:e.jsx(N,{stretch:!0,onClick:()=>a(ge.CreateLiquidity),size:"lg",children:i("common.create")})})]}):e.jsx(N,{stretch:!0,onClick:()=>s(!0),size:"lg",variant:"fancy",children:i("common.connectWallet")})}),Object.entries(D).map(([r,h])=>e.jsx(Ie,{chain:r,data:h,hardCapReached:l},r))]}),O&&e.jsx(ye,{isOpened:d,onClose:()=>c(!1),title:"Type in address to show it's LP positions",children:e.jsxs(t,{col:!0,className:"gap-2",flex:1,children:[Object.keys(je).map(r=>e.jsx(be,{stretch:!0,border:"rounded",className:"!text-md p-1.5 flex-1 border",containerClassName:"bg-light-gray-light dark:bg-dark-gray-light !bg-opacity-80",onChange:h=>b(w=>({...w,[r]:h.target.value})),placeholder:r,value:y[r]??""},r)),e.jsx(N,{stretch:!0,className:"mt-4",onClick:()=>{v(y),c(!1)},size:"lg",variant:"fancy",children:"Save"})]})})]})};export{ke as default};
